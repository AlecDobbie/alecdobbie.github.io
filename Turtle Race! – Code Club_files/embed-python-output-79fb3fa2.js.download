!function(a,b,c,d){"use strict";function e(a){return("string"==typeof a||a instanceof String)&&(a=a.replace(/^['\\/"]+|(;\s?})+|['\\/"]+$/g,"")),a}var f=function(b){for(var c=b.length,d=a("head");c--;)0===d.has("."+b[c]).length&&d.append('<meta class="'+b[c]+'" />')};f(["foundation-mq-small","foundation-mq-small-only","foundation-mq-medium","foundation-mq-medium-only","foundation-mq-large","foundation-mq-large-only","foundation-mq-xlarge","foundation-mq-xlarge-only","foundation-mq-xxlarge","foundation-data-attribute-namespace"]),a(function(){"undefined"!=typeof FastClick&&"undefined"!=typeof c.body&&FastClick.attach(c.body)});var g=function(b,d){if("string"==typeof b){if(d){var e;if(d.jquery){if(e=d[0],!e)return d}else e=d;return a(e.querySelectorAll(b))}return a(c.querySelectorAll(b))}return a(b,d)},h=function(a){var b=[];return a||b.push("data"),this.namespace.length>0&&b.push(this.namespace),b.push(this.name),b.join("-")},i=function(a){for(var b=a.split("-"),c=b.length,d=[];c--;)0!==c?d.push(b[c]):this.namespace.length>0?d.push(this.namespace,b[c]):d.push(b[c]);return d.reverse().join("-")},j=function(b,c){var d=this,e=!g(this).data(this.attr_name(!0));if(g(this.scope).is("["+this.attr_name()+"]")?(g(this.scope).data(this.attr_name(!0)+"-init",a.extend({},this.settings,c||b,this.data_options(g(this.scope)))),e&&this.events(this.scope)):g("["+this.attr_name()+"]",this.scope).each(function(){var e=!g(this).data(d.attr_name(!0)+"-init");g(this).data(d.attr_name(!0)+"-init",a.extend({},d.settings,c||b,d.data_options(g(this)))),e&&d.events(this)}),"string"==typeof b)return this[b].call(this,c)},k=function(a,b){function c(){b(a[0])}function d(){if(this.one("load",c),/MSIE (\d+\.\d+);/.test(navigator.userAgent)){var a=this.attr("src"),b=a.match(/\?/)?"&":"?";b+="random="+(new Date).getTime(),this.attr("src",a+b)}}return a.attr("src")?void(a[0].complete||4===a[0].readyState?c():d.call(a)):void c()};b.matchMedia=b.matchMedia||function(a){var b,c=a.documentElement,d=c.firstElementChild||c.firstChild,e=a.createElement("body"),f=a.createElement("div");return f.id="mq-test-1",f.style.cssText="position:absolute;top:-100em",e.style.background="none",e.appendChild(f),function(a){return f.innerHTML='&shy;<style media="'+a+'"> #mq-test-1 { width: 42px; }</style>',c.insertBefore(e,d),b=42===f.offsetWidth,c.removeChild(e),{matches:b,media:a}}}(c),function(a){function c(){d&&(g(c),i&&jQuery.fx.tick())}for(var d,e=0,f=["webkit","moz"],g=b.requestAnimationFrame,h=b.cancelAnimationFrame,i="undefined"!=typeof jQuery.fx;e<f.length&&!g;e++)g=b[f[e]+"RequestAnimationFrame"],h=h||b[f[e]+"CancelAnimationFrame"]||b[f[e]+"CancelRequestAnimationFrame"];g?(b.requestAnimationFrame=g,b.cancelAnimationFrame=h,i&&(jQuery.fx.timer=function(a){a()&&jQuery.timers.push(a)&&!d&&(d=!0,c())},jQuery.fx.stop=function(){d=!1})):(b.requestAnimationFrame=function(a){var c=(new Date).getTime(),d=Math.max(0,16-(c-e)),f=b.setTimeout(function(){a(c+d)},d);return e=c+d,f},b.cancelAnimationFrame=function(a){clearTimeout(a)})}(jQuery),b.Foundation={name:"Foundation",version:"5.5.0",media_queries:{small:g(".foundation-mq-small").css("font-family").replace(/^[\/\\'"]+|(;\s?})+|[\/\\'"]+$/g,""),"small-only":g(".foundation-mq-small-only").css("font-family").replace(/^[\/\\'"]+|(;\s?})+|[\/\\'"]+$/g,""),medium:g(".foundation-mq-medium").css("font-family").replace(/^[\/\\'"]+|(;\s?})+|[\/\\'"]+$/g,""),"medium-only":g(".foundation-mq-medium-only").css("font-family").replace(/^[\/\\'"]+|(;\s?})+|[\/\\'"]+$/g,""),large:g(".foundation-mq-large").css("font-family").replace(/^[\/\\'"]+|(;\s?})+|[\/\\'"]+$/g,""),"large-only":g(".foundation-mq-large-only").css("font-family").replace(/^[\/\\'"]+|(;\s?})+|[\/\\'"]+$/g,""),xlarge:g(".foundation-mq-xlarge").css("font-family").replace(/^[\/\\'"]+|(;\s?})+|[\/\\'"]+$/g,""),"xlarge-only":g(".foundation-mq-xlarge-only").css("font-family").replace(/^[\/\\'"]+|(;\s?})+|[\/\\'"]+$/g,""),xxlarge:g(".foundation-mq-xxlarge").css("font-family").replace(/^[\/\\'"]+|(;\s?})+|[\/\\'"]+$/g,"")},stylesheet:a("<style></style>").appendTo("head")[0].sheet,global:{namespace:d},init:function(a,c,d,e,f){var h=[a,d,e,f],i=[];if(this.rtl=/rtl/i.test(g("html").attr("dir")),this.scope=a||this.scope,this.set_namespace(),c&&"string"==typeof c&&!/reflow/i.test(c))this.libs.hasOwnProperty(c)&&i.push(this.init_lib(c,h));else for(var j in this.libs)i.push(this.init_lib(j,c));return g(b).load(function(){g(b).trigger("resize.fndtn.clearing").trigger("resize.fndtn.dropdown").trigger("resize.fndtn.equalizer").trigger("resize.fndtn.interchange").trigger("resize.fndtn.joyride").trigger("resize.fndtn.magellan").trigger("resize.fndtn.topbar").trigger("resize.fndtn.slider")}),a},init_lib:function(b,c){return this.libs.hasOwnProperty(b)?(this.patch(this.libs[b]),c&&c.hasOwnProperty(b)?("undefined"!=typeof this.libs[b].settings?a.extend(!0,this.libs[b].settings,c[b]):"undefined"!=typeof this.libs[b].defaults&&a.extend(!0,this.libs[b].defaults,c[b]),this.libs[b].init.apply(this.libs[b],[this.scope,c[b]])):(c=c instanceof Array?c:new Array(c),this.libs[b].init.apply(this.libs[b],c))):function(){}},patch:function(a){a.scope=this.scope,a.namespace=this.global.namespace,a.rtl=this.rtl,a.data_options=this.utils.data_options,a.attr_name=h,a.add_namespace=i,a.bindings=j,a.S=this.utils.S},inherit:function(a,b){for(var c=b.split(" "),d=c.length;d--;)this.utils.hasOwnProperty(c[d])&&(a[c[d]]=this.utils[c[d]])},set_namespace:function(){var b=this.global.namespace===d?a(".foundation-data-attribute-namespace").css("font-family"):this.global.namespace;this.global.namespace=b===d||/false/i.test(b)?"":b},libs:{},utils:{S:g,throttle:function(a,b){var c=null;return function(){var d=this,e=arguments;null==c&&(c=setTimeout(function(){a.apply(d,e),c=null},b))}},debounce:function(a,b,c){var d,e;return function(){var f=this,g=arguments,h=function(){d=null,c||(e=a.apply(f,g))},i=c&&!d;return clearTimeout(d),d=setTimeout(h,b),i&&(e=a.apply(f,g)),e}},data_options:function(b,c){function d(a){return!isNaN(a-0)&&null!==a&&""!==a&&a!==!1&&a!==!0}function e(b){return"string"==typeof b?a.trim(b):b}c=c||"options";var f,g,h,i={},j=function(a){var b=Foundation.global.namespace;return b.length>0?a.data(b+"-"+c):a.data(c)},k=j(b);if("object"==typeof k)return k;for(h=(k||":").split(";"),f=h.length;f--;)g=h[f].split(":"),g=[g[0],g.slice(1).join(":")],/true/i.test(g[1])&&(g[1]=!0),/false/i.test(g[1])&&(g[1]=!1),d(g[1])&&(g[1].indexOf(".")===-1?g[1]=parseInt(g[1],10):g[1]=parseFloat(g[1])),2===g.length&&g[0].length>0&&(i[e(g[0])]=e(g[1]));return i},register_media:function(b,c){Foundation.media_queries[b]===d&&(a("head").append('<meta class="'+c+'"/>'),Foundation.media_queries[b]=e(a("."+c).css("font-family")))},add_custom_rule:function(a,b){if(b===d&&Foundation.stylesheet)Foundation.stylesheet.insertRule(a,Foundation.stylesheet.cssRules.length);else{var c=Foundation.media_queries[b];c!==d&&Foundation.stylesheet.insertRule("@media "+Foundation.media_queries[b]+"{ "+a+" }")}},image_loaded:function(a,b){var c=this,d=a.length;0===d&&b(a),a.each(function(){k(c.S(this),function(){d-=1,0===d&&b(a)})})},random_str:function(){return this.fidx||(this.fidx=0),this.prefix=this.prefix||[this.name||"F",(+new Date).toString(36)].join("-"),this.prefix+(this.fidx++).toString(36)},match:function(a){return b.matchMedia(a).matches},is_small_up:function(){return this.match(Foundation.media_queries.small)},is_medium_up:function(){return this.match(Foundation.media_queries.medium)},is_large_up:function(){return this.match(Foundation.media_queries.large)},is_xlarge_up:function(){return this.match(Foundation.media_queries.xlarge)},is_xxlarge_up:function(){return this.match(Foundation.media_queries.xxlarge)},is_small_only:function(){return!(this.is_medium_up()||this.is_large_up()||this.is_xlarge_up()||this.is_xxlarge_up())},is_medium_only:function(){return this.is_medium_up()&&!this.is_large_up()&&!this.is_xlarge_up()&&!this.is_xxlarge_up()},is_large_only:function(){return this.is_medium_up()&&this.is_large_up()&&!this.is_xlarge_up()&&!this.is_xxlarge_up()},is_xlarge_only:function(){return this.is_medium_up()&&this.is_large_up()&&this.is_xlarge_up()&&!this.is_xxlarge_up()},is_xxlarge_only:function(){return this.is_medium_up()&&this.is_large_up()&&this.is_xlarge_up()&&this.is_xxlarge_up()}}},a.fn.foundation=function(){var a=Array.prototype.slice.call(arguments,0);return this.each(function(){return Foundation.init.apply(Foundation,[this].concat(a)),this})}}(jQuery,window,window.document),function(a,b,c,d){"use strict";Foundation.libs.accordion={name:"accordion",version:"5.5.0",settings:{content_class:"content",active_class:"active",multi_expand:!1,toggleable:!0,callback:function(){}},init:function(a,b,c){this.bindings(b,c)},events:function(){var b=this,c=this.S;c(this.scope).off(".fndtn.accordion").on("click.fndtn.accordion","["+this.attr_name()+"] > .accordion-navigation > a",function(d){var e=c(this).closest("["+b.attr_name()+"]"),f=b.attr_name()+"="+e.attr(b.attr_name()),g=e.data(b.attr_name(!0)+"-init")||b.settings,h=c("#"+this.href.split("#")[1]),i=a("> .accordion-navigation",e),j=i.children("."+g.content_class),k=j.filter("."+g.active_class);return d.preventDefault(),e.attr(b.attr_name())&&(j=j.add("["+f+"] dd > ."+g.content_class),i=i.add("["+f+"] .accordion-navigation")),g.toggleable&&h.is(k)?(h.parent(".accordion-navigation").toggleClass(g.active_class,!1),h.toggleClass(g.active_class,!1),g.callback(h),h.triggerHandler("toggled",[e]),void e.triggerHandler("toggled",[h])):(g.multi_expand||(j.removeClass(g.active_class),i.removeClass(g.active_class)),h.addClass(g.active_class).parent().addClass(g.active_class),g.callback(h),h.triggerHandler("toggled",[e]),void e.triggerHandler("toggled",[h]))})},off:function(){},reflow:function(){}}}(jQuery,window,window.document),function(a,b,c,d){"use strict";Foundation.libs.alert={name:"alert",version:"5.5.0",settings:{callback:function(){}},init:function(a,b,c){this.bindings(b,c)},events:function(){var b=this,c=this.S;a(this.scope).off(".alert").on("click.fndtn.alert","["+this.attr_name()+"] .close",function(a){var d=c(this).closest("["+b.attr_name()+"]"),e=d.data(b.attr_name(!0)+"-init")||b.settings;a.preventDefault(),Modernizr.csstransitions?(d.addClass("alert-close"),d.on("transitionend webkitTransitionEnd oTransitionEnd",function(a){c(this).trigger("close").trigger("close.fndtn.alert").remove(),e.callback()})):d.fadeOut(300,function(){c(this).trigger("close").trigger("close.fndtn.alert").remove(),e.callback()})})},reflow:function(){}}}(jQuery,window,window.document),function(a,b,c,d){"use strict";Foundation.libs.dropdown={name:"dropdown",version:"5.5.0",settings:{active_class:"open",disabled_class:"disabled",mega_class:"mega",align:"bottom",is_hover:!1,hover_timeout:150,opened:function(){},closed:function(){}},init:function(b,c,d){Foundation.inherit(this,"throttle"),a.extend(!0,this.settings,c,d),this.bindings(c,d)},events:function(c){var d=this,e=d.S;e(this.scope).off(".dropdown").on("click.fndtn.dropdown","["+this.attr_name()+"]",function(b){var c=e(this).data(d.attr_name(!0)+"-init")||d.settings;c.is_hover&&!Modernizr.touch||(b.preventDefault(),e(this).parent("[data-reveal-id]")&&b.stopPropagation(),d.toggle(a(this)))}).on("mouseenter.fndtn.dropdown","["+this.attr_name()+"], ["+this.attr_name()+"-content]",function(a){var b,c,f=e(this);clearTimeout(d.timeout),f.data(d.data_attr())?(b=e("#"+f.data(d.data_attr())),c=f):(b=f,c=e("["+d.attr_name()+'="'+b.attr("id")+'"]'));var g=c.data(d.attr_name(!0)+"-init")||d.settings;e(a.currentTarget).data(d.data_attr())&&g.is_hover&&d.closeall.call(d),g.is_hover&&d.open.apply(d,[b,c])}).on("mouseleave.fndtn.dropdown","["+this.attr_name()+"], ["+this.attr_name()+"-content]",function(a){var b,c=e(this);if(c.data(d.data_attr()))b=c.data(d.data_attr(!0)+"-init")||d.settings;else var f=e("["+d.attr_name()+'="'+e(this).attr("id")+'"]'),b=f.data(d.attr_name(!0)+"-init")||d.settings;d.timeout=setTimeout(function(){c.data(d.data_attr())?b.is_hover&&d.close.call(d,e("#"+c.data(d.data_attr()))):b.is_hover&&d.close.call(d,c)}.bind(this),b.hover_timeout)}).on("click.fndtn.dropdown",function(b){var c=e(b.target).closest("["+d.attr_name()+"-content]"),f=c.find("a");if(f.length>0&&"false"!==c.attr("aria-autoclose")&&d.close.call(d,e("["+d.attr_name()+"-content]")),!(e(b.target).closest("["+d.attr_name()+"]").length>0))return!e(b.target).data("revealId")&&c.length>0&&(e(b.target).is("["+d.attr_name()+"-content]")||a.contains(c.first()[0],b.target))?void b.stopPropagation():void d.close.call(d,e("["+d.attr_name()+"-content]"))}).on("opened.fndtn.dropdown","["+d.attr_name()+"-content]",function(){d.settings.opened.call(this)}).on("closed.fndtn.dropdown","["+d.attr_name()+"-content]",function(){d.settings.closed.call(this)}),e(b).off(".dropdown").on("resize.fndtn.dropdown",d.throttle(function(){d.resize.call(d)},50)),this.resize()},close:function(b){var c=this;b.each(function(){var d=a("["+c.attr_name()+"="+b[0].id+"]")||a("aria-controls="+b[0].id+"]");d.attr("aria-expanded","false"),c.S(this).hasClass(c.settings.active_class)&&(c.S(this).css(Foundation.rtl?"right":"left","-99999px").attr("aria-hidden","true").removeClass(c.settings.active_class).prev("["+c.attr_name()+"]").removeClass(c.settings.active_class).removeData("target"),c.S(this).trigger("closed").trigger("closed.fndtn.dropdown",[b]))}),b.removeClass("f-open-"+this.attr_name(!0))},closeall:function(){var b=this;a.each(b.S(".f-open-"+this.attr_name(!0)),function(){b.close.call(b,b.S(this))})},open:function(a,b){this.css(a.addClass(this.settings.active_class),b),a.prev("["+this.attr_name()+"]").addClass(this.settings.active_class),a.data("target",b.get(0)).trigger("opened").trigger("opened.fndtn.dropdown",[a,b]),a.attr("aria-hidden","false"),b.attr("aria-expanded","true"),a.focus(),a.addClass("f-open-"+this.attr_name(!0))},data_attr:function(){return this.namespace.length>0?this.namespace+"-"+this.name:this.name},toggle:function(a){if(!a.hasClass(this.settings.disabled_class)){var b=this.S("#"+a.data(this.data_attr()));0!==b.length&&(this.close.call(this,this.S("["+this.attr_name()+"-content]").not(b)),b.hasClass(this.settings.active_class)?(this.close.call(this,b),b.data("target")!==a.get(0)&&this.open.call(this,b,a)):this.open.call(this,b,a))}},resize:function(){var a=this.S("["+this.attr_name()+"-content].open"),b=this.S("["+this.attr_name()+'="'+a.attr("id")+'"]');a.length&&b.length&&this.css(a,b)},css:function(a,b){var c=Math.max((b.width()-a.width())/2,8),d=b.data(this.attr_name(!0)+"-init")||this.settings;if(this.clear_idx(),this.small()){var e=this.dirs.bottom.call(a,b,d);a.attr("style","").removeClass("drop-left drop-right drop-top").css({position:"absolute",width:"95%","max-width":"none",top:e.top}),a.css(Foundation.rtl?"right":"left",c)}else this.style(a,b,d);return a},style:function(b,c,d){var e=a.extend({position:"absolute"},this.dirs[d.align].call(b,c,d));b.attr("style","").css(e)},dirs:{_base:function(a){var d=this.offsetParent(),e=d.offset(),f=a.offset();f.top-=e.top,f.left-=e.left,f.missRight=!1,f.missTop=!1,f.missLeft=!1,f.leftRightFlag=!1;var g;g=c.getElementsByClassName("row")[0]?c.getElementsByClassName("row")[0].clientWidth:b.outerWidth;var h=(b.outerWidth-g)/2,i=g;return this.hasClass("mega")||(a.offset().top<=this.outerHeight()&&(f.missTop=!0,i=b.outerWidth-h,f.leftRightFlag=!0),a.offset().left+this.outerWidth()>a.offset().left+h&&a.offset().left-h>this.outerWidth()&&(f.missRight=!0,f.missLeft=!1),a.offset().left-this.outerWidth()<=0&&(f.missLeft=!0,f.missRight=!1)),f},top:function(a,b){var c=Foundation.libs.dropdown,d=c.dirs._base.call(this,a);return this.addClass("drop-top"),1==d.missTop&&(d.top=d.top+a.outerHeight()+this.outerHeight(),this.removeClass("drop-top")),1==d.missRight&&(d.left=d.left-this.outerWidth()+a.outerWidth()),(a.outerWidth()<this.outerWidth()||c.small()||this.hasClass(b.mega_menu))&&c.adjust_pip(this,a,b,d),Foundation.rtl?{left:d.left-this.outerWidth()+a.outerWidth(),top:d.top-this.outerHeight()}:{left:d.left,top:d.top-this.outerHeight()}},bottom:function(a,b){var c=Foundation.libs.dropdown,d=c.dirs._base.call(this,a);return 1==d.missRight&&(d.left=d.left-this.outerWidth()+a.outerWidth()),(a.outerWidth()<this.outerWidth()||c.small()||this.hasClass(b.mega_menu))&&c.adjust_pip(this,a,b,d),c.rtl?{left:d.left-this.outerWidth()+a.outerWidth(),top:d.top+a.outerHeight()}:{left:d.left,top:d.top+a.outerHeight()}},left:function(a,b){var c=Foundation.libs.dropdown.dirs._base.call(this,a);return this.addClass("drop-left"),1==c.missLeft&&(c.left=c.left+this.outerWidth(),c.top=c.top+a.outerHeight(),this.removeClass("drop-left")),{left:c.left-this.outerWidth(),top:c.top}},right:function(a,b){var c=Foundation.libs.dropdown.dirs._base.call(this,a);this.addClass("drop-right"),1==c.missRight?(c.left=c.left-this.outerWidth(),c.top=c.top+a.outerHeight(),this.removeClass("drop-right")):c.triggeredRight=!0;var d=Foundation.libs.dropdown;return(a.outerWidth()<this.outerWidth()||d.small()||this.hasClass(b.mega_menu))&&d.adjust_pip(this,a,b,c),{left:c.left+a.outerWidth(),top:c.top}}},adjust_pip:function(a,b,c,d){var e=Foundation.stylesheet,f=8;a.hasClass(c.mega_class)?f=d.left+b.outerWidth()/2-8:this.small()&&(f+=d.left-8),this.rule_idx=e.cssRules.length;var g=".f-dropdown.open:before",h=".f-dropdown.open:after",i="left: "+f+"px;",j="left: "+(f-1)+"px;";1==d.missRight&&(f=a.outerWidth()-23,g=".f-dropdown.open:before",h=".f-dropdown.open:after",i="left: "+f+"px;",j="left: "+(f-1)+"px;"),1==d.triggeredRight&&(g=".f-dropdown.open:before",h=".f-dropdown.open:after",i="left:-12px;",j="left:-14px;"),e.insertRule?(e.insertRule([g,"{",i,"}"].join(" "),this.rule_idx),e.insertRule([h,"{",j,"}"].join(" "),this.rule_idx+1)):(e.addRule(g,i,this.rule_idx),e.addRule(h,j,this.rule_idx+1))},clear_idx:function(){var a=Foundation.stylesheet;"undefined"!=typeof this.rule_idx&&(a.deleteRule(this.rule_idx),a.deleteRule(this.rule_idx),delete this.rule_idx)},small:function(){return matchMedia(Foundation.media_queries.small).matches&&!matchMedia(Foundation.media_queries.medium).matches},off:function(){this.S(this.scope).off(".fndtn.dropdown"),this.S("html, body").off(".fndtn.dropdown"),this.S(b).off(".fndtn.dropdown"),this.S("[data-dropdown-content]").off(".fndtn.dropdown")},reflow:function(){}}}(jQuery,window,window.document),function(a,b,c,d){"use strict";Foundation.libs.offcanvas={name:"offcanvas",version:"5.5.0",settings:{open_method:"move",close_on_click:!1},init:function(a,b,c){this.bindings(b,c)},events:function(){var b=this,c=b.S,d="",e="",f="";"move"===this.settings.open_method?(d="move-",e="right",f="left"):"overlap_single"===this.settings.open_method?(d="offcanvas-overlap-",e="right",f="left"):"overlap"===this.settings.open_method&&(d="offcanvas-overlap"),c(this.scope).off(".offcanvas").on("click.fndtn.offcanvas",".left-off-canvas-toggle",function(f){b.click_toggle_class(f,d+e),"overlap"!==b.settings.open_method&&c(".left-submenu").removeClass(d+e),a(".left-off-canvas-toggle").attr("aria-expanded","true")}).on("click.fndtn.offcanvas",".left-off-canvas-menu a",function(f){var g=b.get_settings(f),h=c(this).parent();!g.close_on_click||h.hasClass("has-submenu")||h.hasClass("back")?c(this).parent().hasClass("has-submenu")?(f.preventDefault(),c(this).siblings(".left-submenu").toggleClass(d+e)):h.hasClass("back")&&(f.preventDefault(),h.parent().removeClass(d+e)):(b.hide.call(b,d+e,b.get_wrapper(f)),h.parent().removeClass(d+e)),a(".left-off-canvas-toggle").attr("aria-expanded","true")}).on("click.fndtn.offcanvas",".right-off-canvas-toggle",function(e){b.click_toggle_class(e,d+f),"overlap"!==b.settings.open_method&&c(".right-submenu").removeClass(d+f),a(".right-off-canvas-toggle").attr("aria-expanded","true")}).on("click.fndtn.offcanvas",".right-off-canvas-menu a",function(e){var g=b.get_settings(e),h=c(this).parent();!g.close_on_click||h.hasClass("has-submenu")||h.hasClass("back")?c(this).parent().hasClass("has-submenu")?(e.preventDefault(),c(this).siblings(".right-submenu").toggleClass(d+f)):h.hasClass("back")&&(e.preventDefault(),h.parent().removeClass(d+f)):(b.hide.call(b,d+f,b.get_wrapper(e)),h.parent().removeClass(d+f)),a(".right-off-canvas-toggle").attr("aria-expanded","true")}).on("click.fndtn.offcanvas",".exit-off-canvas",function(g){b.click_remove_class(g,d+f),c(".right-submenu").removeClass(d+f),e&&(b.click_remove_class(g,d+e),c(".left-submenu").removeClass(d+f)),a(".right-off-canvas-toggle").attr("aria-expanded","true")}).on("click.fndtn.offcanvas",".exit-off-canvas",function(c){b.click_remove_class(c,d+f),a(".left-off-canvas-toggle").attr("aria-expanded","false"),e&&(b.click_remove_class(c,d+e),a(".right-off-canvas-toggle").attr("aria-expanded","false"))})},toggle:function(a,b){b=b||this.get_wrapper(),b.is("."+a)?this.hide(a,b):this.show(a,b)},show:function(a,b){b=b||this.get_wrapper(),b.trigger("open").trigger("open.fndtn.offcanvas"),b.addClass(a)},hide:function(a,b){b=b||this.get_wrapper(),b.trigger("close").trigger("close.fndtn.offcanvas"),b.removeClass(a)},click_toggle_class:function(a,b){a.preventDefault();var c=this.get_wrapper(a);this.toggle(b,c)},click_remove_class:function(a,b){a.preventDefault();var c=this.get_wrapper(a);this.hide(b,c)},get_settings:function(a){var b=this.S(a.target).closest("["+this.attr_name()+"]");return b.data(this.attr_name(!0)+"-init")||this.settings},get_wrapper:function(a){var b=this.S(a?a.target:this.scope).closest(".off-canvas-wrap");return 0===b.length&&(b=this.S(".off-canvas-wrap")),b},reflow:function(){}}}(jQuery,window,window.document),function(a,b,c,d){"use strict";function e(a){var b=/fade/i.test(a),c=/pop/i.test(a);return{animate:b||c,pop:c,fade:b}}Foundation.libs.reveal={name:"reveal",version:"5.5.0",locked:!1,settings:{animation:"fadeAndPop",animation_speed:250,close_on_background_click:!0,close_on_esc:!0,dismiss_modal_class:"close-reveal-modal",bg_class:"reveal-modal-bg",bg_root_element:"body",root_element:"body",open:function(){},opened:function(){},close:function(){},closed:function(){},bg:a(".reveal-modal-bg"),css:{open:{opacity:0,visibility:"visible",display:"block"},close:{opacity:1,visibility:"hidden",display:"none"}}},init:function(b,c,d){a.extend(!0,this.settings,c,d),this.bindings(c,d)},events:function(a){var b=this,d=b.S;return d(this.scope).off(".reveal").on("click.fndtn.reveal","["+this.add_namespace("data-reveal-id")+"]:not([disabled])",function(a){if(a.preventDefault(),!b.locked){var c=d(this),e=c.data(b.data_attr("reveal-ajax"));if(b.locked=!0,"undefined"==typeof e)b.open.call(b,c);else{var f=e===!0?c.attr("href"):e;b.open.call(b,c,{url:f})}}}),d(c).on("click.fndtn.reveal",this.close_targets(),function(a){if(a.preventDefault(),!b.locked){var c=d("["+b.attr_name()+"].open").data(b.attr_name(!0)+"-init")||b.settings,e=d(a.target)[0]===d("."+c.bg_class)[0];if(e){if(!c.close_on_background_click)return;a.stopPropagation()}b.locked=!0,b.close.call(b,e?d("["+b.attr_name()+"].open"):d(this).closest("["+b.attr_name()+"]"))}}),d("["+b.attr_name()+"]",this.scope).length>0?d(this.scope).on("open.fndtn.reveal",this.settings.open).on("opened.fndtn.reveal",this.settings.opened).on("opened.fndtn.reveal",this.open_video).on("close.fndtn.reveal",this.settings.close).on("closed.fndtn.reveal",this.settings.closed).on("closed.fndtn.reveal",this.close_video):d(this.scope).on("open.fndtn.reveal","["+b.attr_name()+"]",this.settings.open).on("opened.fndtn.reveal","["+b.attr_name()+"]",this.settings.opened).on("opened.fndtn.reveal","["+b.attr_name()+"]",this.open_video).on("close.fndtn.reveal","["+b.attr_name()+"]",this.settings.close).on("closed.fndtn.reveal","["+b.attr_name()+"]",this.settings.closed).on("closed.fndtn.reveal","["+b.attr_name()+"]",this.close_video),!0},key_up_on:function(a){var b=this;return b.S("body").off("keyup.fndtn.reveal").on("keyup.fndtn.reveal",function(a){var c=b.S("["+b.attr_name()+"].open"),d=c.data(b.attr_name(!0)+"-init")||b.settings;d&&27===a.which&&d.close_on_esc&&!b.locked&&b.close.call(b,c)}),!0},key_up_off:function(a){return this.S("body").off("keyup.fndtn.reveal"),!0},open:function(c,d){var e,f=this;c?"undefined"!=typeof c.selector?e=f.S("#"+c.data(f.data_attr("reveal-id"))).first():(e=f.S(this.scope),d=c):e=f.S(this.scope);var g=e.data(f.attr_name(!0)+"-init");if(g=g||this.settings,e.hasClass("open")&&c.attr("data-reveal-id")==e.attr("id"))return f.close(e);if(!e.hasClass("open")){var h=f.S("["+f.attr_name()+"].open");if("undefined"==typeof e.data("css-top")&&e.data("css-top",parseInt(e.css("top"),10)).data("offset",this.cache_offset(e)),this.key_up_on(e),e.trigger("open").trigger("open.fndtn.reveal"),h.length<1&&this.toggle_bg(e,!0),"string"==typeof d&&(d={url:d}),"undefined"!=typeof d&&d.url){var i="undefined"!=typeof d.success?d.success:null;a.extend(d,{success:function(b,c,d){if(a.isFunction(i)){var j=i(b,c,d);"string"==typeof j&&(b=j)}e.html(b),f.S(e).foundation("section","reflow"),f.S(e).children().foundation(),h.length>0&&f.hide(h,g.css.close),f.show(e,g.css.open)}}),a.ajax(d)}else h.length>0&&this.hide(h,g.css.close),this.show(e,g.css.open)}f.S(b).trigger("resize")},close:function(a){var a=a&&a.length?a:this.S(this.scope),b=this.S("["+this.attr_name()+"].open"),c=a.data(this.attr_name(!0)+"-init")||this.settings;b.length>0&&(this.locked=!0,this.key_up_off(a),a.trigger("close").trigger("close.fndtn.reveal"),this.toggle_bg(a,!1),this.hide(b,c.css.close,c))},close_targets:function(){var a="."+this.settings.dismiss_modal_class;return this.settings.close_on_background_click?a+", ."+this.settings.bg_class:a},toggle_bg:function(b,c,e){var f=b.data(this.attr_name(!0)+"-init")||this.settings,g=f.bg_root_element;0===this.S("."+this.settings.bg_class).length&&(this.settings.bg=a("<div />",{class:this.settings.bg_class}).appendTo(g).hide());var h=this.settings.bg.filter(":visible").length>0;e!=h&&((e==d?h:!e)?this.hide(this.settings.bg):this.show(this.settings.bg))},show:function(b,c){if(c){var d=b.data(this.attr_name(!0)+"-init")||this.settings,f=d.root_element;if(0===b.parent(f).length){var g=b.wrap('<div style="display: none;" />').parent();b.on("closed.fndtn.reveal.wrapped",function(){b.detach().appendTo(g),b.unwrap().unbind("closed.fndtn.reveal.wrapped")}),b.detach().appendTo(f)}var h=e(d.animation);if(h.animate||(this.locked=!1),h.pop){c.top=a(f).scrollTop()-b.data("offset")+"px";var i={top:a(f).scrollTop()+b.data("css-top")+"px",opacity:1};return setTimeout(function(){return b.css(c).animate(i,d.animation_speed,"linear",function(){this.locked=!1,b.trigger("opened").trigger("opened.fndtn.reveal")}.bind(this)).addClass("open")}.bind(this),d.animation_speed/2)}if(h.fade){c.top=a(f).scrollTop()+b.data("css-top")+"px";var i={opacity:1};return setTimeout(function(){return b.css(c).animate(i,d.animation_speed,"linear",function(){this.locked=!1,b.trigger("opened").trigger("opened.fndtn.reveal")}.bind(this)).addClass("open")}.bind(this),d.animation_speed/2)}return b.css(c).show().css({opacity:1}).addClass("open").trigger("opened").trigger("opened.fndtn.reveal")}var d=this.settings;return e(d.animation).fade?b.fadeIn(d.animation_speed/2):(this.locked=!1,b.show())},hide:function(b,c){if(c){var d=b.data(this.attr_name(!0)+"-init")||this.settings,f=d.root_element,g=e(d.animation);if(g.animate||(this.locked=!1),g.pop){var h={top:-a(f).scrollTop()-b.data("offset")+"px",opacity:0};return setTimeout(function(){return b.animate(h,d.animation_speed,"linear",function(){this.locked=!1,b.css(c).trigger("closed").trigger("closed.fndtn.reveal")}.bind(this)).removeClass("open")}.bind(this),d.animation_speed/2)}if(g.fade){var h={opacity:0};return setTimeout(function(){return b.animate(h,d.animation_speed,"linear",function(){this.locked=!1,b.css(c).trigger("closed").trigger("closed.fndtn.reveal")}.bind(this)).removeClass("open")}.bind(this),d.animation_speed/2)}return b.hide().css(c).removeClass("open").trigger("closed").trigger("closed.fndtn.reveal")}var d=this.settings;return e(d.animation).fade?b.fadeOut(d.animation_speed/2):b.hide()},close_video:function(b){var c=a(".flex-video",b.target),d=a("iframe",c);d.length>0&&(d.attr("data-src",d[0].src),d.attr("src",d.attr("src")),c.hide())},open_video:function(b){var c=a(".flex-video",b.target),e=c.find("iframe");if(e.length>0){var f=e.attr("data-src");if("string"==typeof f)e[0].src=e.attr("data-src");else{var g=e[0].src;e[0].src=d,e[0].src=g}c.show()}},data_attr:function(a){return this.namespace.length>0?this.namespace+"-"+a:a},cache_offset:function(a){var b=a.show().height()+parseInt(a.css("top"),10);return a.hide(),b},off:function(){a(this.scope).off(".fndtn.reveal")},reflow:function(){}}}(jQuery,window,window.document),function(a,b,c,d){"use strict";Foundation.libs.tooltip={name:"tooltip",version:"5.5.0",settings:{additional_inheritable_classes:[],tooltip_class:".tooltip",append_to:"body",touch_close_text:"Tap To Close",disable_for_touch:!1,hover_delay:200,show_on:"all",tip_template:function(a,b){return'<span data-selector="'+a+'" id="'+a+'" class="'+Foundation.libs.tooltip.settings.tooltip_class.substring(1)+'" role="tooltip">'+b+'<span class="nub"></span></span>'}},cache:{},init:function(a,b,c){Foundation.inherit(this,"random_str"),this.bindings(b,c)},should_show:function(b,c){var d=a.extend({},this.settings,this.data_options(b));return"all"===d.show_on||(!(!this.small()||"small"!==d.show_on)||(!(!this.medium()||"medium"!==d.show_on)||!(!this.large()||"large"!==d.show_on)))},medium:function(){return matchMedia(Foundation.media_queries.medium).matches},large:function(){return matchMedia(Foundation.media_queries.large).matches},events:function(b){var c=this,d=c.S;c.create(this.S(b)),a(this.scope).off(".tooltip").on("mouseenter.fndtn.tooltip mouseleave.fndtn.tooltip touchstart.fndtn.tooltip MSPointerDown.fndtn.tooltip","["+this.attr_name()+"]",function(b){var e=d(this),f=a.extend({},c.settings,c.data_options(e)),g=!1;if(Modernizr.touch&&/touchstart|MSPointerDown/i.test(b.type)&&d(b.target).is("a"))return!1;if(/mouse/i.test(b.type)&&c.ie_touch(b))return!1;if(e.hasClass("open"))Modernizr.touch&&/touchstart|MSPointerDown/i.test(b.type)&&b.preventDefault(),c.hide(e);else{if(f.disable_for_touch&&Modernizr.touch&&/touchstart|MSPointerDown/i.test(b.type))return;!f.disable_for_touch&&Modernizr.touch&&/touchstart|MSPointerDown/i.test(b.type)&&(b.preventDefault(),d(f.tooltip_class+".open").hide(),g=!0),/enter|over/i.test(b.type)?this.timer=setTimeout(function(){c.showTip(e)}.bind(this),c.settings.hover_delay):"mouseout"===b.type||"mouseleave"===b.type?(clearTimeout(this.timer),c.hide(e)):c.showTip(e)}}).on("mouseleave.fndtn.tooltip touchstart.fndtn.tooltip MSPointerDown.fndtn.tooltip","["+this.attr_name()+"].open",function(b){return(!/mouse/i.test(b.type)||!c.ie_touch(b))&&void("touch"==a(this).data("tooltip-open-event-type")&&"mouseleave"==b.type||("mouse"==a(this).data("tooltip-open-event-type")&&/MSPointerDown|touchstart/i.test(b.type)?c.convert_to_touch(a(this)):c.hide(a(this))))}).on("DOMNodeRemoved DOMAttrModified","["+this.attr_name()+"]:not(a)",function(a){c.hide(d(this))})},ie_touch:function(a){return!1},showTip:function(a){var b=this.getTip(a);if(this.should_show(a,b))return this.show(a)},getTip:function(b){var c=this.selector(b),d=a.extend({},this.settings,this.data_options(b)),e=null;return c&&(e=this.S('span[data-selector="'+c+'"]'+d.tooltip_class)),"object"==typeof e&&e},selector:function(a){var b=a.attr("id"),c=a.attr(this.attr_name())||a.attr("data-selector");return(b&&b.length<1||!b)&&"string"!=typeof c&&(c=this.random_str(6),a.attr("data-selector",c).attr("aria-describedby",c)),b&&b.length>0?b:c},create:function(c){var d=this,e=a.extend({},this.settings,this.data_options(c)),f=this.settings.tip_template;"string"==typeof e.tip_template&&b.hasOwnProperty(e.tip_template)&&(f=b[e.tip_template]);var g=a(f(this.selector(c),a("<div></div>").html(c.attr("title")).html())),h=this.inheritable_classes(c);g.addClass(h).appendTo(e.append_to),Modernizr.touch&&(g.append('<span class="tap-to-close">'+e.touch_close_text+"</span>"),
g.on("touchstart.fndtn.tooltip MSPointerDown.fndtn.tooltip",function(a){d.hide(c)})),c.removeAttr("title").attr("title","")},reposition:function(b,c,d){var e,f,g,h,i;if(c.css("visibility","hidden").show(),e=b.data("width"),f=c.children(".nub"),g=f.outerHeight(),h=f.outerHeight(),this.small()?c.css({width:"100%"}):c.css({width:e?e:"auto"}),i=function(a,b,c,d,e,f){return a.css({top:b?b:"auto",bottom:d?d:"auto",left:e?e:"auto",right:c?c:"auto"}).end()},i(c,b.offset().top+b.outerHeight()+10,"auto","auto",b.offset().left),this.small())i(c,b.offset().top+b.outerHeight()+10,"auto","auto",12.5,a(this.scope).width()),c.addClass("tip-override"),i(f,-g,"auto","auto",b.offset().left);else{var j=b.offset().left;Foundation.rtl&&(f.addClass("rtl"),j=b.offset().left+b.outerWidth()-c.outerWidth()),i(c,b.offset().top+b.outerHeight()+10,"auto","auto",j),c.removeClass("tip-override"),d&&d.indexOf("tip-top")>-1?(Foundation.rtl&&f.addClass("rtl"),i(c,b.offset().top-c.outerHeight(),"auto","auto",j).removeClass("tip-override")):d&&d.indexOf("tip-left")>-1?(i(c,b.offset().top+b.outerHeight()/2-c.outerHeight()/2,"auto","auto",b.offset().left-c.outerWidth()-g).removeClass("tip-override"),f.removeClass("rtl")):d&&d.indexOf("tip-right")>-1&&(i(c,b.offset().top+b.outerHeight()/2-c.outerHeight()/2,"auto","auto",b.offset().left+b.outerWidth()+g).removeClass("tip-override"),f.removeClass("rtl"))}c.css("visibility","visible").hide()},small:function(){return matchMedia(Foundation.media_queries.small).matches&&!matchMedia(Foundation.media_queries.medium).matches},inheritable_classes:function(b){var c=a.extend({},this.settings,this.data_options(b)),d=["tip-top","tip-left","tip-bottom","tip-right","radius","round"].concat(c.additional_inheritable_classes),e=b.attr("class"),f=e?a.map(e.split(" "),function(b,c){if(a.inArray(b,d)!==-1)return b}).join(" "):"";return a.trim(f)},convert_to_touch:function(b){var c=this,d=c.getTip(b),e=a.extend({},c.settings,c.data_options(b));0===d.find(".tap-to-close").length&&(d.append('<span class="tap-to-close">'+e.touch_close_text+"</span>"),d.on("click.fndtn.tooltip.tapclose touchstart.fndtn.tooltip.tapclose MSPointerDown.fndtn.tooltip.tapclose",function(a){c.hide(b)})),b.data("tooltip-open-event-type","touch")},show:function(a){var b=this.getTip(a);"touch"==a.data("tooltip-open-event-type")&&this.convert_to_touch(a),this.reposition(a,b,a.attr("class")),a.addClass("open"),b.fadeIn(150)},hide:function(a){var b=this.getTip(a);b.fadeOut(150,function(){b.find(".tap-to-close").remove(),b.off("click.fndtn.tooltip.tapclose MSPointerDown.fndtn.tapclose"),a.removeClass("open")})},off:function(){var b=this;this.S(this.scope).off(".fndtn.tooltip"),this.S(this.settings.tooltip_class).each(function(c){a("["+b.attr_name()+"]").eq(c).attr("title",a(this).text())}).remove()},reflow:function(){}}}(jQuery,window,window.document),function(a){var b,c={},d={};try{b=localStorage}catch(a){}var e;b&&b.getItem?e=b.getItem("__browser_id__"):(e=document.cookie.match(/browser_id=(id\d+\.\d+);/),e&&(e=e[1])),e||(e="id"+Date.now()+Math.random(),b&&b.setItem&&b.setItem("__browser_id__",e)),document.cookie="browser_id="+e,a.TrinketIO={export:function(a,b){for(var d=a.split("."),e=d.pop(),f=c,g=0;g<d.length;g++)null==f[d[g]]&&(f[d[g]]={}),f=f[d[g]];if(f[e])throw new Error("Module "+a+" has already been defined!");return f[e]=b,b},import:function(a){for(var b=a.split("."),d=c,e=0;e<b.length;e++)if(d=d[b[e]],null==d)throw new Error("Module "+a+" could not be found!");return d},runtime:function(a,b){return arguments.length>1&&(d[a]=b),d[a]},clearRuntime:function(){d={}}}}(window),function(a){window.trinketConfig={get:function(b){return a[b]},prefix:function(b,c){if("/"!==b.charAt(0)&&(b="/"+b),"undefined"==typeof c){var d=b.match(/\/(\w+)\//);d&&(c=d[1])}return c&&a.prefixes[c]?"/"+a.prefixes[c]+b:"/"+a.cachePrefix+Date.now()+b},getUrl:function(b){return"/"!==b.charAt(0)&&(b="/"+b),a.protocol+"://"+a.apphostname+b},getClassUrl:function(b,c){var d="/"+c;return a.usersubdomains?"//"+b+"."+a.apphostname+d:"/u/"+b+"/classes"+d}}}(window.trinket.config),function(a,b){"use strict";function c(a){return new Function("o",'return "'+a.replace(/["\n\r\u2028\u2029]/g,function(a){return e[a]}).replace(/\{\{([\s\S]+?)\}\}/g,'" + (o["$1"] !== undefined ? o["$1"] : "") + "')+'";')}function d(a,b){return f[a]||(f[a]=c($("#"+a).text()),$("#"+a).remove()),f[a](b||{})}var e={"\n":"\\n",'"':'\\"',"\u2028":"\\u2028","\u2029":"\\u2029"},f={};d.compile=c,b.export("utils.template",d)}(window,window.TrinketIO),function(a,b){"use strict";function c(){return+new Date}function d(a){return k+a}function e(a){return l+a}function f(a,b){var d=parseInt(m.getItem(e(a)),10);return!!(d&&d<(b||c()))}function g(a,b,f){if(m&&a){var g=e(a);if(f){var h=1e3*f;m.setItem(g,c()+h)}else m.removeItem(g);return b=JSON.stringify(b),m.setItem(d(a),b)}}function h(a){if(!m||!a)return null;if(f(a))return i(a),null;var b=m.getItem(d(a));if(b)try{return JSON.parse(b)}catch(a){return null}return b}function i(a){m&&a&&(m.removeItem(e(a)),m.removeItem(d(a)))}function j(){if(m){var a,b,d=m.length,e=k,g=c();for(b=0;b<d;b++)a=m.key(b),a&&0===a.indexOf(e)&&(a=a.substr(e.length),f(a,g)&&i(a))}}var k="__trinket__",l="__trinket_expire__",m=function(){try{return a.localStorage.setItem(k,""),a.localStorage.getItem(k),a.localStorage.removeItem(k),a.localStorage}catch(a){return}}();b.export("utils.cache",{get:h,set:g,remove:i,purge:j})}(window,window.TrinketIO),$("document").ready(function(){function a(a){return window.location.protocol+"//"+window.location.hostname+a}function b(a){var b,d,e,f=a.split("="),g="",h=!1;if("console"!==this.getType()&&("python3"!==this.getType()&&"python"!==this.getType()||"console"!==this._queryString.runMode)||(h=!0),"code"===f[0]&&f[1])if(g=decodeURIComponent(f[1]),b=/\n----\{(\w[\w\.\-]*)\}----\n/,d=g.split(b),d.length>1){var i=this.getMainFile();if(i){for(g=[{name:i,content:d.shift()}],h&&(g[0].content=c(g[0].content)),e=0;e<d.length;e+=2)g.push({name:d[e],content:"undefined"!=typeof d[e+1]&&d[e+1].length?d[e+1]:""});g=JSON.stringify(g)}}else h&&(g=c(g));return g}function c(a){var b,c,d,e;return/^>>>/.test(a)&&(b=[],c=a.split("\n"),c.forEach(function(a){(d=/^(>>>|\.\.\.) /.exec(a))&&(e=a.substring(4,a.length),"..."===d[1]?b[b.length-1]+="\\n"+e:"undefined"!=typeof e&&e.length&&b.push(e))}),a=b.join("\n")),a}function d(a){if("undefined"==typeof a||null===a)return null;if(a instanceof Array)for(var b=0;b<a.length;b++)a[b]=d(a[b]);else if("object"==typeof a)for(var b in a)a.hasOwnProperty(b)&&(a[b]=d(a[b]));else"string"==typeof a&&(a=_.unescape(a));return a}function e(){var a={};if(window.location.search)for(var b=window.location.search.substr(1).split("&"),c=0;c<b.length;c++){var d=b[c].split("=");d[0]&&"undefined"!=typeof d[1]&&(a[d[0]]=decodeURIComponent(d[1].replace(/\+/g," ")),"true"===a[d[0]]&&(a[d[0]]=!0),"false"===a[d[0]]&&(a[d[0]]=!1))}return a}function f(a,b){b&&o.clearRuntime();var c=Object.keys(a);c.forEach(function(b){o.runtime(b,a[b])})}function g(a,b){return function(c,d,e){var f=d?n(d).serialize():n("#accountForm").serialize(),g=d||"#accountForm";c.stopPropagation(),c.preventDefault(),n.ajax({type:"POST",url:a,data:f,success:n.proxy(b.onLoginComplete,b,g),dataType:"json"}),b.sendInterfaceAnalytics(this,e)}}function h(a,b,c){var d=n.Deferred();return JSZipUtils.getBinaryContent(a,function(a,e){a?d.reject(a):(c.file(b,e,{binary:!0}),d.resolve(e))}),d}function i(c,h){var i,j=this,k=["on","off","trigger","once"];this._$=n(this);for(var l=0;l<k.length;l++){var p=k[l];this[p]=n.proxy(this._$[p],this._$)}if(this.$shareModal=n("#shareModal"),this.$shareUrl=n("#shareUrl"),this.$embedModal=n("#embedModal"),this.$embedCode=n("#embedCode"),this.$emailModal=n("#emailModal"),this.$overlay=n("#content-overlay"),this.$resetModal=n("#confirmResetModal"),this.$upgradeModal=n("#upgradeModal"),this.$draftMessage=n("#draftMessage"),this.$responsiveIndicators=n(".responsive-indicator"),n(document).on("click touchstart",".menu-button",function(a){var b=n(this).data("action"),c="trinket."+b;n(this).hasClass("disabled")||(n(this).trigger(c,{action:b,data:n(this).data("data")}),n(this).data("no-analytics")||j.sendInterfaceAnalytics(this))}),n(document).on("trinket.sharing.share",n.proxy(this.onShareClick,this)),n(document).on("trinket.sharing.embed",n.proxy(this.onEmbedClick,this)),n(document).on("trinket.sharing.email",n.proxy(this.onEmailClick,this)),n(document).on("trinket.group.post",n.proxy(this.onGroupPostClick,this)),n(document).on("trinket.group.submit",n.proxy(this.onGroupSubmitClick,this)),n(document).on("trinket.library.add",n.proxy(this.onSaveClick,this)),n(document).on("trinket.code.save",n.proxy(this.onUpdateClick,this)),n(document).on("trinket.code.fontsize",n.proxy(this.onFontSizeClick,this)),n(document).on("trinket.view.gallery",n.proxy(this.onGalleryClick,this)),n(document).on("trinket.mode.fullscreen",n.proxy(this.onFullScreenClick,this)),n(document).on("trinket.mode.download",n.proxy(this.onDownloadClick,this)),n(document).on("trinket.menu.upgrade",n.proxy(this.onUpgradeClick,this)),n(document).on("trinket.open.link",n.proxy(this.onLinkClick,this)),n(document).on("trinket.code.reset",function(){j.$resetModal.foundation("reveal","open")}),n(document).on("trinket.code.confirm-reset",n.proxy(this.onResetClick,this)),n(document).on("trinket.code.cancel-reset",function(){j.$resetModal.foundation("reveal","close")}),n(document).on("trinket.code.settings",function(){n("#settingsModal").foundation("reveal","open")}),n(document).on("webkitfullscreenchange mozfullscreenchange fullscreenchange MSFullscreenChange",function(a){var b=n(".trinket-content-wrapper").width(),c=n("#editor").width();c>b&&n("#editor").css("width",.5*b)}),n(document).on("trinket.sharing.social",function(b,c){var d,e,f=!1;if(m&&m.toolbox){!j.isModified()&&j._trinket.id||(d=Date.now(),e=j._trinket.code+j.getType(),n("#user").val()&&(e+=n("#user").val()),j._trinket.id&&(e+=j._trinket.id),e+=d,j._trinket.shortCode=CryptoJS.SHA1(e).toString(CryptoJS.enc.Hex).substring(0,10),f=!0);var g=j.getShareInfo(j._trinket),h=a(g.url);m.toolbox("#addthis",{},{url:h})}if(n(c.data).click(),f){var i={},k=j.serialize(),l=function(){};k.shortCode=j._trinket.shortCode,k._timestamp=d,j._trinket.id?j.fork(j._trinket,k,i,l):j.create(k,i,l)}}),n(document).on("trinket.account.login",g("/api/users/login",this)),n(document).on("trinket.account.create",g("/api/users",this)),n("#brand").click(n.proxy(this.onLogoClick,this)),n("#shareUrl").click(n.proxy(this.onShareFocus,this)),n("#embedCode").click(n.proxy(this.onEmbedFocus,this)),n("#emailModalForm").submit(n.proxy(this.onSendEmailClick,this)),n(document).on("change","input[data-trinket-settings]",n.proxy(this.settingsChange,this)),o.runtime("settingsModified",!1),t.init(),n("#version-toggle").change(function(){n(this).is(":checked")?(j.reset(j._original),j._viewingOriginal(!1),n(".menu-button").not(".allow-original").removeClass("disabled")):(n.extend(!0,j._original,j.serialize()),j.reset(j._original.original),j._viewingOriginal(!0),n(".menu-button").not(".allow-original").addClass("disabled"),n(".revert-remix").removeClass("disabled"))}),this._notification_open=!1,n("#notification-container").click(n.proxy(this.onNotificationClick,this)),m&&m.addEventListener&&m.addEventListener("addthis.menu.share",n.proxy(this.onSocialShare,this)),this._currentMode="",this._updates={},this._original=d(c),this._viewingDraft=!1,this._predraft=n.extend(!0,{},this._original),h){if(this._original_draft=d(h),["code","assets","settings"].forEach(function(a){j._original_draft[a]&&(j._original[a]=j._original_draft[a],j._viewingDraft=!0,"settings"===a&&f(j._original_draft[a]||{}))}),this._viewingDraft){var s=r("draftTextTemplate",{draftText:"Viewing Draft"});this.$draftMessage.html(s),n(".save-it").removeClass("disabled")}}else f(this._original.settings||{});if(this._queryString=e(),window.location.hash){var u=window.location.href,v=b.call(this,u.substr(u.indexOf("#")+1));v&&(this._original.code=v)}this.setTrinket(this._original);try{window.sessionStorage}catch(a){this._queryString.noStorage=!0}this._queryString.noStorage||this._queryString.outputOnly||(i=(this._trinket.id||JSON.stringify(this._trinket))+(document.referrer||document.location),this.guid=CryptoJS.MD5(i).toString(CryptoJS.enc.Hex),this._queryString.autoRestore!==!1&&window.sessionStorage&&window.sessionStorage.getItem(this.guid)?this._trinket.code=window.sessionStorage.getItem(this.guid):(this._previousSession=q.get(this.guid))&&(q.remove(this.guid),j.showRestoreMessage())),this.setUI(),"console"!==this.getType()&&"guest"!==this.getUIType()&&this._original&&this._original.id?n(this).on("trinket.code.change",_.debounce(function(){n(".save-it").removeClass("disabled"),j.updateDraft()},1e3)):n(this).on("trinket.code.change",_.debounce(function(){j.updateSessionCache()},500)),this._queryString.externalInit||this.initialize(this._trinket),this.toggleUI(this.getUIType()),n(document).keydown(function(a){j.hasOverlay&&27===a.keyCode&&j.hideAll()}),n(document).foundation({offcanvas:{close_on_click:!0},dropdown:{active_class:"open"}}),n(".left-off-canvas-toggle, .right-off-canvas-toggle").on("click",function(){}),n(document).on("close.fndtn.alert",function(a){n("body").removeClass("has-status-bar"),n(".trinket-content").css("display","none"),setTimeout(function(){n(".trinket-content").css("display","block")})}),this.setFontSize(this._queryString.font||"1em"),this.startTour(),this.parsedInstructions="",n(document).on("click","#edit-instructions-link",n.proxy(this.onEditInstructionsClick,this)),n(document).on("click","#cancel-edit-instructions",n.proxy(this.onCancelEditInstructionsClick,this)),n(document).on("click","#save-instructions",n.proxy(this.onSaveInstructionsClick,this))}function j(a,b,c,d){var e=r("statusMessageTemplate",{type:d||"success",message:a}),f=n(e);n("body").addClass("has-status-bar").append(f),b&&f.find(".yep").on("click",b),c&&f.find(".nope").on("click",c),n(document).foundation("alert","reflow")}function k(a,b,c){var d=!1,e=new RegExp("\\."+c),f=new RegExp("import\\s*"+b),g=new RegExp("from\\s*"+b+"\\s*import");return _.map(a,function(a,b){b.match(e)&&(a.match(f)||a.match(g))&&(d=!0)}),d}var l,m=window.addthis,n=window.jQuery,o=window.TrinketIO,p=1728e3,q=o.import("utils.cache"),r=o.import("utils.template"),s=o.import("utils.selectText"),t=o.import("trinket.share"),u=o.import("trinket.roles"),v="undefined"!=typeof trinketMarkdown?trinketMarkdown({}):void 0;q.purge(),n.fn.serializeObject=function(){var a={},b=this.serializeArray();return n.each(b,function(){a[this.name]?(a[this.name].push||(a[this.name]=[a[this.name]]),a[this.name].push(this.value||"")):a[this.name]=this.value||""}),a};n.extend(i.prototype,{showRestoreMessage:function(){var a,b,c,d=this;b='Do you want to restore your last session? <a title="restore the previous session" data-action="code.restore" class="text-link yep"><i class="fa fa-check"></i>&nbsp;Restore</a>&nbsp;&nbsp;or&nbsp;&nbsp;<a class="text-link nope"><i class="fa fa-trash"></i>&nbsp;Discard</a>',c='<i class="fa fa-check-circle-o"></i>&nbsp;Your session has been restored. <a class="text-link yep"><i class="fa fa-thumbs-o-up">&nbsp;</i>Accept</a>&nbsp;&nbsp;or&nbsp;&nbsp;<a class="text-link nope"><i class="fa fa-undo"></i>&nbsp;Undo</a>',j(b,function(){n("#statusMessages .close").click(),a=d._trinket.code,d._trinket.code=d._previousSession,d.reset(d._trinket),n(d).trigger("trinket.code.change"),j(c,function(){n("#statusMessages .close").click()},function(){n("#statusMessages .close").click(),d._trinket.code=a,d.reset(d._trinket),n(d).trigger("trinket.code.change"),d.showRestoreMessage()})},function(){n("#statusMessages .close").click()})},initialize:function(a){throw new Error("initialize is not implemented")},getTour:function(){return[]},startTour:function(){this.tour=this.getTour(),this.tour&&this.tour.length&&this.nextStop()},nextStop:function(){var a,b=this,c=b.tour,d=c?c.shift():null;if(prepareStop=function(c,d){n(c).addClass("attention"),n(document).one("trinket."+d,function(){n(c).removeClass("attention"),0===--a&&b.nextStop()})},d){d instanceof Array||(d=[d]),a=d.length;for(var e=0;e<d.length;e++)prepareStop(d[e].el,d[e].event)}},onFontSizeClick:function(a,b){this.setFontSize(b&&b.data)},onFullScreenClick:function(a,b){var c=document,d=c.documentElement,e=d.requestFullscreen||d.msRequestFullscreen||d.mozRequestFullScreen||d.webkitRequestFullscreen,f=c.exitFullscreen||c.msExitFullscreen||c.mozCancelFullScreen||c.webkitExitFullscreen;try{if(!e||c.fullscreenElement||c.mozFullScreenElement||c.webkitFullscreenElement||c.msFullscreenElement){if(!f)throw new Error("fullscreen unavailable");f.call(c),this.sendInterfaceAnalytics(a.target,{data:"exit"})}else e.call(d),this.sendInterfaceAnalytics(a.target,{data:"enter"})}catch(a){if(confirm("Your browser does not support fullscreen mode. Would you like to open this trinket in a new window?")){var g=window.location.href;if(this.isModified()){var h="code="+window.encodeURIComponent(this.getValue());g=g.indexOf("#")>0?g.replace(g.substr(g.indexOf("#")+1),h):g+"#"+h}window.open(g)}}},onDownloadClick:function(a,b){var c,d,e,f=this.downloadable(),g=this,i=new JSZip,l=[];n.each(f.assets,function(a,b){c=/^data:image/.test(b.url)?b.url:n("#proxy").val()+"/"+b.url,l.push(h(c,b.name,i))}),n.when.apply(n,l).done(function(){for(d in f.files)i.file(d,f.files[d]);e=g.getTrinketIdentifier(),g._trinket&&g._trinket.name&&(e=g._trinket.name+"-"+e),e="Trinket Download-"+e+".zip",new JSZip.external.Promise(function(a,b){if(o.runtime("downloadExtra")){var c=n("#proxy").val()+"/"+o.runtime("downloadExtra");JSZipUtils.getBinaryContent(c,function(c,d){c?b(c):a(d)})}else a()}).then(function(a){if(a)return i.loadAsync(a)}).then(function(){i.generateAsync({type:"blob"}).then(function(a){saveAs(a,e)},function(a){throw new Error("Could not generate download.")})})}).done(function(){g.callAnalytics("Interaction","Click","Download"),k(f.files,"sense_hat","py")&&g.callAnalytics("Sense Hat Event","Click","Download")}).fail(function(a){j(a,function(){n("#statusMessages .close").click()},function(){n("#statusMessages .close").click()},"alert")})},onUpgradeClick:function(a,b){this.$upgradeModal.foundation("reveal","open")},onLinkClick:function(b){b.preventDefault(),window.open(a(n(b.target).data("href")))},setFontSize:function(a){n(".trinket-content-wrapper").children().css("font-size",a||"1em")},setUI:function(){this._userId=n("#user").val(),this._userId?this._trinket&&this._trinket._owner===this._userId?this._ui="owner":this._queryString.inLibrary?this._ui="library":this._ui="user":this._ui="guest"},toggleUI:function(a){var b=this,c=r(a+"MenuTemplate");n("#userMenu").empty().append(c).foundation(),"guest"===a&&(n("#login").click(g("/api/users/login",b)),n("#register").click(g("/api/users",b))),n(".ui-option").addClass("hide").filter("."+a+"-option").removeClass("hide")},getUIType:function(){return this._ui},getUserId:function(){return this._userId},hasPermission:function(){var a=Array.prototype.slice.call(arguments);return u.hasPermission.apply(this,a)},triggerChange:function(){n(document).trigger("trinket.code.change"),this.trigger("trinket.code.change")},onLoginComplete:function(a,b,c,d){var e=this;if(b&&"success"===b.status){var f=n(a+' input[name="email"]').val();window.TrinketIO.import("debug.sessions").onLogin(f,b.data),this._ui=b.data.id===this._trinket._owner?"owner":"user",this.toggleUI(this._ui),n(document).trigger("trinket.account.success"),n("body").append("<input id='roles' type='hidden' value='"+b.data.roles+"'>"),"console"!==this.getType()&&"guest"!==this.getUIType()&&this._original&&this._original.id&&(n(this).off("trinket.code.change"),n(this).on("trinket.code.change",_.debounce(function(){n(".save-it").removeClass("disabled"),e.updateDraft()},1e3)));var g="create-"+this.getType()+"-trinket",h=!this.hasPermission(g);"owner"===this._ui?(n("a.create-remix").data("action","code.save"),n("a.create-remix").attr("title","Save changes."),n("a.create-remix").find("i").removeClass().addClass("fa fa-save"),n("a.create-remix").find("label").html("Save")):h||n("a.create-remix").data("action","library.add"),h||(n("a.create-copy").data("action","library.add"),n("a.save-remix").data("action","library.add"),n("a.revert-remix").data("action","library.add"))}else b&&b.flash&&b.flash.validation?n(a+" .message").addClass("error").text(b.flash.validation.email||b.flash.validation.password):b&&b.flash&&b.flash.duplicates?n(a+" .message").addClass("error").text("This email is already registered; try logging in."):b&&b.message?n(a+" .message").addClass("error").text(b.message):n(a+" .message").addClass("error").text("We were unable to log you in; please try again later.")},updateSessionCache:function(){var a=this,b=a.getValue();if(b===a._original.code)try{window.sessionStorage&&window.sessionStorage.removeItem(a.guid),q.remove(a.guid)}catch(a){}else try{window.sessionStorage&&window.sessionStorage.setItem(a.guid,b),q.set(a.guid,b,p)}catch(a){}},updateDraft:function(){var a=this;"BROADCASTING"!==window.TrinketAPI._receiverBroadcastState&&a.$draftMessage.fadeOut("fast",function(){a.$draftMessage.text("Saving Draft").fadeIn("slow",function(){a._updateDraft()})})},_updateDraft:function(){var a,b=this,c=b.serialize(),d="/api/trinkets/"+b._original.id+"/draft";a={code:c.code,assets:c.assets,settings:c.settings},n.post(d,a).done(function(a){a.success&&(b._viewingDraft=!0,b.$draftMessage.fadeOut("slow",function(){var a=r("draftTextTemplate",{draftText:"Draft Saved"});b.$draftMessage.html(a).fadeIn("slow")}))})},discardDraft:function(a){var b=this,c="/api/drafts/"+b._original.id;n.ajax({url:c,method:"DELETE"}).done(function(c){c.success&&(JSON.stringify(b._trinket.settings)!==JSON.stringify(b._predraft.settings)&&(b.discardDraftSettings(),o.runtime("settingsModified",!1),b._original_draft&&f(b._predraft.settings||{},!0)),n("#confirmDiscardModal").foundation("reveal","close"),b._original=n.extend(!0,{},b._predraft),b.$draftMessage.fadeOut("fast",function(){b.$draftMessage.empty(),b._viewingDraft=!1,n(".save-it").addClass("disabled")})),a()})},discardDraftSettings:function(){},_viewingOriginal:function(a){return void 0!==a&&(this._viewingOriginalFlag=!!a,a?n("body").addClass("viewing-original"):n("body").removeClass("viewing-original")),this._viewingOriginalFlag},onSaveClick:function(){var a=Date.now();n("body").addClass("saving");var b=function(){var c=Date.now()-a;return c<750?window.setTimeout(b,750-c):void n("body").removeClass("saving")};this._original&&this._original.id?this._viewingOriginal()?this.restore(b):this._original.original?this.save(void 0,b):this.remix(b):this.addToLibrary(b)},keys:function(){return this._keys||(this._keys={code:1,hasError:1,consoleOutput:1,assets:1})},restore:function(a){var b=this,c=r("restoreOriginalModalTemplate",{}),d=n(c);remix=this._original,original=remix.original,n("body").append(d),d.foundation("reveal","open"),d.on("close.fndtn.reveal",function(){a()}),d.find(".button").click(function(){var c,e,f=n(this).data("action"),g={};if("confirm"===f){d.off("close.fndtn.reveal");for(c in b.keys())g[c]=original[c],"code"===c&&(e=JSON.parse(g[c]),e=e.map(function(a){return _.omit(a,"comments")}),g[c]=JSON.stringify(e));n.extend(!0,remix,g),n("#version-toggle").prop("checked",!0).change(),window.setTimeout(function(){b.save(void 0,a),b.updateSessionCache()})}else a();d.foundation("reveal","close"),d.remove()})},remix:function(a){var b=this;b._createCopy("Remix",function(c){n("body").addClass("has-remix"),c.original=b._original,b.setTrinket(c,!0),b.reset(c),"function"==typeof a&&a()})},addToLibrary:function(a){this._createCopy("Copy",function(b){var c=r("statusMessageTemplate",{type:"success",message:'A copy of this trinket has been saved for you. View or edit <a class="text-link" href="/library/trinkets/'+b.shortCode+'" target="_blank">your copy here</a>.'}),d=n(c);n("body").addClass("has-status-bar").append(d),d.parent().foundation().trigger("open.fndtn.alert"),a&&"function"==typeof a&&a(b)})},_createCopy:function(a,b){var c=this,d=c.serialize({removeComments:!0}),e={library:!0},f=c._original&&c._original.id,g=function(d){c.$overlay.addClass("hide"),b&&"function"==typeof b&&b(d),n(".save-it").addClass("disabled"),c.$draftMessage.fadeOut("slow",function(){c.$draftMessage.empty(),c._viewingDraft=!1}),c.callAnalytics("Interaction",a,"Library"),o.runtime("usingSenseHat")&&c.callAnalytics("Sense Hat Event",a,"Library")};n("#statusMessages .close").click(),c.$overlay.removeClass("hide"),f&&(d._origin_id=f),"Remix"==a&&(d._remix=!0),c._trinket.id?c.fork(c._trinket,d,e,g):c.create(d,e,g)},getTrinket:function(a,b){var c=this;return"function"==typeof a&&(b=a,a=void 0),c.isModified()||!c._trinket.id?c._trinket.id?c.fork(c._trinket,c.serialize(),a,b):c.create(c.serialize(),a,b):setTimeout(function(){b(c._trinket)})},setTrinket:function(a,b){b&&(this._original=a),this._trinket=n.extend(!0,{},a)},isModified:function(){var a=this.getValue(),b=a!==(this._trinket.code||"")||this.settingsModified();return b},settingsModified:function(){return o.runtime("settingsModified")},viewingDraft:function(){return this._viewingDraft},getType:function(){throw new Error("getType is not implemented")},getValue:function(){throw new Error("getValue is not implemented")},getMainFile:function(){return""},getShareType:function(){return n("#shareType").val()||this.getType()},serialize:function(a){return{code:this.getValue(a)}},fork:function(a,b,c,d){var e=this,f="/api/trinkets/"+a.id+"/forks";"function"==typeof c&&(d=c,c=void 0),c&&c.library&&(f+="?library=true"),n.post(f,b).done(function(a){e.setTrinket(a.data),n("#emailToken").val(""),e.postSave().then(function(){"function"==typeof d&&d(e._trinket)})})},create:function(a,b,c){var d=this,e="/api/trinkets";"function"==typeof b&&(c=b,b=void 0),b&&b.library&&(e+="?library=true"),a.lang=this.getType(),n.post(e,a).done(function(a){d.setTrinket(a.data),n("#emailToken").val(""),d.postSave().then(function(){"function"==typeof c&&c(d._trinket)})})},save:function(a,b){var c=this,d=(new Date).getTime();a||(a=this.serialize()),c.$overlay.removeClass("hide"),n.ajax({url:"/api/trinkets/"+c._original.id,data:JSON.stringify(a),type:"PATCH",contentType:"application/json"}).done(function(e){n(".save-it").addClass("disabled"),c.$draftMessage.fadeOut("slow",function(){c.$draftMessage.empty(),c._viewingDraft=!1});var f=(new Date).getTime()-d;for(var g in a)c._trinket[g]=a[g];c._original.original&&(c._trinket.original=c._original.original),c._original=c._trinket,setTimeout(function(){c.$overlay.addClass("hide")},Math.max(0,500-f)),"function"==typeof b&&b(),c.postSave()}).fail(function(a,c,d){"function"==typeof b&&b({responseText:a.responseText,status:c,error:d})})},onResetClick:function(a){var b=this;this.$resetModal.foundation("reveal","close");var c=function(){b.setTrinket(b._original),b.reset(b._trinket),n(document).trigger("trinket.resetted")};this.viewingDraft()?this.discardDraft(c):c();try{window.sessionStorage&&window.sessionStorage.removeItem(this.guid),q.remove(this.guid)}catch(a){}this.callAnalytics("Interaction","Click","Reset"),o.runtime("usingSenseHat")&&this.callAnalytics("Sense Hat Event","Click","Reset"),n(".file-name-error").length&&n(".file-name-error").find(".close").trigger("click")},reset:function(a){},focus:function(){},onUpdateClick:function(){this.save(this.serialize())},onShareClick:function(b){var c=this,d=[],e="";b.isDefaultPrevented()||c.getTrinket(function(b){var f=c.getShareInfo(b),g=a(f.url);n("#runOptionLink").data("trinket-shortCode",b.shortCode),n("#runOptionLink").data("trinket-runMode",c.runMode),n("#displayOptionLink").data("trinket-shortCode",b.shortCode),n("#displayOptionLink").data("trinket-runMode",c.runMode),n("#displayOptionLink").val()&&d.push(n("#displayOptionLink").val()+"=true"),n("#runOptionLink").val()&&d.push("runOption="+n("#runOptionLink").val()),c.runMode&&d.push("runMode="+c.runMode),d.length&&(e="?"+d.join("&")),g=g.replace(b.shortCode,b.shortCode+e),m&&m.toolbox&&m.toolbox("#addthis",{},{url:g}),c.$shareUrl.text(g),c.$shareModal.foundation("reveal","open"),c.sendAnalytics("Navigation",{action:"View Modal",label:"share"},{name:"Snippet Modal Viewed",modalType:"share"})})},onEmailClick:function(b){var c=this;b.isDefaultPrevented()||c.getTrinket(function(b){var d=c.getShareInfo(b),e=a(d.url);c.$shareUrl.text(e),c.$emailModal.foundation("reveal","open"),c.sendAnalytics("Navigation",{action:"View Modal",label:"email"},{name:"Snippet Modal Viewed",modalType:"email"})})},getShareInfo:function(a){return{url:"/"+this.getShareType()+"/"+this.getTrinketIdentifier(a)}},onShareFocus:function(a){s.byId("shareUrl"),this.updateMetric("linkShares"),this.sendAnalytics("Shares",{action:"Focus",label:"link"},{name:"Snippet Shared",shareType:"link"})},onEmbedClick:function(b){var c=this,d=[],e="";b.isDefaultPrevented()||c.getTrinket(function(b){var f=c.getEmbedInfo(b),g=a(f.url),h='<iframe src="'+g+'" width="100%" height="'+(f.height||356)+'" frameborder="0" marginwidth="0" marginheight="0" allowfullscreen></iframe>';n("#runOptionEmbed").data("trinket-shortCode",b.shortCode),n("#runOptionEmbed").data("trinket-runMode",c.runMode),n("#displayOptionEmbed").data("trinket-shortCode",b.shortCode),n("#displayOptionEmbed").data("trinket-runMode",c.runMode),n("#displayOptionEmbed").val()&&d.push(n("#displayOptionEmbed").val()+"=true"),n("#runOptionEmbed").val()&&d.push("runOption="+n("#runOptionEmbed").val()),n("#autorunEmbedToggle").is(":checked")&&d.push("start=result"),c.runMode&&d.push("runMode="+c.runMode),d.length&&(e="?"+d.join("&")),h=h.replace(b.shortCode,b.shortCode+e),c.$embedCode.text(h),c.$embedModal.foundation("reveal","open"),c.sendAnalytics("Navigation",{action:"View Modal",label:"embed"},{name:"Snippet Modal Viewed",modalType:"embed"})})},onGroupPostClick:function(a){try{window.parent.groups.post(this.serialize())}catch(a){console.log(a)}},onGroupSubmitClick:function(a){try{window.parent.groups.submit(this.serialize())}catch(a){console.log(a)}},getEmbedInfo:function(a){var b="/"+this.getTrinketIdentifier(a);return{url:"/embed/"+this.getType()+b,height:356}},onEmbedFocus:function(a){s.byId("embedCode"),this.updateMetric("embedShares"),this.sendAnalytics("Shares",{action:"Focus",label:"embed"},{name:"Snippet Shared",shareType:"embed"})},updateMetric:function(a,b){var c=n("body").data("no-metrics");if(a&&!c&&this._trinket&&this._trinket.id){if(b){var d=CryptoJS.MD5(b);b=d.toString(CryptoJS.enc.Hex)}else b=this._trinket.id;if(this._updates[a]||(this._updates[a]={}),!this._updates[a][b]){this._updates[a][b]=!0;var e={};e[a]=!0,n.ajax({type:"PATCH",url:"/api/trinkets/"+this._trinket.id+"/metrics",dataType:"json",data:e})}}},onLogoClick:function(b){var c=this;b.preventDefault(),c.getTrinket(function(b){var d=c.getShareInfo(b);c.sendAnalytics("Navigation",{action:"Click",label:"Logo"},{name:"Snippet Logo Clicked"}),window.open(a(d.url))})},onGalleryClick:function(b){b.preventDefault(),window.open(a("/gallery"))},onNotificationClick:function(a){a.preventDefault();var b=this;this._notification_open?n("#notification-content").animate({"margin-top":"-100%"},400,function(){b._notification_open=!1}):n("#notification-content").animate({"margin-top":0},400,function(){b._notification_open=!0,b.sendAnalytics("Navigation",{action:"Click",label:"Notification"},{name:"Snippet Notification Clicked"})})},onSendEmailClick:function(a){var b=this;if(a.preventDefault(),n("#share-email").val()&&n("#share-yourname").val()&&n("#share-youremail").val())n(".close").click(),n("#sendEmail").attr("value","Sending ..."),n("#sendEmail").addClass("disabled"),n.post("/api/trinkets/"+b._trinket.id+"/email",{email:n("#share-email").val(),name:n("#share-yourname").val(),replyTo:n("#share-youremail").val(),token:n("#emailToken").val()}).done(function(a){b.$emailModal.foundation("reveal","close");var c='<div data-alert class="alert-box success"> Your email was sent! Thanks for sharing! <a href="#" class="close">&times;</a></div>';
n("#flashMessage").show(),n("#flashContent").html(c),n(document).foundation("alert"),n("#share-email").val(""),n("#sendEmail").attr("value","Send"),n("#sendEmail").removeClass("disabled"),setTimeout(function(){n("#flashMessage .close").trigger("click")},3e3),b.sendAnalytics("Shares",{action:"Send Email"},{name:"Snippet Email Sent"})}).fail(function(a,b,c){var d='<div data-alert class="alert-box warning"> There was a problem sending your email. Please try again later. <a href="#" class="close">&times;</a></div>';n("#emailAlert").show().html(d),n(document).foundation("alert")});else{var c='<div data-alert class="alert-box warning"> Please complete all fields to send your email. <a href="#" class="close">&times;</a></div>';n("#emailAlert").show().html(c),n(document).foundation("alert")}},onSocialShare:function(a){var b=a.data.service;this.sendAnalytics("Shares",{action:"Click Social",label:b},{name:"Snippet Social Clicked",service:b})},getAnalyticsCategory:function(){return"Snippet"},sendInterfaceAnalytics:function(a,b){b||(b={});var c=n(a),d=c.data("action")||b.action,e=c.data("data")||b.data,f=c.closest("[data-interface]").data("interface")||b.interface,g=c.data("library-override")||!1,h=this.$responsiveIndicators.filter(function(a){return"none"!==n(this).css("display")}).data("size")||"",i=[h,f,d.replace(/\./g,"-")];e&&i.push(e),i=i.join(" ").replace(/[a-zA-Z0-9](?:[^\s\-\._]*)/g,function(a){return a.charAt(0).toUpperCase()+a.substr(1)}),this.sendAnalytics("Interface",{action:i,label:this.getTrinketIdentifier()},g)},sendAnalytics:function(a,b,c){var d,e=this,f=e.getEmbedInfo(e._trinket),g=e._queryString&&e._queryString.inLibrary;b=n.extend({category:"Embedded "+e.getAnalyticsCategory()+" "+a},b,{data:{page:f.url}}),d=["send","event",b.category,b.action],b.label&&d.push(b.label),b.value&&d.push(b.value),b.data&&d.push(b.data),window.ga&&(!g||g&&c)&&window.ga.apply(null,d)},callAnalytics:function(a,b,c){this.sendAnalytics(a,{action:b,label:c})},toggleOverlay:function(a){n(a).toggleClass("hide"),n(a).hasClass("hide")?(this.hasOverlay=!1,this.onCloseOverlay()):(this.hasOverlay=!0,this.onOpenOverlay())},closeOverlay:function(a){n(a).addClass("hide"),this.hasOverlay=!1},closeAnyModal:function(){n(".close-reveal-modal").is(":visible")&&n(".close-reveal-modal").click()},closeAnyMessage:function(){n(".close").is(":visible")&&n(".close").click()},draggable:function(a){var b=(n("#dragbar").width(),n("#editor")),c=this;n(document).on("mousedown.dragbar","#dragbar",function(d){d.preventDefault();var e=n(".trinket-content-wrapper").width();n("#content-overlay").show(),c.dragging=!0;var f=n("<div>",{id:"ghostbar",css:{height:b.outerHeight(),top:b.offset().top,left:b.offset().left}}).appendTo("body");n(document).on("mousemove.dragbar",function(b){var c=b.pageX/e,d=(e-b.pageX)/e;c>=.3&&d>=.25&&(f.css("left",b.pageX+2),n("#editor").css("width",b.pageX+2),a&&a())}),n(document).one("mouseup.dragbar",function(a){n("#content-overlay").hide(),c.dragging&&(n("#ghostbar").remove(),n(document).off("mousemove.dragbar"),c.dragging=!1)})})},toggleAll:function(){},onOpenOverlay:function(){},onCloseOverlay:function(){},postSave:function(){function a(){return b.resolve()}var b=n.Deferred(),c=this,d=c._trinket.shortCode;return c.saveClientSnapshot()?(c.captureAndSaveSnapshot(function(b){return b?void n.post("/api/trinkets/"+d+"/snapshot",{snapshotData:b}).done(a):a()}),b):a()},saveClientSnapshot:function(){return!1},isDirty:function(){return!!this._trinket&&!(this.getValue()===this._original.code)},destroy:function(){this._trinket=void 0},getTrinketIdentifier:function(a){return a||(a=this._trinket),a.shortCode?a.shortCode:CryptoJS.MD5(a.code).toString(CryptoJS.enc.Hex)},getTrinketIdentifierOrNull:function(){var a=null;return this._trinket&&(a=this._trinket.original?this._trinket.original.shortCode:this._trinket.shortCode),a},logError:function(a){a.lang=this.getType(),window.__experiment_name_errors_id&&("NameError"===a.type&&(window.optimizely=window.optimizely||[],window.optimizely.push(["trackEvent","PythonNameError"])),a.label=(a.label?a.label+" ":"")+window.__experiment_name_errors_id),this._trinket&&this._trinket.shortCode&&(a.shortCode=this._trinket.shortCode),n.post("/api/trinkets/codeerror",a).done(function(){})},triggerRunModeChange:function(){n(document).trigger("trinket.runMode.change",{runMode:this.runMode}),this.trigger("trinket.runMode.change",{runMode:this.runMode})},settingsChange:function(a){var b,c=n(a.target)[0].type;this._trinket.settings=n.extend(!0,{},this._trinket.settings),"checkbox"===c?b=n(a.target).is(":checked"):"range"!==c&&"hidden"!==c||(b=n(a.target).val()),"undefined"!=typeof b&&(this._trinket.settings[a.target.id]=b,o.runtime("settingsModified",!0)),n(a.target).data("settings-action")&&"function"==typeof this[n(a.target).data("settings-action")]&&this[n(a.target).data("settings-action")](),n(a.target).data("skip-trigger")?n(a.target).removeData("skip-trigger"):this.triggerChange()},showOutput:function(){n("#codeOutput").removeClass("hide"),n("#editor").addClass("hide"),this.closeOverlay("#modules"),n("#instructionsContainer").addClass("hide"),n("#outputContainer").removeClass("hide"),n("#codeOutputTab").addClass("active"),n("#instructionsTab").removeClass("active")},showInstructions:function(){n("#codeOutput").removeClass("hide"),n("#editor").addClass("hide"),this.closeOverlay("#modules"),this.parsedInstructions||this.displayInstructions(),n("#outputContainer").addClass("hide"),n("#blocklyCodeContainer").addClass("hide"),n("#instructionsContainer").removeClass("hide"),n("#codeViewTab").removeClass("active"),n("#codeOutputTab").removeClass("active"),n("#instructionsTab").addClass("active")},displayInstructions:function(){var a=this;a._trinket.description||"owner"!==a.getUIType()?a.parsedInstructions=v(a._trinket.description):a.parsedInstructions=r("addInstructionsTemplate"),n("#instructionsOutput").html(a.parsedInstructions),n("#instructionsActions").length&&n("#instructionsActions").removeClass("hide")},onEditInstructionsClick:function(){var a=this;n("#instructionsActions").addClass("hide"),n("#instructionsToolbar").removeClass("hide"),n("#instructionsContainer").addClass("editor"),a.parsedInstructions=r("editInstructionsTemplate"),n("#instructionsOutput").empty(),n("#instructionsContainer").append(a.parsedInstructions);var b=n("#instructionsContainer").height();l=ace.edit("embedded-instructions");var c=b-65;n("#embedded-instructions").height(c+"px"),l.resize(),l.$blockScrolling=1/0,l.setTheme("ace/theme/xcode"),l.getSession().setMode("ace/mode/markdown"),l.getSession().setUseSoftTabs(!0),l.getSession().setTabSize(2),l.setShowPrintMargin(!1),l.setValue(a._trinket.description,-1)},onCancelEditInstructionsClick:function(){var a=this;n("#instructionsContainer").removeClass("editor"),n("#instructionsToolbar").addClass("hide"),n("#instructionsActions").removeClass("hide"),l&&l.destroy(),n("#embedded-instructions").remove(),a.displayInstructions()},onSaveInstructionsClick:function(a){var b=this,c=l.getValue();n("#save-instructions").find("i").removeClass().addClass("fa fa-circle-o-notch fa-spin"),n.ajax({url:"/api/trinkets/"+b._original.id,data:JSON.stringify({description:c}),type:"PATCH",contentType:"application/json"}).done(function(a){setTimeout(function(){n("#save-instructions").find("i").removeClass().addClass("fa fa-save"),b._trinket.description=c,n("#instructionsContainer").removeClass("editor"),n("#instructionsToolbar").addClass("hide"),n("#instructionsActions").removeClass("hide"),l&&l.destroy(),n("#embedded-instructions").remove(),b.displayInstructions()},500)}).fail(function(a,b,c){})}},window.TrinketAPI),window.TrinketApp=new i(window.trinketObject,window.draftObject)}),function(a,b){"use strict";function c(a){e(document.getElementById(a))}function d(a){$("."+a).click(function(a){e($(a.target)[0])})}function e(b){if(document.selection){var c=document.body.createTextRange();c.moveToElementText(b),c.select()}else if(a.getSelection){var c=document.createRange();c.selectNodeContents(b),a.getSelection().removeAllRanges(),a.getSelection().addRange(c)}}b.export("utils.selectText",{byId:c,byClass:d})}(window,window.TrinketIO),function(a,b){function c(){var b={outputOnly:"",toggleCode:"",runOption:"",start:"",runMode:""};$("input:checkbox.autorunToggle").change(function(a){var c,d=$(event.target),e=$(d).val(),f=$("#"+e),g=f.text(),h=$(d).prev().data("trinket-shortCode"),i=[],j="",k=new RegExp(h+'[^"]*"'),l='"';$(d).is(":checked")?b.start="result":b.start="",b.runMode=$(d).prev().data("trinket-runMode")||"";for(var m in b)b[m]&&i.push(m+"="+b[m]);i.length&&(j="?"+i.join("&")),c=g.replace(k,h+j+l),f.text(c)}),$(":input.runOptions").change(function(c){var d,e,f,g=$(event.target),h=$(g).data("type"),i=$(g).val(),j=$("#"+h),k=j.text(),l=$(g).data("trinket-shortCode"),m=[],n="";"shareUrl"===h?(d=new RegExp(l+".*"),e=""):(d=new RegExp(l+'[^"]*"'),e='"'),b.runOption=i,b.runMode=$(g).data("trinket-runMode")||"";for(var o in b)b[o]&&m.push(o+"="+b[o]);m.length&&(n="?"+m.join("&")),f=k.replace(d,l+n+e),j.text(f),"shareUrl"===h&&a.addthis&&a.addthis.toolbox&&a.addthis.toolbox("#addthis",{},{url:f})}),$(":input.displayOptions").change(function(c){var d,e,f,g=$(event.target),h=$(g).data("type"),i=$(g).val(),j=$("#"+h),k=j.text(),l=$(g).data("trinket-shortCode"),m=[],n="";"shareUrl"===h?(d=new RegExp(l+".*"),e=""):(d=new RegExp(l+'[^"]*"'),e='"'),b.outputOnly="",b.toggleCode="",i&&"undefined"!=typeof b[i]&&(b[i]="true"),b.runMode=$(g).data("trinket-runMode")||"";for(var o in b)b[o]&&m.push(o+"="+b[o]);m.length&&(n="?"+m.join("&")),f=k.replace(d,l+n+e),j.text(f),"shareUrl"===h&&a.addthis&&a.addthis.toolbox&&a.addthis.toolbox("#addthis",{},{url:f})})}b.export("trinket.share",{init:c})}(window,window.TrinketIO),function(a){function b(){if("undefined"==typeof g&&$("#roles").length&&$("#roles").val().length)try{var a=$("#roles").val().split("+"),b=a[0],c=a.slice(1).join("+"),d=CryptoJS.AES.decrypt(c,b);g=JSON.parse(CryptoJS.enc.Utf8.stringify(d))}catch(a){console.log("roles decrypt error:",a)}}function c(a,c,d){b(),d=_.extend(d||{}),c||(c="site"),d.id&&(c=c+":"+d.id);var e=_.find(g,function(a){return a.context===c});return!!(e&&e.permissions.indexOf(a)>=0)&&(!e.thru||!e.thru[a]||moment().isBefore(e.thru[a]))}function d(a,c,d){b(),d=_.extend(d||{}),c||(c="site"),d.id&&(c=c+":"+d.id);var e=_.find(g,function(a){return a.context===c});return!!(e&&e.roles.indexOf(a)>=0)&&(!e.thru||!e.thru[a]||moment().isBefore(e.thru[a]))}function e(){var a=!1,c=this;return b(),g&&g.forEach(function(b){/^group/.test(b.context)&&c.hasRole("group-member",b.context)&&(a=!0)}),a}function f(a){var c={};return b(),g&&(c=_.find(g,function(b){return b.context===a})),c}var g;a.export("trinket.roles",{hasPermission:c,hasRole:d,inGroup:e,getByContext:f})}(window.TrinketIO),function(a){"function"==typeof define&&define.amd?define(["jquery"],a):a(jQuery)}(function(a){var b=0,c=Array.prototype.slice;return a.cleanData=function(b){return function(c){var d,e,f;for(f=0;null!=(e=c[f]);f++)try{d=a._data(e,"events"),d&&d.remove&&a(e).triggerHandler("remove")}catch(a){}b(c)}}(a.cleanData),a.widget=function(b,c,d){var e,f,g,h,i={},j=b.split(".")[0];return b=b.split(".")[1],e=j+"-"+b,d||(d=c,c=a.Widget),a.expr[":"][e.toLowerCase()]=function(b){return!!a.data(b,e)},a[j]=a[j]||{},f=a[j][b],g=a[j][b]=function(a,b){return this._createWidget?void(arguments.length&&this._createWidget(a,b)):new g(a,b)},a.extend(g,f,{version:d.version,_proto:a.extend({},d),_childConstructors:[]}),h=new c,h.options=a.widget.extend({},h.options),a.each(d,function(b,d){return a.isFunction(d)?void(i[b]=function(){var a=function(){return c.prototype[b].apply(this,arguments)},e=function(a){return c.prototype[b].apply(this,a)};return function(){var b,c=this._super,f=this._superApply;return this._super=a,this._superApply=e,b=d.apply(this,arguments),this._super=c,this._superApply=f,b}}()):void(i[b]=d)}),g.prototype=a.widget.extend(h,{widgetEventPrefix:f?h.widgetEventPrefix||b:b},i,{constructor:g,namespace:j,widgetName:b,widgetFullName:e}),f?(a.each(f._childConstructors,function(b,c){var d=c.prototype;a.widget(d.namespace+"."+d.widgetName,g,c._proto)}),delete f._childConstructors):c._childConstructors.push(g),a.widget.bridge(b,g),g},a.widget.extend=function(b){for(var d,e,f=c.call(arguments,1),g=0,h=f.length;h>g;g++)for(d in f[g])e=f[g][d],f[g].hasOwnProperty(d)&&void 0!==e&&(b[d]=a.isPlainObject(e)?a.isPlainObject(b[d])?a.widget.extend({},b[d],e):a.widget.extend({},e):e);return b},a.widget.bridge=function(b,d){var e=d.prototype.widgetFullName||b;a.fn[b]=function(f){var g="string"==typeof f,h=c.call(arguments,1),i=this;return f=!g&&h.length?a.widget.extend.apply(null,[f].concat(h)):f,g?this.each(function(){var c,d=a.data(this,e);return"instance"===f?(i=d,!1):d?a.isFunction(d[f])&&"_"!==f.charAt(0)?(c=d[f].apply(d,h),c!==d&&void 0!==c?(i=c&&c.jquery?i.pushStack(c.get()):c,!1):void 0):a.error("no such method '"+f+"' for "+b+" widget instance"):a.error("cannot call methods on "+b+" prior to initialization; attempted to call method '"+f+"'")}):this.each(function(){var b=a.data(this,e);b?(b.option(f||{}),b._init&&b._init()):a.data(this,e,new d(f,this))}),i}},a.Widget=function(){},a.Widget._childConstructors=[],a.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",defaultElement:"<div>",options:{disabled:!1,create:null},_createWidget:function(c,d){d=a(d||this.defaultElement||this)[0],this.element=a(d),this.uuid=b++,this.eventNamespace="."+this.widgetName+this.uuid,this.bindings=a(),this.hoverable=a(),this.focusable=a(),d!==this&&(a.data(d,this.widgetFullName,this),this._on(!0,this.element,{remove:function(a){a.target===d&&this.destroy()}}),this.document=a(d.style?d.ownerDocument:d.document||d),this.window=a(this.document[0].defaultView||this.document[0].parentWindow)),this.options=a.widget.extend({},this.options,this._getCreateOptions(),c),this._create(),this._trigger("create",null,this._getCreateEventData()),this._init()},_getCreateOptions:a.noop,_getCreateEventData:a.noop,_create:a.noop,_init:a.noop,destroy:function(){this._destroy(),this.element.unbind(this.eventNamespace).removeData(this.widgetFullName).removeData(a.camelCase(this.widgetFullName)),this.widget().unbind(this.eventNamespace).removeAttr("aria-disabled").removeClass(this.widgetFullName+"-disabled ui-state-disabled"),this.bindings.unbind(this.eventNamespace),this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus")},_destroy:a.noop,widget:function(){return this.element},option:function(b,c){var d,e,f,g=b;if(0===arguments.length)return a.widget.extend({},this.options);if("string"==typeof b)if(g={},d=b.split("."),b=d.shift(),d.length){for(e=g[b]=a.widget.extend({},this.options[b]),f=0;d.length-1>f;f++)e[d[f]]=e[d[f]]||{},e=e[d[f]];if(b=d.pop(),1===arguments.length)return void 0===e[b]?null:e[b];e[b]=c}else{if(1===arguments.length)return void 0===this.options[b]?null:this.options[b];g[b]=c}return this._setOptions(g),this},_setOptions:function(a){var b;for(b in a)this._setOption(b,a[b]);return this},_setOption:function(a,b){return this.options[a]=b,"disabled"===a&&(this.widget().toggleClass(this.widgetFullName+"-disabled",!!b),b&&(this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus"))),this},enable:function(){return this._setOptions({disabled:!1})},disable:function(){return this._setOptions({disabled:!0})},_on:function(b,c,d){var e,f=this;"boolean"!=typeof b&&(d=c,c=b,b=!1),d?(c=e=a(c),this.bindings=this.bindings.add(c)):(d=c,c=this.element,e=this.widget()),a.each(d,function(d,g){function h(){return b||f.options.disabled!==!0&&!a(this).hasClass("ui-state-disabled")?("string"==typeof g?f[g]:g).apply(f,arguments):void 0}"string"!=typeof g&&(h.guid=g.guid=g.guid||h.guid||a.guid++);var i=d.match(/^([\w:-]*)\s*(.*)$/),j=i[1]+f.eventNamespace,k=i[2];k?e.delegate(k,j,h):c.bind(j,h)})},_off:function(b,c){c=(c||"").split(" ").join(this.eventNamespace+" ")+this.eventNamespace,b.unbind(c).undelegate(c),this.bindings=a(this.bindings.not(b).get()),this.focusable=a(this.focusable.not(b).get()),this.hoverable=a(this.hoverable.not(b).get())},_delay:function(a,b){function c(){return("string"==typeof a?d[a]:a).apply(d,arguments)}var d=this;return setTimeout(c,b||0)},_hoverable:function(b){this.hoverable=this.hoverable.add(b),this._on(b,{mouseenter:function(b){a(b.currentTarget).addClass("ui-state-hover")},mouseleave:function(b){a(b.currentTarget).removeClass("ui-state-hover")}})},_focusable:function(b){this.focusable=this.focusable.add(b),this._on(b,{focusin:function(b){a(b.currentTarget).addClass("ui-state-focus")},focusout:function(b){a(b.currentTarget).removeClass("ui-state-focus")}})},_trigger:function(b,c,d){var e,f,g=this.options[b];if(d=d||{},c=a.Event(c),c.type=(b===this.widgetEventPrefix?b:this.widgetEventPrefix+b).toLowerCase(),c.target=this.element[0],f=c.originalEvent)for(e in f)e in c||(c[e]=f[e]);return this.element.trigger(c,d),!(a.isFunction(g)&&g.apply(this.element[0],[c].concat(d))===!1||c.isDefaultPrevented())}},a.each({show:"fadeIn",hide:"fadeOut"},function(b,c){a.Widget.prototype["_"+b]=function(d,e,f){"string"==typeof e&&(e={effect:e});var g,h=e?e===!0||"number"==typeof e?c:e.effect||c:b;e=e||{},"number"==typeof e&&(e={duration:e}),g=!a.isEmptyObject(e),e.complete=f,e.delay&&d.delay(e.delay),g&&a.effects&&a.effects.effect[h]?d[b](e):h!==b&&d[h]?d[h](e.duration,e.easing,f):d.queue(function(c){a(this)[b](),f&&f.call(d[0]),c()})}}),a.widget}),function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L=function(a,b){return function(){return a.apply(b,arguments)}},M=[].slice;a=jQuery,H=0,I=1,J=2,y=13,E=9,v=46,u=8,A=37,D=39,F=38,w=40,z=36,x=35,C=33,B=34,i="jqconsole-",e=""+i+"cursor",f=""+i+"header",j=""+i+"prompt",h=""+i+"old-prompt",g=""+i+"input",d=""+i+"blurred",s="keypress",p="<span/>",n="<div/>",o=":empty",G="\n",m=">>> ",l="... ",k=2,c=""+i+"ansi-",q="",r=/\[(\d*)(?:;(\d*))*m/,b=function(){function a(){this.stylize=L(this.stylize,this),this._closeSpan=L(this._closeSpan,this),this._openSpan=L(this._openSpan,this),this.getClasses=L(this.getClasses,this),this._style=L(this._style,this),this._color=L(this._color,this),this._remove=L(this._remove,this),this._append=L(this._append,this),this.klasses=[]}return a.prototype.COLORS=["black","red","green","yellow","blue","magenta","cyan","white"],a.prototype._append=function(a){if(a=""+c+a,this.klasses.indexOf(a)===-1)return this.klasses.push(a)},a.prototype._remove=function(){var a,b,d,e,f,g;for(d=1<=arguments.length?M.call(arguments,0):[],g=[],e=0,f=d.length;e<f;e++)b=d[e],"fonts"===b||"color"===b||"background-color"===b?g.push(this.klasses=function(){var d,e,f,g;for(f=this.klasses,g=[],d=0,e=f.length;d<e;d++)a=f[d],a.indexOf(b)!==c.length&&g.push(a);return g}.call(this)):(b=""+c+b,g.push(this.klasses=function(){var c,d,e,f;for(e=this.klasses,f=[],c=0,d=e.length;c<d;c++)a=e[c],a!==b&&f.push(a);return f}.call(this)));return g},a.prototype._color=function(a){return this.COLORS[a]},a.prototype._style=function(a){if(""===a&&(a=0),a=parseInt(a),!isNaN(a))switch(a){case 0:return this.klasses=[];case 1:return this._append("bold");case 2:return this._append("lighter");case 3:return this._append("italic");case 4:return this._append("underline");case 5:return this._append("blink");case 6:return this._append("blink-rapid");case 8:return this._append("hidden");case 9:return this._append("line-through");case 10:return this._remove("fonts");case 11:case 12:case 13:case 14:case 15:case 16:case 17:case 18:case 19:return this._remove("fonts"),this._append("fonts-"+(a-10));case 20:return this._append("fraktur");case 21:return this._remove("bold","lighter");case 22:return this._remove("bold","lighter");case 23:return this._remove("italic","fraktur");case 24:return this._remove("underline");case 25:return this._remove("blink","blink-rapid");case 28:return this._remove("hidden");case 29:return this._remove("line-through");case 30:case 31:case 32:case 33:case 34:case 35:case 36:case 37:return this._remove("color"),this._append("color-"+this._color(a-30));case 39:return this._remove("color");case 40:case 41:case 42:case 43:case 44:case 45:case 46:case 47:return this._remove("background-color"),this._append("background-color-"+this._color(a-40));case 49:return this._remove("background-color");case 51:return this._append("framed");case 53:return this._append("overline");case 54:return this._remove("framed");case 55:return this._remove("overline")}},a.prototype.getClasses=function(){return this.klasses.join(" ")},a.prototype._openSpan=function(a){return'<span class="'+this.getClasses()+'">'+a},a.prototype._closeSpan=function(a){return""+a+"</span>"},a.prototype.stylize=function(a){var b,c,d,e,f,g;for(a=this._openSpan(a),d=0;(d=a.indexOf(q,d))&&d!==-1;)if(c=a.slice(d).match(r)){for(g=c.slice(1),e=0,f=g.length;e<f;e++)b=g[e],this._style(b);a=this._closeSpan(a.slice(0,d))+this._openSpan(a.slice(d+1+c[0].length))}else d++;return this._closeSpan(a)},a}(),K=function(a,b){return'<span class="'+a+'">'+(b||"")+"</span>"},t=function(){function c(c,d,e,g){this._HideComposition=L(this._HideComposition,this),this._ShowComposition=L(this._ShowComposition,this),this._UpdateComposition=L(this._UpdateComposition,this),this._EndComposition=L(this._EndComposition,this),this._StartComposition=L(this._StartComposition,this),this._CheckComposition=L(this._CheckComposition,this),this._ProcessMatch=L(this._ProcessMatch,this),this._HandleKey=L(this._HandleKey,this),this._HandleChar=L(this._HandleChar,this),this.isMobile=!!navigator.userAgent.match(/iPhone|iPad|iPod|Android/i),this.isIos=!!navigator.userAgent.match(/iPhone|iPad|iPod/i),this.isAndroid=!!navigator.userAgent.match(/Android/i),this.$window=a(window),this.header=d||"",this.prompt_label_main="string"==typeof e?e:m,this.prompt_label_continue=g||l,this.indent_width=k,this.state=I,this.input_queue=[],this.input_callback=null,this.multiline_callback=null,this.history=[],this.history_index=0,this.history_new="",this.history_active=!1,this.shortcuts={},this.$container=a("<div/>").appendTo(c),this.$container.css({top:0,left:0,right:0,bottom:0,position:"absolute",overflow:"auto"}),this.$console=a('<pre class="jqconsole"/>').appendTo(this.$container),this.$console.css({margin:0,position:"relative","min-height":"100%","box-sizing":"border-box","-moz-box-sizing":"border-box","-webkit-box-sizing":"border-box"}),this.$console_focused=!0,this.$input_container=a(n).appendTo(this.$container),this.$input_container.css({position:"absolute",width:1,height:0,overflow:"hidden"}),this.$input_source=a(this.isAndroid?"<input/>":"<textarea/>"),this.$input_source.attr({wrap:"off",autocapitalize:"off",autocorrect:"off",spellcheck:"false",autocomplete:"off"}),this.$input_source.css({position:"absolute",width:2}),this.$input_source.appendTo(this.$input_container),this.$composition=a(n),this.$composition.addClass(""+i+"composition"),this.$composition.css({display:"inline",position:"relative"}),this.matchings={openings:{},closings:{},clss:[]},this.ansi=new b,this._InitPrompt(),this._SetupEvents(),this.Write(this.header,f),a(c).data("jqconsole",this)}return c.prototype.ResetHistory=function(){return this.SetHistory([])},c.prototype.ResetShortcuts=function(){return this.shortcuts={}},c.prototype.ResetMatchings=function(){return this.matchings={openings:{},closings:{},clss:[]}},c.prototype.Reset=function(){this.state!==I&&this.ClearPromptText(!0),this.state=I,this.input_queue=[],this.input_callback=null,this.multiline_callback=null,this.ResetHistory(),this.ResetShortcuts(),this.ResetMatchings(),this.$prompt.detach(),this.$input_container.detach(),this.$console.html(""),this.$prompt.appendTo(this.$console),this.$input_container.appendTo(this.$container),this.Write(this.header,f)},c.prototype.GetHistory=function(){return this.history},c.prototype.SetHistory=function(a){return this.history=a.slice(),this.history_index=this.history.length},c.prototype._CheckKeyCode=function(a){if(a=isNaN(a)?a.charCodeAt(0):parseInt(a,10),!(0<a&&a<256)||isNaN(a))throw new Error("Key code must be a number between 0 and 256 exclusive.");return a},c.prototype._LetterCaseHelper=function(a,b){if(b(a),65<=a&&a<=90&&b(a+32),97<=a&&a<=122)return b(a-32)},c.prototype.RegisterShortcut=function(a,b){var c;if(a=this._CheckKeyCode(a),"function"!=typeof b)throw new Error("Callback must be a function, not "+b+".");c=function(a){return function(c){return c in a.shortcuts||(a.shortcuts[c]=[]),a.shortcuts[c].push(b)}}(this),this._LetterCaseHelper(a,c)},c.prototype.UnRegisterShortcut=function(a,b){var c;a=this._CheckKeyCode(a),c=function(a){return function(c){if(c in a.shortcuts)return b?a.shortcuts[c].splice(a.shortcuts[c].indexOf(b),1):delete a.shortcuts[c]}}(this),this._LetterCaseHelper(a,c)},c.prototype.GetColumn=function(){var a;return this.$prompt_right.detach(),this.$prompt_cursor.text(""),a=this.$console.text().split(G),this.$prompt_cursor.html("&nbsp;"),this.$prompt_cursor.after(this.$prompt_right),a[a.length-1].length},c.prototype.GetLine=function(){return this.$console.text().split(G).length-1},c.prototype.ClearPromptText=function(a){if(this.state===I)throw new Error("ClearPromptText() is not allowed in output state.");this.$prompt_before.html(""),this.$prompt_after.html(""),this.$prompt_label.text(a?"":this._SelectPromptLabel(!1)),this.$prompt_left.text(""),this.$prompt_right.text("")},c.prototype.GetPromptText=function(b){var c,d,e,f,g;if(this.state===I)throw new Error("GetPromptText() is not allowed in output state.");return b?(this.$prompt_cursor.text(""),g=this.$prompt.text(),this.$prompt_cursor.html("&nbsp;"),g):(f=function(b){var c;return c=[],b.children().each(function(){return c.push(a(this).children().last().text())}),c.join(G)},d=f(this.$prompt_before),d&&(d+=G),e=this.$prompt_left.text()+this.$prompt_right.text(),c=f(this.$prompt_after),c&&(c=G+c),d+e+c)},c.prototype.SetPromptText=function(a){if(this.state===I)throw new Error("SetPromptText() is not allowed in output state.");this.ClearPromptText(!1),this._AppendPromptText(a),this._ScrollToEnd()},c.prototype.SetPromptLabel=function(b,c){var d;this.prompt_label_main=b,d=">span+span>span:first-child",a("."+j+d).text(b),null!=c&&(this.prompt_label_continue=c)},c.prototype.UpdatePromptLabel=function(){var b,c;return c=">span+span>span:first-child",b="."+j+c,a(b).text(this.prompt_label_main)},c.prototype.Write=function(b,c,d){var e;return null==d&&(d=!0),d&&(b=this.ansi.stylize(a(p).text(b).html())),e=a(p).html(b),null!=c&&e.addClass(c),this.Append(e)},c.prototype.Append=function(b){var c;return c=a(b).insertBefore(this.$prompt),this._ScrollToEnd(),this.$prompt_cursor.detach().insertAfter(this.$prompt_left),c},c.prototype.Input=function(a){var b,c,d,e;if(this.state===J)d=this.input_callback,e=this.multiline_callback,c=this.history_active,b=this.async_multiline,this.AbortPrompt(),this.input_queue.unshift(function(a){return function(){return a.Prompt(c,d,e,b)}}(this));else if(this.state!==I)return void this.input_queue.push(function(b){return function(){return b.Input(a)}}(this));this.history_active=!1,this.input_callback=a,this.multiline_callback=null,this.state=H,this.$prompt.attr("class",g),this.$prompt_label.text(this._SelectPromptLabel(!1)),this.Focus(),this._ScrollToEnd()},c.prototype.Prompt=function(a,b,c,d){return this.state!==I?void this.input_queue.push(function(e){return function(){return e.Prompt(a,b,c,d)}}(this)):(this.history_active=a,this.input_callback=b,this.multiline_callback=c,this.async_multiline=d,this.state=J,this.$prompt.attr("class",j+" "+this.ansi.getClasses()),this.$prompt_label.text(this._SelectPromptLabel(!1)),this.Focus(),void this._ScrollToEnd())},c.prototype.AbortPrompt=function(){if(this.state!==J)throw new Error("Cannot abort prompt when not in prompt state.");this.Write(this.GetPromptText(!0)+G,h),this.ClearPromptText(!0),this.state=I,this.input_callback=this.multiline_callback=null,this._CheckInputQueue()},c.prototype.Focus=function(){this.IsDisabled()||this.$input_source.focus()},c.prototype.SetIndentWidth=function(a){return this.indent_width=a},c.prototype.GetIndentWidth=function(){return this.indent_width},c.prototype.RegisterMatching=function(a,b,c){var d;return d={opening_char:a,closing_char:b,cls:c},this.matchings.clss.push(c),this.matchings.openings[a]=d,this.matchings.closings[b]=d},c.prototype.UnRegisterMatching=function(a,b){var c;return c=this.matchings.openings[a].cls,delete this.matchings.openings[a],delete this.matchings.closings[b],this.matchings.clss.splice(this.matchings.clss.indexOf(c),1)},c.prototype.Dump=function(){var b,c;return b=this.$console.find("."+f).nextUntil("."+j).addBack(),function(){var d,e,f;for(f=[],d=0,e=b.length;d<e;d++)c=b[d],a(c).is("."+h)?f.push(a(c).text().replace(/^\s+/,">>> ")):f.push(a(c).text());return f}().join("")},c.prototype.GetState=function(){return this.state===H?"input":this.state===I?"output":"prompt"},c.prototype.Disable=function(){return this.$input_source.attr("disabled",!0),this.$input_source.blur()},c.prototype.Enable=function(){return this.$input_source.attr("disabled",!1)},c.prototype.IsDisabled=function(){return Boolean(this.$input_source.attr("disabled"))},c.prototype.MoveToStart=function(a){this._MoveTo(a,!0)},c.prototype.MoveToEnd=function(a){this._MoveTo(a,!1)},c.prototype.Clear=function(){return this.$console.find("."+f).nextUntil("."+j).addBack().text(""),this.$prompt_cursor.detach(),this.$prompt_right.before(this.$prompt_cursor)},c.prototype._CheckInputQueue=function(){if(this.input_queue.length)return this.input_queue.shift()()},c.prototype._InitPrompt=function(){if(this.$prompt=a(K(g)).appendTo(this.$console),this.$prompt_before=a(p).appendTo(this.$prompt),this.$prompt_current=a(p).appendTo(this.$prompt),this.$prompt_after=a(p).appendTo(this.$prompt),this.$prompt_label=a(p).appendTo(this.$prompt_current),this.$prompt_left=a(p).appendTo(this.$prompt_current),this.$prompt_right=a(p).appendTo(this.$prompt_current),this.$prompt_right.css({position:"relative"}),this.$prompt_cursor=a(K(e,"&nbsp;")),this.$prompt_cursor.insertBefore(this.$prompt_right),this.$prompt_cursor.css({color:"transparent",display:"inline",zIndex:0}),!this.isMobile)return this.$prompt_cursor.css("position","absolute")},c.prototype._SetupEvents=function(){return this.isMobile?this.$console.click(function(a){return function(b){return b.preventDefault(),a.Focus()}}(this)):this.$console.mouseup(function(a){return function(b){var c;return 2===b.which?a.Focus():(c=function(){if(!window.getSelection().toString())return b.preventDefault(),a.Focus()},setTimeout(c,0))}}(this)),this.$input_source.focus(function(a){return function(){var b,c;return a._ScrollToEnd(),a.$console_focused=!0,a.$console.removeClass(d),c=function(){if(a.$console_focused)return a.$console.removeClass(d)},setTimeout(c,100),b=function(){if(a.isIos&&a.$console_focused)return a.$input_source.hide()},setTimeout(b,500)}}(this)),this.$input_source.blur(function(a){return function(){var b;return a.$console_focused=!1,a.isIos&&a.$input_source.show(),b=function(){if(!a.$console_focused)return a.$console.addClass(d)},setTimeout(b,100)}}(this)),this.$input_source.bind("paste",function(a){return function(){var b;return b=function(){if(!a.in_composition)return a._AppendPromptText(a.$input_source.val()),a.$input_source.val(""),a.Focus()},setTimeout(b,0)}}(this)),this.$input_source.keypress(this._HandleChar),this.$input_source.keydown(this._HandleKey),this.$input_source.keydown(this._CheckComposition),this.$input_source.bind("compositionstart",this._StartComposition),this.$input_source.bind("compositionend",function(a){return function(b){return setTimeout(function(){return a._EndComposition(b)},0)}}(this)),this.isAndroid?(this.$input_source.bind("input",this._StartComposition),this.$input_source.bind("input",this._UpdateComposition)):this.$input_source.bind("text",this._UpdateComposition)},c.prototype._HandleChar=function(a){var b;return!(this.state!==I&&!a.metaKey&&!a.ctrlKey)||(b=a.which,
8!==b&&9!==b&&13!==b&&(this.$prompt_left.text(this.$prompt_left.text()+String.fromCharCode(b)),this._ScrollToEnd(),!1))},c.prototype._HandleKey=function(b){var c;if(this.state===I)return!0;if(c=b.keyCode||b.which,setTimeout(a.proxy(this._CheckMatchings,this),0),b.altKey)return!0;if(b.ctrlKey||b.metaKey)return this._HandleCtrlShortcut(c);if(b.shiftKey){switch(c){case y:this._HandleEnter(!0);break;case E:this._Unindent();break;case F:this._MoveUp();break;case w:this._MoveDown();break;case C:this._ScrollPage("up");break;case B:this._ScrollPage("down");break;default:return!0}return!1}switch(c){case y:this._HandleEnter(!1);break;case E:this._Indent();break;case v:this._Delete(!1);break;case u:this._Backspace(!1);break;case A:this._MoveLeft(!1);break;case D:this._MoveRight(!1);break;case F:this._HistoryPrevious();break;case w:this._HistoryNext();break;case z:this.MoveToStart(!1);break;case x:this.MoveToEnd(!1);break;case C:this._ScrollPage("up");break;case B:this._ScrollPage("down");break;default:return!0}return!1},c.prototype._HandleCtrlShortcut=function(a){var b,c,d,e;switch(a){case v:this._Delete(!0);break;case u:this._Backspace(!0);break;case A:this._MoveLeft(!0);break;case D:this._MoveRight(!0);break;case F:this._MoveUp();break;case w:this._MoveDown();break;case x:this.MoveToEnd(!0);break;case z:this.MoveToStart(!0);break;default:if(a in this.shortcuts){for(e=this.shortcuts[a],c=0,d=e.length;c<d;c++)b=e[c],b.call(this);return!1}return!0}return!1},c.prototype._HandleEnter=function(a){var b,c;return this._EndComposition(),a?this._InsertNewLine(!0):(c=this.GetPromptText(),b=function(a){return function(b){var d,e,f,g,h,j;if(b!==!1){for(a.MoveToEnd(!0),a._InsertNewLine(!0),j=[],f=g=0,h=Math.abs(b);0<=h?g<h:g>h;f=0<=h?++g:--g)b>0?j.push(a._Indent()):j.push(a._Unindent());return j}return e=a.state===H?"input":"prompt",a.Write(a.GetPromptText(!0)+G,""+i+"old-"+e),a.ClearPromptText(!0),a.history_active&&(a.history.length&&a.history[a.history.length-1]===c||a.history.push(c),a.history_index=a.history.length),a.state=I,d=a.input_callback,a.input_callback=null,d&&d(c),a._CheckInputQueue()}}(this),this.multiline_callback?this.async_multiline?this.multiline_callback(c,b):b(this.multiline_callback(c)):b(!1))},c.prototype._GetDirectionals=function(b){var c,d,e,f,g,h,i,j;return f=b?this.$prompt_left:this.$prompt_right,c=b?this.$prompt_right:this.$prompt_left,e=b?this.$prompt_before:this.$prompt_after,d=b?this.$prompt_after:this.$prompt_before,h=b?a.proxy(this.MoveToStart,this):a.proxy(this.MoveToEnd,this),g=b?a.proxy(this._MoveLeft,this):a.proxy(this._MoveRight,this),j=b?"last":"first",i=b?"prependTo":"appendTo",{$prompt_which:f,$prompt_opposite:c,$prompt_relative:e,$prompt_rel_opposite:d,MoveToLimit:h,MoveDirection:g,which_end:j,where_append:i}},c.prototype._VerticalMove=function(a){var b,c,d,e,f,g,h,i;if(i=this._GetDirectionals(a),d=i.$prompt_which,b=i.$prompt_opposite,c=i.$prompt_relative,f=i.MoveToLimit,e=i.MoveDirection,!c.is(o))return g=this.$prompt_left.text().length,f(),e(),h=d.text(),b.text(a?h.slice(g):h.slice(0,g)),d.text(a?h.slice(0,g):h.slice(g))},c.prototype._MoveUp=function(){return this._VerticalMove(!0)},c.prototype._MoveDown=function(){return this._VerticalMove()},c.prototype._HorizontalMove=function(b,c){var d,e,f,g,h,i,j,k,l,m,n,q,r,s;if(s=this._GetDirectionals(c),h=s.$prompt_which,e=s.$prompt_opposite,g=s.$prompt_relative,f=s.$prompt_rel_opposite,q=s.which_end,n=s.where_append,k=c?/\w*\W*$/:/^\w*\W*/,l=h.text()){if(b){if(r=l.match(k),!r)return;return r=r[0],m=e.text(),e.text(c?r+m:m+r),j=r.length,h.text(c?l.slice(0,-j):l.slice(j))}return m=e.text(),e.text(c?l.slice(-1)+m:m+l[0]),h.text(c?l.slice(0,-1):l.slice(1))}if(!g.is(o))return i=a(p)[n](f),i.append(a(p).text(this.$prompt_label.text())),i.append(a(p).text(e.text())),d=g.children()[q]().detach(),this.$prompt_label.text(d.children().first().text()),h.text(d.children().last().text()),e.text("")},c.prototype._MoveLeft=function(a){return this._HorizontalMove(a,!0)},c.prototype._MoveRight=function(a){return this._HorizontalMove(a)},c.prototype._MoveTo=function(a,b){var c,d,e,f,g,h,i;if(h=this._GetDirectionals(b),e=h.$prompt_which,c=h.$prompt_opposite,d=h.$prompt_relative,g=h.MoveToLimit,f=h.MoveDirection,a){for(i=[];!d.is(o)||""!==e.text();)g(!1),i.push(f(!1));return i}return c.text(this.$prompt_left.text()+this.$prompt_right.text()),e.text("")},c.prototype._Delete=function(a){var b,c,d;if(c=this.$prompt_right.text()){if(a){if(d=c.match(/^\w*\W*/),!d)return;return d=d[0],this.$prompt_right.text(c.slice(d.length))}return this.$prompt_right.text(c.slice(1))}if(!this.$prompt_after.is(o))return b=this.$prompt_after.children().first().detach(),this.$prompt_right.text(b.children().last().text())},c.prototype._Backspace=function(b){var c,d,e;if(setTimeout(a.proxy(this._ScrollToEnd,this),0),d=this.$prompt_left.text()){if(b){if(e=d.match(/\w*\W*$/),!e)return;return e=e[0],this.$prompt_left.text(d.slice(0,-e.length))}return this.$prompt_left.text(d.slice(0,-1))}if(!this.$prompt_before.is(o))return c=this.$prompt_before.children().last().detach(),this.$prompt_label.text(c.children().first().text()),this.$prompt_left.text(c.children().last().text())},c.prototype._Indent=function(){var a;return this.$prompt_left.prepend(function(){var b,c,d;for(d=[],a=b=1,c=this.indent_width;1<=c?b<=c:b>=c;a=1<=c?++b:--b)d.push(" ");return d}.call(this).join(""))},c.prototype._Unindent=function(){var a,b,c,d,e;for(a=this.$prompt_left.text()+this.$prompt_right.text(),e=[],b=c=1,d=this.indent_width;(1<=d?c<=d:c>=d)&&/^ /.test(a);b=1<=d?++c:--c)this.$prompt_left.text()?this.$prompt_left.text(this.$prompt_left.text().slice(1)):this.$prompt_right.text(this.$prompt_right.text().slice(1)),e.push(a=a.slice(1));return e},c.prototype._InsertNewLine=function(b){var c,d,e;return null==b&&(b=!1),e=this._SelectPromptLabel(!this.$prompt_before.is(o)),c=a(p).appendTo(this.$prompt_before),c.append(a(p).text(e)),c.append(a(p).text(this.$prompt_left.text())),this.$prompt_label.text(this._SelectPromptLabel(!0)),b&&(d=this.$prompt_left.text().match(/^\s+/))?this.$prompt_left.text(d[0]):this.$prompt_left.text(""),this._ScrollToEnd()},c.prototype._AppendPromptText=function(a){var b,c,d,e,f,g;for(c=a.split(G),this.$prompt_left.text(this.$prompt_left.text()+c[0]),f=c.slice(1),g=[],d=0,e=f.length;d<e;d++)b=f[d],this._InsertNewLine(),g.push(this.$prompt_left.text(b));return g},c.prototype._ScrollPage=function(a){var b;return b=this.$container[0].scrollTop,"up"===a?b-=this.$container.height():b+=this.$container.height(),this.$container.stop().animate({scrollTop:b},"fast")},c.prototype._ScrollToEnd=function(){var a;return this.$container.scrollTop(this.$container[0].scrollHeight),a=this.$prompt_cursor.position(),this.$input_container.css({left:a.left,top:a.top}),setTimeout(this.ScrollWindowToPrompt.bind(this),50)},c.prototype.ScrollWindowToPrompt=function(){var a,b,c,d,e,f;if(b=this.$prompt_cursor.height(),f=this.$window.scrollTop(),e=this.$window.scrollLeft(),a=document.documentElement.clientHeight,d=this.$prompt_cursor.offset(),c=d.top-2*b,this.isMobile&&"undefined"!=typeof orientation&&null!==orientation){if(f<d.top||f>d.top)return this.$window.scrollTop(c)}else{if(f+a<d.top)return this.$window.scrollTop(d.top-a+b);if(f>c)return this.$window.scrollTop(d.top)}},c.prototype._SelectPromptLabel=function(a){return this.state===J?a?" \n"+this.prompt_label_continue:this.prompt_label_main:a?"\n ":" "},c.prototype._Wrap=function(a,b,c){var d,e;return e=a.html(),d=e.slice(0,b)+K(c,e[b])+e.slice(b+1),a.html(d)},c.prototype._WalkCharacters=function(a,b,c,d,e){var f,g,h;for(g=e?a.length:0,a=a.split(""),h=function(){var b,c,d,f;return e?(d=a,a=2<=d.length?M.call(d,0,c=d.length-1):(c=0,[]),b=d[c++]):(f=a,b=f[0],a=2<=f.length?M.call(f,1):[]),b&&(g+=e?-1:1),b};f=h();)if(f===b?d++:f===c&&d--,0===d)return{index:g,current_count:d};return{index:-1,current_count:d}},c.prototype._ProcessMatch=function(b,c,d){var e,f,g,h,i,j,k,l,m,n,o,p;return n=c?[b.closing_char,b.opening_char]:[b.opening_char,b.closing_char],h=n[0],l=n[1],o=this._GetDirectionals(c),g=o.$prompt_which,f=o.$prompt_relative,i=1,j=!1,m=g.html(),c||(m=m.slice(1)),d&&c&&(m=m.slice(0,-1)),p=this._WalkCharacters(m,h,l,i,c),k=p.index,i=p.current_count,k>-1?(this._Wrap(g,k,b.cls),j=!0):(e=f.children(),e=c?Array.prototype.reverse.call(e):e,e.each(function(d){return function(e,f){var g,n;if(g=a(f).children().last(),m=g.html(),n=d._WalkCharacters(m,h,l,i,c),k=n.index,i=n.current_count,k>-1)return c||k--,d._Wrap(g,k,b.cls),j=!0,!1}}(this))),j},c.prototype._CheckMatchings=function(b){var c,d,e,f,g,h,i;for(e=b?this.$prompt_left.text().slice(this.$prompt_left.text().length-1):this.$prompt_right.text()[0],i=this.matchings.clss,g=0,h=i.length;g<h;g++)c=i[g],a("."+c,this.$console).contents().unwrap();if((d=this.matchings.closings[e])?f=this._ProcessMatch(d,!0,b):(d=this.matchings.openings[e])?f=this._ProcessMatch(d,!1,b):b||this._CheckMatchings(!0),b){if(f)return this._Wrap(this.$prompt_left,this.$prompt_left.html().length-1,d.cls)}else if(f)return this._Wrap(this.$prompt_right,0,d.cls)},c.prototype._HistoryPrevious=function(){if(this.history_active&&!(this.history_index<=0))return this.history_index===this.history.length&&(this.history_new=this.GetPromptText()),this.SetPromptText(this.history[--this.history_index])},c.prototype._HistoryNext=function(){if(this.history_active&&!(this.history_index>=this.history.length))return this.history_index===this.history.length-1?(this.history_index++,this.SetPromptText(this.history_new)):this.SetPromptText(this.history[++this.history_index])},c.prototype._CheckComposition=function(a){var b;if(b=a.keyCode||a.which,229===b)return this.in_composition?this._UpdateComposition():this._StartComposition()},c.prototype._StartComposition=function(){if(!this.in_composition)return this.in_composition=!0,this._ShowComposition(),setTimeout(this._UpdateComposition,0)},c.prototype._EndComposition=function(){if(this.in_composition)return this._HideComposition(),this.$prompt_left.text(this.$prompt_left.text()+this.$composition.text()),this.$composition.text(""),this.$input_source.val(""),this.in_composition=!1},c.prototype._UpdateComposition=function(a){var b;return b=function(a){return function(){if(a.in_composition)return a.$composition.text(a.$input_source.val())}}(this),setTimeout(b,0)},c.prototype._ShowComposition=function(){return this.$composition.css("height",this.$prompt_cursor.height()),this.$composition.empty(),this.$composition.appendTo(this.$prompt_left)},c.prototype._HideComposition=function(){return this.$composition.detach()},c}(),a.fn.jqconsole=function(a,b,c){return new t(this,a,b,c)},a.fn.jqconsole.JQConsole=t,a.fn.jqconsole.Ansi=b}.call(this),$.widget("trinket.assetBrowser",{options:{assets:[],libraryUrl:[],uploadUrl:"",linkAddUrl:"",selectedClass:"selected",templateUrl:trinketConfig.prefix("/js/plugins/asset-browser.html"),eventPrefix:"asset-browser",openClass:"open",assetsHowTo:"",guest:!0},_create:function(){var a=this;a._templates={},$.get(this.options.templateUrl).then(function(b){a._setUpView(b)}),this._onAppEvent("view.addimage.show",$.proxy(a.openAddImageView,a)),this._onAppEvent("view.upload.show",$.proxy(a.openUploadImageView,a)),this._onAppEvent("close",$.proxy(a.hide,a)),this.options.guest&&$(document).on("trinket.account.success",$.proxy(a.allowImageUpload,a))},_onAppEvent:function(a,b,c){$(c||this.element).on(this.options.eventPrefix+"."+a,b)},_setUpView:function(a){var b,c=this,d=$(a);d.find(".template[template-id]").each(function(a,b){var e=$(b).attr("template-id");c._templates[e]=$(b).detach().removeClass("template").removeAttr("template-id"),c.element.empty().append(d)}),this._addTemplateEvents(d),this._templates.addImage.on("modal.init",$.proxy(this._loadLibrary,this)),this.options.assetsHowTo&&(b=$(this.options.assetsHowTo),b.is("script")&&(b=$(b.text())),this.element.find(".howto-message").append(b),this.element.find(".howto-container").show(),this._onAppEvent("view.howto.show",$.proxy(c.openHowToView,c)),$(document).foundation()),this._viewReady=!0,this._dropzoneReady=!1,this._refreshAssets()},_refreshAssets:function(){var a=this,b=a.element.find("#trinket-asset-list");this._viewReady&&($("#asset-list-wrapper").show(),0===this.options.assets.length?b.hide():(b.empty(),b.show()),$.each(this.options.assets,function(c,d){var e=a._templates.imageInfo.clone();a._initLibraryItem(e,d),b.append(e)}))},_initLibraryItem:function(a,b){var c=this;this._addTemplateEvents(a),a.find(".title").text(b.name),a.find(".thumbnail").attr("src",b.thumb||b.url),a.data("asset-id",b.id),b.isDemo&&a.find(".demo").show(),this._onAppEvent("assets.remove",function(){a.find(".controls").hide(),a.find(".confirm-controls").show()},a),this._onAppEvent("assets.confirm",function(){$.each(c.options.assets,function(a,d){if(d.id===b.id)return c.options.assets.splice(a,1),c._refreshAssets(),c.element.trigger("assets.change"),!1})},a),this._onAppEvent("assets.cancel",function(){a.find(".confirm-controls").hide(),a.find(".controls").show()},a),this._onAppEvent("assets.toggle",function(){a.hasClass(c.options.selectedClass)?(a.removeClass(c.options.selectedClass),$.each(c.options.assets,function(a,d){if(d.id===b.id)return c.options.assets.splice(a,1),c._refreshAssets(),c.element.trigger("assets.change"),!1})):(a.addClass(c.options.selectedClass),c._addToAssets(b))},a)},_addTemplateEvents:function(a){var b=this;return a.find("[events]").each(function(a,c){var d,e,f,g=$(c).attr("events").split(/\s*,\s*/);for($(c).off(),e=g.length;--e>=0;)f=!1,$(c).data("if-broadcasting")&&"disable"===$(c).data("if-broadcasting")&&(f=!0),d=g[e].split(/\s*:\s*/),$(c).on(d[0],function(a){f&&void 0!==window.window.TrinketAPI._receiverBroadcastState&&"OFF"!==window.TrinketAPI._receiverBroadcastState?$(".broadcasting-assets-info").show().delay(5e3).fadeOut():$(this).trigger(b.options.eventPrefix+"."+d[1],{originalEvent:a})})}),a},_initUpload:function(){var a=this;new Dropzone(a._templates.addImage.find(".dropzone")[0],{url:"/api/users/assets",acceptedFiles:"image/jpeg,image/png,image/gif,image/jpg",dictDefaultMessage:"",clickable:"#select-to-upload",previewsContainer:"#preview-container",init:function(){this.on("success",function(b,c){a._addToLibrary(c.file,"top"),a._addToAssets(c.file)})}}),a._onAppEvent("view.upload.hide",$.proxy(a.closeUploadImageView,a)),a._dropzoneReady=!0},_markSelected:function(){var a,b=this,c={};for(a=0;a<b.options.assets.length;a++)c[b.options.assets[a].id]=b.options.assets[a];this._templates.addImage.find(".asset").each(function(a){var d=$(this);d.removeClass(b.options.selectedClass),c[d.data("asset-id")]&&d.addClass(b.options.selectedClass)})},_addToAssets:function(a){this.options.assets.push({url:a.url,name:a.name,id:a.id}),this.element.trigger("assets.change")},_addToLibrary:function(a,b){var c=this._templates.addImage,d=c.find("ul#trinket-asset-list"),e=this._templates.libraryImageInfo.clone();return this._initLibraryItem(e,a),"undefined"!=typeof b&&"top"===b?(d.prepend(e),e.addClass(this.options.selectedClass)):d.append(e),e.addClass("clickable"),e},_loadLibrary:function(){var a=this,b=this._templates.addImage,c=b.find("ul#trinket-asset-list");this._addTemplateEvents(this._templates.addImage),c.empty(),$("#loadingContents").show(),$.get(a.options.libraryUrl).then(function(b){var c,d=b.files||[];for(c=0;c<d.length;c++)a._addToLibrary(d[c]);a._markSelected(),a._templates.addImage.on("modal.show",$.proxy(a._markSelected,a)),a._templates.addImage.on("modal.hide",$.proxy(a._refreshAssets,a)),$("#loadingContent").hide()})},_showModal:function(a){var b=this;this._modal&&(this._modal.hide(),this._modal.trigger("modal.hide")),$.contains(document,a[0])||($("#asset-viewer-contents").append(a),a.trigger("modal.init"),a.find(".closer, .addimage-done").click(function(){b._modal&&(b._modal.trigger("modal.hide"),b._modal.hide(),b._modal=void 0)})),this._modal=a,this._modal.show(),this._modal.trigger("modal.show")},assets:function(a){if(void 0!==a){if(!Array.isArray(a))throw new Error("trinket.codeEditor.assets expects an array, but got "+a);this.options.assets=a,this._refreshAssets()}return this.options.assets},show:function(){this.element.addClass(this.options.openClass)},hide:function(){this.element.removeClass(this.options.openClass)},openUploadImageView:function(){var a=this;a.options.guest?($("#upload-guest").fadeIn(),$("#assetLogin").click(function(b){a.element.trigger("trinket.account.login",["#assetAccount",{action:$(b.target).data("action")}])}),$("#assetCreateAccount").click(function(b){a.element.trigger("trinket.account.create",["#assetAccount",{action:$(b.target).data("action")}])})):$("#upload-assets").fadeIn(function(){a._dropzoneReady||a._initUpload()})},openAddImageView:function(){$("#asset-list-wrapper").hide(),this._showModal(this._templates.addImage)},closeUploadImageView:function(){$("#upload-assets").fadeOut()},openHowToView:function(){$("#howto-message").show()},allowImageUpload:function(){this.options.guest=!1,$("#upload-guest").hide(),this._loadLibrary(),this.openUploadImageView()},openLinkView:function(){this._showModal(this._templates.imageLink)}}),function(a,b,c){function d(a,b,c,d){for(var e=100;--e>0&&a.height()-b<=0;)c==d?a.append("<div class='lineno lineselect _lineno_"+c+"_'>"+c+"</div>"):a.append("<div class='lineno _lineno_"+c+"_'>"+c+"</div>"),c++;return c}function e(b,c){var e=1,f=a(b),g=a('<textarea class="lined" autocorrect="off" autocapitalize="off"></textarea>');f.append(g),g.attr("wrap","off"),g.css({resize:"none"}),g.wrap("<div class='linedtextarea'></div>");var h=g.parent().wrap("<div class='linedwrap'></div>"),i=h.parent();i.prepend("<div class='lines'></div>");var j=i.find(".lines");j.append("<div class='codelines' data-filename='"+c.name+"'></div>");var k=j.find(".codelines");if(e=d(k,j.height(),1,c.selectedLine),c.selectedLine!=-1&&!isNaN(c.selectedLine)){var l=parseInt(g.height()/(e-2)),m=parseInt(l*c.selectedLine)-g.height()/2;g[0].scrollTop=m}var n=_.throttle(function(a){var b=g[0],f=b.scrollTop,h=b.clientHeight;k.css({"margin-top":-1*f+"px"}),e=d(k,f+h,e,c.selectedLine)},50);return g.scroll(n),c.onFocus&&g.on("focus",c.onFocus),c.value&&g.val(c.value,-1),a(window).on("resize",n),{registerPlugin:function(a,b){},destroy:function(){i.remove(),g.remove(),f.empty(),a(window).off("resize",n)},addCommand:function(a,b,c){},change:function(a){return g.on("input propertychange",a)},setValue:function(a){g.val(a,-1)},getValue:function(){return g.val()},focus:function(){return g.focus()},blur:function(){return g.blur()},isFocused:function(){return g.is(":focus")},setModeFromName:function(a){},resize:function(){},highlight:function(b){a('.codelines[data-filename="'+c.name+'"]').find("._lineno_"+b+"_").addClass("lineselect"),a("textarea.lined").addClass("attention-error")},addQueueMarkers:function(){}}}function f(a,b,c,d){var e=this.getSession().lineWidgets,f=d.start.row,g=d.end.row-f;if(0!==g)if(e){if("remove"==d.action){var h=e.splice(f+1,g),i=q[c].splice(f+1,g);h.forEach(function(a){a&&this.removeLineWidget(a)},this.getSession().widgetManager),i.forEach(function(a){a&&(delete o[a._commentId],b({_id:a._commentId,index:a._file}),this.removeGutterDecoration(a.row,"trinket-comment"),this.removeGutterDecoration(a.row,"data-"+a._file+"-"+a._commentId),p[a._commentId]?this.removeGutterDecoration(a.row,"collapsed"):this.removeGutterDecoration(a.row,"open"))},this.getSession())}else{var j=new Array(g);j.unshift(f,0),e.splice.apply(e,j),q[c].splice.apply(q[c],j)}var k=!0;q[c].forEach(function(b,c){b&&(k=!1,b.row!==c&&a(b._file,b._commentId,c,!0))}),k&&(this.getSession().lineWidgets=null)}else{if("remove"==d.action){var l=q[c].splice(f+1,g);l.forEach(function(a){a&&(delete o[a._commentId],b({_id:a._commentId,index:a._file}),this.removeGutterDecoration(a.row,"trinket-comment"),this.removeGutterDecoration(a.row,"data-"+a._file+"-"+a._commentId),p[a._commentId]?this.removeGutterDecoration(a.row,"collapsed"):this.removeGutterDecoration(a.row,"open"))},this.getSession())}else{var j=new Array(g);j.unshift(f,0),q[c].splice.apply(q[c],j)}q[c].forEach(function(b,c){b&&b.row!==c&&a(b._file,b._commentId,c,!0)})}}function g(b,d){function e(b){var c,e,f=b.text,g=f.replace(/(?:\r\n|\r|\n)/g,"<br />"),h=moment(b.commentedOn).fromNow(),i=b.row,j=b._id,l=b.index,r=b.edited?"(edited)":"",s=p[j]=b.collapsed||!1;return e=d.editorOpts.canAddInlineComments&&d.editorOpts.userId===b.userId?"inlineCommentActions":"inlineCommentDismiss",c=m(e,{commentId:j,index:l}),a.when(u(b.userId)).done(function(d){t[b.userId]=d;var e=m("inlineCommentTemplate",{comment:g,avatar:d.avatar,commentedOn:h,username:d.username,commentId:j,edited:r,commentText:f,commentActions:c}),p=k.createElement("div");p.innerHTML=e;var u={row:i,fixedWidth:!0,el:p,_file:l,_commentId:j,_text:f};u.destroy=function(){v.widgetManager.removeLineWidget(u),q[l][i]=null},s||(u=n.session.widgetManager.addLineWidget(u)),o[j]=u,q[l]||(q[l]=[]),q[l][i]=u,n.session.addGutterDecoration(i,"trinket-comment"),s?n.session.addGutterDecoration(i,"collapsed"):n.session.addGutterDecoration(i,"open"),n.session.addGutterDecoration(i,"data-"+l+"-"+j),a(u.el).find(".confirm-remove-comment").on("click",function(a){u.destroy()})})}var g=c.require("ace/ext/modelist"),h=g.getModeForPath("foo."+d.ext),i=c.require("ace/range").Range,j=c.require("ace/line_widgets").LineWidgets,k=c.require("ace/lib/dom"),n=c.edit(b),r=[],s=[],t={};if(n.$blockScrolling=1/0,n.setTheme("ace/theme/xcode"),n.getSession().setMode(h?h.mode:"ace/mode/text"),n.getSession().setUseSoftTabs(!0),n.getSession().setTabSize(2),n.setShowPrintMargin(!1),n.setFontSize("inherit"),n._fileName=d.name,n._addErrorBorder=!1,d.value&&n.setValue(d.value,-1),d.onFocus&&n.on("focus",d.onFocus),d.comments&&d.comments.length){var u=function(b){return t[b]?a.Deferred().resolve(t[b]).promise():a.get("/api/users/"+b+"/info")},v=n.session;v.widgetManager||(v.widgetManager=new j(v,{updateOnChange:f.bind(n,d.onCommentChange,d.onCommentRemove,d.index)}),v.widgetManager.attach(n));for(var w=(v.getDocument().getLength(),[]),x=0;x<d.comments.length;x++)w.push(e(d.comments[x]));a.when.apply(a,w).then(function(){l(v,d.index)})}return{registerPlugin:function(a,b){a.initialize(n,b)},destroy:function(){n.destroy(),a(b).empty()},addCommand:function(a,b,c){n.commands.addCommand({name:a,bindKey:b,exec:c})},change:function(a){var b=this;return n.getSession().on("change",function(){b.removeMarkers(),a()})},setValue:function(a){n.setValue(a,-1)},getValue:function(){return n.getValue()},focus:function(a){return 0===a?n.navigateFileStart():a===-1&&n.navigateFileEnd(),n.focus()},blur:function(){n.blur()},isFocused:function(){return n.isFocused()},setModeFromName:function(a){var b=g.getModeForPath(a),c=n._fileName;n._fileName=a,n._emit("file.rename",{oldName:c,newName:a}),n.getSession().setMode(b?b.mode:"ace/mode/text")},resize:function(a){n.resize(a)},highlight:function(b,c){var d=n.getSession().getLine(b-1);if(c)r.push(b),n._addErrorBorder=!0;else{var e=new i(b-1,0,b-1,d.length);s.push(n.getSession().addMarker(e,"highlight-line-error","fullLine")),a(".ace_content").addClass("attention-error")}},addQueueMarkers:function(){for(var b=0;b<r.length;b++)this.highlight(r[b]);r=[],n._addErrorBorder&&(a(".ace_content").addClass("attention-error"),n._addErrorBorder=!1)},removeMarkers:function(){for(var a=0;a<s.length;a++)n.getSession().removeMarker(s[a]);s=[],r=[]},getSession:function(){return n.getSession()},setReadOnly:function(a){n.setReadOnly(a)},scrollToLine:function(a,b,c,d){n.scrollToLine(a,b,c,d)},aceInstance:n,renderer:n.renderer,keyBinding:n.keyBinding,addCommentWidget:function(){var c,e,g,h,i,r,s=this.options.userId,t="/api/users/"+s+"/avatar",u=a("#whoami").val(),v=d.index;return c=n.getCursorPosition(),(e=_.findKey(o,function(a){return a.row===c.row&&a._file===v}))?(p[e]&&a("div.ace_gutter-cell.trinket-comment.data-"+v+"-"+e).trigger("click"),void a("a.edit-inline-comment[data-comment-id='"+e+"']").trigger("click")):(g=n.session,g.widgetManager||(g.widgetManager=new j(g,{updateOnChange:f.bind(n,d.onCommentChange,d.onCommentRemove,v)}),g.widgetManager.attach(n)),n.scrollToLine(c.row,!0,!0),h=k.createElement("div"),h.innerHTML=m("addInlineCommentTemplate",{avatar:t,username:u,commentId:v+"_"+c.row,index:v}),i={row:c.row,fixedWidth:!0,el:h,_file:v,_commentId:v+"_"+c.row},i.destroy=function(){g.widgetManager.removeLineWidget(i),delete o[i._commentId],l(g,i._file)},i=g.widgetManager.addLineWidget(i),o[i._commentId]=i,l(g,v),r=a(i.el).find("textarea.inline-comment-text"),r.focus(),a(i.el).find(".cancel-inline-comment").on("click",function(a){i.destroy()}),void a(i.el).find(".save-inline-comment").on("click",function(c){var e=r.val(),f=e.replace(/(?:\r\n|\r|\n)/g,"<br />"),h=moment().subtract(2,"seconds"),j=n._fileName+i.row+h,w=CryptoJS.MD5(j).toString(CryptoJS.enc.Hex).substring(0,16),x=m("inlineCommentActions",{commentId:w,index:v}),y=m("inlineCommentTemplate",{comment:f,avatar:t,username:u,commentedOn:h.fromNow(),commentText:e,commentActions:x,commentId:w}),z=k.createElement("div");z.innerHTML=y,a(document).foundation("dropdown","reflow");var A={row:i.row,fixedWidth:!0,el:z,_file:v,_commentId:w,_text:e};A.destroy=function(){g.widgetManager.removeLineWidget(A),q[v][A.row]=null},i.destroy(),A=n.session.widgetManager.addLineWidget(A),n.session.addGutterDecoration(A.row,"trinket-comment"),n.session.addGutterDecoration(A.row,"open"),n.session.addGutterDecoration(A.row,"data-"+v+"-"+w),o[w]=A,p[w]=!1,q[v]||(q[v]=[]),q[v][A.row]=A,l(g,v),a(b).trigger("comment.added",{row:A.row,text:e,commentedOn:h,_id:w,fileName:n._fileName,index:d.index,userId:s,edited:!1,collapsed:!1}),a(b).find(".confirm-remove-comment").on("click",function(a){A.destroy()})}))}}}function h(a,b){var c={value:b.value};return{registerPlugin:function(a,b){},destroy:function(){},addCommand:function(a,b,c){},change:function(a){a()},setValue:function(a){return c.value=a,a},getValue:function(){return c.value},focus:function(){},blur:function(){},isFocused:function(){return!1},setModeFromName:function(a){},resize:function(){},highlight:function(a){}}}function i(b,c){var d,e={value:c.value};return d=a("<img />",{src:c.value}),a(b).html(d),{registerPlugin:function(a,b){},destroy:function(){},addCommand:function(a,b,c){},change:function(a){a()},setValue:function(a){return e.value=a,a},getValue:function(){return e.value},focus:function(){},blur:function(){},isFocused:function(){return!1},setModeFromName:function(a){},resize:function(){},highlight:function(a){},addQueueMarkers:function(){}}}function j(a,b,c,d){var e=o[b],f=e.row,g=this._files[a].editor.getSession();g.removeGutterDecoration(f,"trinket-comment"),g.removeGutterDecoration(f,"data-"+a+"-"+b),g.addGutterDecoration(c,"trinket-comment"),g.addGutterDecoration(c,"data-"+a+"-"+b),p[b]?(g.removeGutterDecoration(f,"collapsed"),g.addGutterDecoration(c,"collapsed")):(g.removeGutterDecoration(f,"open"),g.addGutterDecoration(c,"open")),d?e.row=c:(g.widgetManager.removeLineWidget(e),e.row=c,g.widgetManager.addLineWidget(e),q[a]||(q[a]=[]),q[a][f]=null,q[a][c]=e),l(g,a),this._updateComment({_id:b,index:a,data:{row:c}})}function k(a,b){return _.findKey(o,function(c){return c._file===a&&c.row===b})}function l(b,c){var d=b.getDocument().getLength();_.each(o,function(b,e){b._file===c&&(!b.row||k(b._file,b.row-1)?a(b.el).find(".move-comment-up").addClass("disabled"):a(b.el).find(".move-comment-up").removeClass("disabled"),d-1===b.row||k(b._file,b.row+1)?a(b.el).find(".move-comment-down").addClass("disabled"):a(b.el).find(".move-comment-down").removeClass("disabled"))})}var m=b.import("utils.template"),n={},o={},p={},q=[],r=a('<div class="code-editor" data-interface="code-editor"><div class="tab-nav"><dl class="left-options"><dd class="tab-button"><a class="tab-scroll-link left-arrow" data-direction="-1"><i class="fa fa-chevron-left"></i></a></dd><dd class="tab-button"><a class="tab-scroll-link right-arrow" data-direction="1"><i class="fa fa-chevron-right"></i></a></dd></dl><dl class="scrollable-content"></dl><dl class="right-options"></dl><div class="clearfix"></div></div><div class="file-content-container"></div><div class="info-area collapsed"><div class="info-quick"></div><div class="scroll-wrap"><div class="info-full"></div></div><a class="expander fa"></a></div></div>'),s=a('<div class="file-content"></div>'),t=a('<div class="tab-options"><ul><li><a class="file-remove-link menu-button" data-action="file.remove"><i class="fa fa-trash"></i></a></li><li><a class="file-rename-link menu-button" data-action="file.rename"><i class="fa fa-pencil"></i></a></li></ul></div>'),u=m.compile('<dd class="tab"><a class="file-tab-link"><span class="file-name">{{name}}</span><span class="tab-options-link menu-button" data-action="file.options"></span></a></dd>'),v=m.compile('<input type="text" class="file-name-input" value="{{name}}" placeholder="file name">'),w=m.compile('<div data-alert class="file-name-error alert-box alert">{{message}}<a class="close">&times;</a></div>'),x=m.compile('<div data-alert class="file-remove-info alert-box info" data-interface="code-editor">The file "{{name}}" has been deleted. <a class="file-restore-link menu-button" data-action="file.restore">Undo</a><a class="close menu-button" data-action="file-undo.close">&times;</a></div>'),y="click.trinket-code-editor.tab-select",z="mousedown.trinket-code-editor.scroll-tabs-start touchstart.trinket-code-editor.scroll-tabs-start",A="mouseup.trinket-code-editor.scroll-tabs-stop touchend.trinket-code-editor.scroll-tabs-stop",B="click.trinket-code-editor.add-file",C="click.trinket-code-editor.view-assets",D="click.trinket-code-editor.tab-options-open",E="mousedown.trinket-code-editor.tab-options-close",F="click.trinket-code-editor.edit-file-name",G="click.trinket-code-editor.remove-file",H="click.trinket-code-editor.hide-file",I=".fa.fa-exclamation-circle.warning",J="fa fa-exclamation-circle warning",K=a('<dd class="tab-button"><a class="add-file-link menu-button" data-action="file.add"><i class="fa fa-plus"></i></a></dd>'),L=a('<dd class="tab-button"><a class="add-inline-comment menu-button" data-action="inline-comment.add"><i class="fa fa-comment"></i></a></dd>'),M="click.trinket-code-editor.add-inline-comment",N={options:{selectedLine:-1,selectedClass:"lineselect",noEditor:!1,state:"",defaultFileExt:"txt",mainFileName:"main.py",mainEditable:!1,mainSuffix:null,showTabs:!1,addFiles:!0,showInfo:!1,assets:!1,assetsHowTo:"",onFocus:function(){},lang:"",owner:!1,canHideTabs:!1,canAddInlineComments:!1,userId:null},_create:function(){var b=this;c?c.require("ace/line_widgets").LineWidgets:function(){};this._editor,this._commands=[],this._plugins=[],this._files=[],this.element.empty(),this.element.append(r.clone()),this.options.addFiles&&this.element.find("dl.right-options").append(K),this.options.canAddInlineComments&&this.element.find("dl.right-options").append(L),this.$tabOptions=t.clone(),this.options.canHideTabs&&this.$tabOptions.find("ul").append('<li><a class="file-hide-link menu-button" data-action="file.hide" title="toggle tab visibility"><i class="fa fa-eye"></i></a></li>'),a("body").append(this.$tabOptions),this.$tabBar=this.element.find(".scrollable-content"),this.$tabBar.on(y,".tab",function(c){if(!a(this).hasClass("active")){var d=a(this).index();return b._files[d].editor.addQueueMarkers(),b._selectTab(d)}}),this.$contentWrapper=this.element.find(".file-content-container"),this.element.find(".tab-scroll-link").on(z,function(){b._scrollTabBar(a(this).data("direction"))}),this.element.find(".add-file-link").parent().on(B,function(){"BROADCASTING"!=window.TrinketAPI._receiverBroadcastState&&(b.addFile(""),b._selectTab(b.$tabBar.children().length-1,!0),b._editFileName())}),this.element.find(".add-inline-comment").parent().on(M,function(){b._addCommentWidget()}),this.element.on(D,".tab-options-link",function(c){if(b.$tabOptions.hasClass("open"))b._closeOptionsMenu();else{var d=a(this).closest(".tab");a(d).hasClass("main-editable")?b.$tabOptions.find(".file-remove-link").hide():b.$tabOptions.find(".file-remove-link").show();
var e=a(this).offset();b.$tabOptions.css("left",e.left-10+"px"),b.$tabOptions.css("top",e.top+a(this).height()+10+"px"),b.$tabOptions.addClass("open"),b.element.on(E,function(c){a(c.target).hasClass("tab-options-link")||b._closeOptionsMenu()})}}),this.$tabOptions.find(".file-rename-link").on(F,function(){b._closeOptionsMenu(),"BROADCASTING"!=window.TrinketAPI._receiverBroadcastState&&(a(".file-name-input").length||b._editFileName())}),this.$tabOptions.find(".file-remove-link").on(G,function(){b._closeOptionsMenu(),"BROADCASTING"!=window.TrinketAPI._receiverBroadcastState&&b._removeFile({undo:!0})}),this.$tabOptions.find(".file-hide-link").on(H,function(){b._closeOptionsMenu(),b._toggleFile()}),this.options.assets&&(this.$assetBrowser=a('<div class="file-content fixed-right"></div>').assetBrowser({modalParent:".trinket-content-wrapper",libraryUrl:"/api/users/assets?type=image",assets:this.options.assets,openClass:"active",assetsHowTo:this.options.assetsHowTo,guest:this.options.guest}),this.element.find(".right-options").append('<dd class="tab"><a class="file-tab-link add-asset-link" data-action="assets.view" title="View and Add Images"><i class="fa fa-file-image-o"></i></a></dd>'),this.assetBrowser=this.$assetBrowser.data("trinket-assetBrowser"),this.assetBrowser.hide(),this.element.find(".tab-nav").addClass("allow-assets"),this.$contentWrapper.append(this.$assetBrowser),this.element.find(".add-asset-link").parent().on(C,function(){var c=a(this);c.hasClass("active")||(b._selectTab(-1,!0),c.addClass("active"),b.assetBrowser.show())})),this.options.showTabs||b.element.addClass("tabless"),this.options.showInfo&&b.element.addClass("with-info"),this.options.state&&this._loadState(this.options.state),a(document).on("SkfileWrite",function(c){var d,e,f,h,i,j,k;for(e=c.originalEvent.data.split(":"),f=e[0],h=e.slice(1).join(":"),d=0;d<b._files.length;d++)b._files[d].name===f&&(i=b._files[d].editor.getValue(),j=i.length?i+h:h,a('textarea[name="'+b._files[d].name+'"]').val(j),b.$contentWrapper.children().eq(d).hasClass("active")?b._files[d].editor.setValue(j):(b._files[d].editor.destroy(),k=s.clone(),b._files[d].editor=g(k[0],{onFocus:function(){},ext:b._files[d].name.split(".").pop()||b.options.defaultFileExt,index:d}),b._files[d].editor.setValue(j),b.$contentWrapper.children().eq(d).replaceWith(k)))}),a(document).on("SkfileOpen",function(c){var d,e,f=c.originalEvent.data.split(":"),h=f[0],i=f.slice(1).join(":"),j={};b._files.map(function(a,b){j[a.name]=b}),"undefined"==typeof j[i]?b.addFile({name:i}):"w"===h&&(d=j[i],a('textarea[name="'+b._files[d].name+'"]').val("\n"),b.$contentWrapper.children().eq(d).hasClass("active")?b._files[d].editor.setValue(""):(b._files[d].editor.destroy(),e=s.clone(),b._files[d].editor=g(e[0],{onFocus:function(){},ext:b._files[d].name.split(".").pop()||b.options.defaultFileExt,index:d}),b.$contentWrapper.children().eq(d).replaceWith(e)))}),a(document).on("comment.added",".file-content",function(a,c){b._addComment(c)}),a(document).on("click",".edit-inline-comment",function(b){var c=a(this).data("comment-id"),d=o[c]._text;a("#comment-container-"+c).addClass("hide"),a("#edit-comment-container-"+c).removeClass("hide"),a("textarea#edit-inline-comment-"+c).val(d),a("a[data-dropdown='comment-actions-"+c+"']").addClass("hide"),a("#update-comment-container-"+c).removeClass("hide")}),a(document).on("click",".cancel-update-comment",function(b){var c=a(this).data("comment-id");a("a[data-dropdown='comment-actions-"+c+"']").removeClass("hide"),a("#update-comment-container-"+c).addClass("hide"),a("#comment-container-"+c).removeClass("hide"),a("#edit-comment-container-"+c).addClass("hide")}),a(document).on("click",".update-comment",function(c){var d=a(this).data("comment-id"),e=a(this).data("file-index"),f=a("textarea#edit-inline-comment-"+d).val(),g=f.replace(/(?:\r\n|\r|\n)/g,"<br />");o[d]._text=f,a("#comment-container-"+d).html(g),a("a[data-dropdown='comment-actions-"+d+"']").removeClass("hide"),a("#update-comment-container-"+d).addClass("hide"),a("#comment-container-"+d).removeClass("hide"),a("#edit-comment-container-"+d).addClass("hide"),b._updateComment({_id:d,index:e,data:{text:f,edited:!0}})}),a(document).on("click",".confirm-remove-inline-comment",function(b){var c=a(this).data("comment-id");a("a[data-dropdown='comment-actions-"+c+"']").addClass("hide"),a("#confirm-remove-comment-container-"+c).removeClass("hide")}),a(document).on("click",".cancel-remove-comment",function(b){var c=a(this).data("comment-id");a("a[data-dropdown='comment-actions-"+c+"']").removeClass("hide"),a("#confirm-remove-comment-container-"+c).addClass("hide")}),a(document).on("click",".confirm-remove-comment",function(c){var d=a(this).data("comment-id"),e=a(this).data("file-index"),f=o[d];b._files[e].editor.getSession().removeGutterDecoration(f.row,"trinket-comment"),b._files[e].editor.getSession().removeGutterDecoration(f.row,"data-"+e+"-"+d),p[d]?b._files[e].editor.getSession().removeGutterDecoration(f.row,"collapsed"):b._files[e].editor.getSession().removeGutterDecoration(f.row,"open"),o[d].destroy(),delete o[d],l(b._files[e].editor.getSession(),e),b._removeComment({_id:d,index:e})}),a(document).on("click",".ace_gutter-cell.trinket-comment",function(c){var d,e,f,g,h,i=a(c.target).attr("class").split(" ");d=_.find(i,function(a){return/^data/.test(a)}),e=d.split("-"),f=e[1],g=e[2],h=o[g];var j=b._files[f].editor.getSession();p[g]?(j.widgetManager.addLineWidget(o[g]),p[g]=!1,j.removeGutterDecoration(h.row,"collapsed"),j.addGutterDecoration(h.row,"open")):(j.widgetManager.removeLineWidget(o[g]),p[g]=!0,j.removeGutterDecoration(h.row,"open"),j.addGutterDecoration(h.row,"collapsed")),b._updateComment({_id:g,index:f,data:{collapsed:p[g]}})}),a(document).on("click",".comment-actions.comment-dismiss",function(c){var d=a(this).data("comment-id"),e=a(this).data("file-index"),f=o[d];b._files[e].editor.getSession().removeGutterDecoration(f.row,"trinket-comment"),b._files[e].editor.getSession().removeGutterDecoration(f.row,"data-"+e+"-"+d),p[d]?b._files[e].editor.getSession().removeGutterDecoration(f.row,"collapsed"):b._files[e].editor.getSession().removeGutterDecoration(f.row,"open"),o[d].destroy(),delete o[d],b._removeComment({_id:d,index:e})}),a(document).on("click",".move-comment-up",function(c){if(!a(this).hasClass("disabled")){var d=a(this).data("comment-id"),e=a(this).data("file-index"),f=o[d],g=(f.row,f.row-1);j.call(b,e,d,g)}}),a(document).on("click",".move-comment-down",function(c){if(!a(this).hasClass("disabled")){var d=a(this).data("comment-id"),e=a(this).data("file-index"),f=o[d],g=(f.row,f.row+1);j.call(b,e,d,g)}})},_closeOptionsMenu:function(){this.element.off(E),this.$tabOptions.removeClass("open")},_loadState:function(a){var b;try{if(a=JSON.parse(a),!Array.isArray(a))throw new Error}catch(b){a=[{name:this.options.mainFileName,content:a||""}]}for(b=0;b<a.length;b++)this.addFile(a[b]);this._selectTab(0,!0)},_getCurrentVisibleTab:function(){var a=this.$tabBar.find(".tab.active").first(),b=(this.$contentWrapper.find(".file-content.active").first(),a.index()),c=a.find(".file-name").text();return{tabIndex:b,fileName:c}},_selectTab:function(a,b){this.element.find(".tab.active, .file-content.active").removeClass("active"),this._editor&&this._editor.blur(),void 0!==a&&this._files[a]?(this.$tabBar.children().eq(a).addClass("active"),this.$contentWrapper.children().eq(a).addClass("active"),this._editor=this._files[a].editor,b||this._editor.focus(),this.element.trigger({type:"codeeditor.tabChanged",tabIndex:a}),this.element.find(".add-inline-comment").removeClass("disabled")):this.element.find(".add-inline-comment").addClass("disabled")},_editFileName:function(){if("BROADCASTING"!=window.TrinketAPI._receiverBroadcastState){var b=this,c=b.$tabBar.find(".tab.active"),d=c.find(".file-name"),e=d.text(),f=e.length,g=a(v({name:e})),h=d.outerWidth();if(c.hasClass("main-editable")){if(!b.options.mainEditable)return;b.options.mainSuffix&&(f-=b.options.mainSuffix.length)}d.hide(),g.css("width",h+"px"),d.after(g),g.focus(),g[0].setSelectionRange(0,f),g.on("blur",function(f){var h,i=g.val().replace(/^\s|\s$/g,"");return a(".file-name-error").remove(),i.length?(i.length>50?h="File names must be less than 50 characters, please choose a shorter name.":"python"!==b.options.lang&&"python3"!==b.options.lang||!i.match(/\.py$/)||i.match(/^[\w][\w0-9]*(\.[a-z]+)?$/)?i.match(/^\w[\w\.\-]*$/)?a("#"+i).length?h="The name '"+i+"' is reserved, please choose a different name.":i.toLowerCase()!==e.toLowerCase()&&b.$tabBar.find(".file-name").each(function(){if(a(this).text().toLowerCase()===i.toLowerCase())return h='There is already a file named "'+i+'", please choose a different name.',!1}):h="File names must start with a letter, number, or underscore followed by zero or more letters, numbers, underscores, hyphens, and periods.":h="Python file names must start with a letter or underscore followed by zero or more letters, digits and underscores.",void(h?(b.element.find(".tab-nav").after(w({message:h})),a(document).foundation("alert","reflow"),a(this).focus(),this.setSelectionRange(0,i.length)):(d.text(i),d.show(),a(this).remove(),b._files[c.index()].name=i,b._onChange&&b._onChange(),b._files[c.index()].editor.setModeFromName(i),b.element.trigger({type:"codeeditor.fileRenamed",oldFileName:e,newFileName:i,newFile:b._files[c.index()]})))):void b._removeFile({undo:!1})}),g.on("keydown",function(b){10===b.keyCode||13===b.keyCode?a(this).blur():27===b.keyCode&&(g.val(e),a(this).blur())})}},_removeFile:function(b){var c=this,d=this.$tabBar.find(".tab.active").first(),e=this.$contentWrapper.find(".file-content.active").first(),f=origIndex=d.index(),g=d.find(".file-name").text(),h=a(x({name:g})),i=this._files.splice(origIndex,1)[0],j=origIndex===this._files.length,k=setTimeout(function(){h.find(".close").click()},15e3),l=function(){clearTimeout(k),i=void 0,d=void 0,e=void 0,h&&(h.remove(),h=void 0)};d.detach(),e.detach(),j&&(f-=1),this._selectTab(f),this._onChange&&this._onChange(),(b.undo||i.editor.getValue().length)&&(this.element.find(".tab-nav").after(h),h.find(".close").on("click",function(){i.editor.destroy(),c.element.trigger({type:"codeeditor.fileRemoved",fileName:g})}),a(".file-restore-link").on("click",function(){c._files.splice(origIndex,0,i),j?(c.$tabBar.append(d),c.$contentWrapper.children().eq(f).after(e)):(c.$tabBar.children().eq(f).before(d),c.$contentWrapper.children().eq(f).before(e)),c._selectTab(origIndex),l(),this._onChange&&this._onChange()}),a(document).one("close.fndtn.alert-box",function(a){l()}),a(".file-name-error").length&&a(".file-name-error").remove(),a(document).foundation("alert","reflow"))},_toggleFile:function(){var b=this,c=b.$tabBar.find(".tab.active");"undefined"==typeof b._files[c.index()].hidden?b._files[c.index()].hidden=!0:b._files[c.index()].hidden=!b._files[c.index()].hidden,b._files[c.index()].hidden?(c.find(".file-name").addClass("hidden-file-indicator"),a('<i class="fa fa-eye-slash file-icon"></i>').insertBefore(c.find(".file-name"))):(c.find(".file-name").removeClass("hidden-file-indicator"),c.find(".file-name").prev("i").remove()),b._onChange&&b._onChange()},_scrollTabBar:function(b){var c,d,e=this,f=300,g=50,h="swing",i=!1,j=e.$tabBar.children();b<0&&(j=a(j.get().reverse())),a(document).one(A,function(){i=!0,clearTimeout(c)}),(d=function(){var k=!0;j.each(function(){var j=a(this).position().left;return b>0&&(j+=a(this).outerWidth()),(b>0&&j>10||b<0&&j<-10)&&(e.$tabBar.animate({scrollLeft:"+="+j},200,h,function(){i||(f=Math.max(0,f-g),f||(h="linear"),c=setTimeout(d,f))}),k=!1),k})})()},_addCommentWidget:function(){var a=this._getCurrentVisibleTab();a.tabIndex>=0&&this._files[a.tabIndex].editor.addCommentWidget.call(this)},_addComment:function(a){this._files[a.index].comments.push(a),this._onChange&&this._onChange()},_removeComment:function(a){this._files[a.index].comments=_.filter(this._files[a.index].comments,function(b){return b._id!==a._id}),this._onChange&&this._onChange()},_updateComment:function(a){_.find(this._files[a.index].comments,function(b){b._id===a._id&&(b=_.extend(b,a.data))}),this._onChange&&this._onChange()},resize:function(a){for(var b=0;b<this._files.length;b++)this._files[b].editor.resize(a)},assets:function(a){return this.options.assets?this.assetBrowser.assets(a):[]},addFile:function(b,d){var f,k,l,m,n,o,p,q,r,t,v=this,w="",x="",y=this._files.length,z=!0,A=!(!d||!d.override)&&d.override;if("undefined"!=typeof jQueryXDomainRequest&&jQueryXDomainRequest&&(z=!1),"string"==typeof b&&(b={name:b}),f=b.name,x=b.type||f.split(".").pop(),w=b.content||"",p=b.hidden,t=b.comments||[],k=a(u({name:f})),l=s.clone(),v.$tabBar.find(".file-name").each(function(b){a(this).text().toLowerCase()===f.toLowerCase()&&(r=!0,y=b)}),r&&A)return a('textarea[name="'+v._files[y].name+'"]').val(w),v.$contentWrapper.children().eq(y).hasClass("active")?v._files[y].editor.setValue(w):(v._files[y].editor.destroy(),v._files[y].editor=g(l[0],{onFocus:function(){},ext:v._files[y].name.split(".").pop()||v.options.defaultFileExt,name:f,value:w,index:y}),v._files[y].editor.setValue(w),v.$contentWrapper.children().eq(y).replaceWith(l)),this._files[y];for(p&&(v.options.owner&&v.options.canHideTabs?(k.find(".file-name").addClass("hidden-file-indicator"),a('<i class="fa fa-eye-slash file-icon"></i>').insertBefore(k.find(".file-name"))):k.hide()),m=this.options.noEditor?h(l[0],{value:w}):b.image?i(l[0],{name:f,value:w}):z&&c?g(l[0],{onFocus:this.options.onFocus,ext:x||this.options.defaultFileExt,name:f,value:w,index:y,comments:t,editorOpts:this.options,onCommentChange:j.bind(this),onCommentRemove:this._removeComment.bind(this)}):e(l[0],{onFocus:this.options.onFocus,selectedLine:this.options.selectedLine,value:w,name:f}),n=0;n<this._commands.length;n++)m.addCommand.apply(m,this._commands[n]);for(n=0;n<this._plugins.length;n++)m.registerPlugin(this._plugins[n],this);this._onChange&&m.change(this._onChange),k.data({index:y}),this.$tabBar.append(k);var o=this.$contentWrapper.find(".fixed-right").first();return o.length?o.before(l):this.$contentWrapper.append(l),0===y&&(this.options.mainEditable?k.addClass("main-editable"):k.addClass("permanent")),a(".info-area .expander").click(function(){a(".info-area").hasClass("expanded")?a(".info-area").removeClass("expanded").addClass("collapsed"):a(".info-area").removeClass("collapsed").addClass("expanded")}),q={name:f,type:x,$tab:k,$content:l,editor:m,comments:t},"undefined"!=typeof p&&(q.hidden=p),this._files.push(q),this.element.trigger({type:"codeeditor.fileAdded",fileName:f,newFile:this._files[this._files.length-1]}),this._files[this._files.length-1]},hasFile:function(a){var b;for(b=0;b<this._files.length;b++)if(this._files[b].name===a)return!0;return!1},getFile:function(a){var b;for(b=0;b<this._files.length;b++)if(this._files[b].name===a)return this._files[b].editor.getValue();return""},selectFile:function(a){var b,c;for(c=0;c<this._files.length;c++)if(this._files[c].name===a){b=this._files[c].$tab;break}b||(b=this.addFile(a).$tab,c=this._files.length-1),this._selectTab(c)},serialize:function(a){var b,c,d,e=[],a=_.extend(a||{removeComments:!1});for(c=0;c<this._files.length;c++)b=this._files[c],d={name:b.name,content:b.editor.getValue()},"undefined"!=typeof b.hidden&&(d.hidden=b.hidden),!a.removeComments&&b.comments.length&&(d.comments=b.comments),e.push(d);return JSON.stringify(e)},getAllFiles:function(a){var b,c,d={};a&&"object"==typeof a?(b=a.filter||!1,c=void 0===a.values||a.values):(b=!1,c=!0),b&&"regexp"!=typeof b&&(b=new RegExp(b));for(var e=0;e<this._files.length;e++)b&&!b.test(this._files[e].name)||(d[this._files[e].name]=c?this._files[e].editor.getValue():1);return d},getAllVisibleFiles:function(){var a,b={};for(a=0;a<this._files.length;a++)this._files[a].hidden||(b[this._files[a].name]=this._files[a].editor.getValue());return b},addCommand:function(a,b,c){this._commands.push([a,b,c]);for(var d=0;d<this._files.length;d++)this._files[d].editor.addCommand(a,b,c)},updateInfo:function(b){this.options.showInfo&&(this._currentInfo=b,a(".info-area .expander").hide(),b?(a(".info-area").removeClass("empty").find(".info-quick").html(this._currentInfo.title),this.loadFullInfo(this._currentInfo)):a(".info-area").removeClass("expanded").addClass("collapsed empty"))},loadFullInfo:function(b){var c;if(b&&b.url){if(c=n[b.url],void 0!==c)return void("string"==typeof c?c.length&&(a(".info-area .info-full").html(n[b.url]),a(".info-area .expander").show()):c._cancelled=!1);this.lastInfoRequest&&(this.lastInfoRequest._cancelled=!0),this.lastInfoRequest=n[b.url]=function(){var c=a.get(b.url,"","html");return c.done(function(d){n[b.url]=d||"",d&&!c._cancelled&&(a(".info-area .info-full").html(d),a(".info-area .expander").show())}),c}()}},registerPlugin:function(a){var b=this;a.on&&a.on("info.token",function(a,c){b.updateInfo(c)}),this._plugins.push(a);for(var c=0;c<this._files.length;c++)this._files[c].editor.registerPlugin(a,this)},change:function(a){this._onChange=a;for(var b=0;b<this._files.length;b++)this._files[b].editor.change(a)},reset:function(a){for(var b;b=this._files.pop();)b.editor.destroy(),b.$content.remove(),b.$tab.remove();this._loadState(a)},highlight:function(a,b){for(var c=-1,d=0;d<this._files.length;d++)if(this._files[d].name===a){c=d;break}if(c>=0){var e=!this._files[c].$tab.hasClass("active");this._files[c].editor.highlight(b,e),this._files[c].$tab.has(I).length||this._files[c].$tab.append(" <i class='"+J+"'></i>")}},clearTabMarkers:function(){for(var b=0;b<this._files.length;b++)this._files[b].$tab.has(I).length&&this._files[b].$tab.find(I).remove();a(".ace_content").removeClass("attention-error"),a("textarea.lined").removeClass("attention-error"),a(".lineno").removeClass("lineselect")},gotoLine:function(a){this._editor&&this._editor.aceInstance&&this._editor.aceInstance.gotoLine(a)},removeComments:function(){var a,b,c,d;for(a=0;a<this._files.length;a++)if(this._files[a].comments)for(b=0;b<this._files[a].comments.length;b++)c=this._files[a].comments[b]._id,d=o[c],this._files[a].editor.getSession().removeGutterDecoration(d.row,"trinket-comment"),this._files[a].editor.getSession().removeGutterDecoration(d.row,"data-"+a+"-"+c),p[c]?this._files[a].editor.getSession().removeGutterDecoration(d.row,"collapsed"):this._files[a].editor.getSession().removeGutterDecoration(d.row,"open"),o[c].destroy(),delete o[c]}};!function(a){for(var b="setValue getValue focus isFocused".split(" "),c=function(b){a[b]=function(){var a=Array.prototype.slice.call(arguments);return this._editor[b].apply(this._editor,a)}},d=0;d<b.length;d++)c(b[d])}(N),a.widget("trinket.codeEditor",N)}(window.jQuery,window.TrinketIO,window.ace),function(a,b){"use strict";function c(a,b){var c=Date.now();return["xxxxxxxx","xxxx","4xxx","yxxx","xxxxxxxxxxxx"].join("string"==typeof a?a:"-").substr(0,b||36).replace(/[xy]/g,function(a){var b=(c+16*Math.random())%16|0;return c=Math.floor(c/16),("x"==a?b:3&b|8).toString(16)})}b.export("utils.guid",c)}(window,window.TrinketIO),function(a){a.export("sendSignalToSkulpt",function(a){null!=Sk.signals&&null!=Sk.signals.signal&&Sk.signals.signal(a)})}(window.TrinketIO),function(a){function b(){this._eventListeners,this._eventQueue=[],this._threadHandler=null,this._isDownDict={},this._signal=g}function c(a){var c,d,f;i[a.which]?(a.preventDefault(),c="",f=e(a.which),d=i[f].keyword,$("#"+h).hide(),$("#"+i[f].state).show(),h=i[f].state,Sk.sense_hat.sensestick.isKeyDown(d)?c=b.STATE_HOLD:Sk.sense_hat.sensestick.addKeyDownEventToDict(d),window.sense_hat.sensestick.push(i[f].key,c||b.STATE_PRESS)):a.ctrlKey&&"c"===String.fromCharCode(a.which).toLowerCase()&&$(document).trigger("trinket.code.stop")}function d(a){var c,d;i[a.which]&&(a.preventDefault(),d=e(a.which),c=i[d].keyword,$("#"+h).hide(),$("#_sense_hat_joystick_rest_").show(),h="_sense_hat_joystick_rest_",Sk.sense_hat.sensestick.removeKeyDownEventFromDict(c),window.sense_hat.sensestick.push(i[d].key,b.STATE_RELEASE))}function e(a){var b;return"Enter"===i[a].keyword?a:(b=Math.abs($("#sense_hat_angle").val()),b&&(a+=b/90,a>40&&(a-=4)),a)}function f(){$("#_sense_hat_joystick_enter_").hide(),$("#_sense_hat_joystick_up_").hide(),$("#_sense_hat_joystick_down_").hide(),$("#_sense_hat_joystick_left_").hide(),$("#_sense_hat_joystick_right_").hide(),$("#_sense_hat_joystick_rest_").show(),$(document).on("keydown","#sense-hat-listener",c),$(document).on("keyup","#sense-hat-listener",d)}!function(a){a.eventEmitter={_JQInit:function(){this._JQ=a(this)},emit:function(a,b){!this._JQ&&this._JQInit(),this._JQ.trigger(a,b)},once:function(a,b){!this._JQ&&this._JQInit(),this._JQ.one(a,b)},on:function(a,b){!this._JQ&&this._JQInit(),this._JQ.bind(a,b)},off:function(a,b){!this._JQ&&this._JQInit(),this._JQ.unbind(a,b)}}}($);var g=a.import("sendSignalToSkulpt");$.extend(b.prototype,jQuery.eventEmitter),b.prototype.triggerKeyboardInterrupt=function(){this.emit("sensestick.input",{type:"keyboardinterrupt"})},b.prototype.addKeyDownEventToDict=function(a){this._isDownDict[a]=!0},b.prototype.removeKeyDownEventFromDict=function(a){delete this._isDownDict[a]},b.prototype.isKeyDown=function(a){return this._isDownDict[a]===!0},b.prototype.push=function(a,c,d){var e={type:null!=d?parseInt(d):b.EV_KEY,key:parseInt(a),state:parseInt(c),timestamp:Date.now()};this._eventQueue.push(e),this.emit("sensestick.input",e)},b.prototype.destroy=function(){this._threadHandler&&this.off("sensestick.input",this._threadHandler),$(document).off("keydown","#sense-hat-listener",c),$(document).off("keyup","#sense-hat-listener",d),this._isDownDict={},this._eventQueue=[]},b.EV_KEY=1,b.STATE_RELEASE=0,b.STATE_PRESS=1,b.STATE_HOLD=2,b.KEY_UP=103,b.KEY_LEFT=105,b.KEY_RIGHT=106,b.KEY_DOWN=108,b.KEY_ENTER=28;var h="_sense_hat_joystick_rest_",i={13:{state:"_sense_hat_joystick_enter_",key:b.KEY_ENTER,keyword:"Enter"},37:{state:"_sense_hat_joystick_left_",key:b.KEY_LEFT,keyword:"ArrowLeft"},38:{state:"_sense_hat_joystick_up_",key:b.KEY_UP,keyword:"ArrowUp"},39:{state:"_sense_hat_joystick_right_",key:b.KEY_RIGHT,keyword:"ArrowRight"},40:{state:"_sense_hat_joystick_down_",key:b.KEY_DOWN,keyword:"ArrowDown"}};a.export("python.sense-stick",{initJoystick:f,SenseStickDevice:b})}(window.TrinketIO),function(a,b){function c(){var a=Date.now(),b=a;return b}function d(b){function c(a){return a<0&&(a+=360),Math.round(10*a)/10%361}var d=Geometry.Matrix();D=d.rotate(-b.roll,b.yaw,-b.pitch);var e=new Geometry.EulerAngles(b.pitch,b.roll,b.yaw),f=e.toRotate3DString();x.get(0).style.webkitTransform=f,x.get(0).style.mozTransform=f,x.get(0).style.transform=f,a.sense_hat.rtimu.raw_orientation=b.asArray();var g={pitch:c(b.pitch),roll:c(b.roll),yaw:c(b.yaw)};H.forEach(function(a){var b="sense-hat-"+a,c="sense_hat_"+a;$("#"+c).data("orientation-change","device"),$("span."+b).html(g[a]),$("#"+c).val(g[a]).change(),$("#"+c).removeData("orientation-change")})}function e(){var b=a.sense_hat.rtimu.timestamp;null!==b&&void 0!==b||(b=c());var d=c(),e=d-b;0===e&&(e=1);var g=a.sense_hat.rtimu.raw_old_orientation,h=Geometry.degToRad(a.sense_hat.rtimu.raw_orientation),i=[h[0]-g[0],h[1]-g[1],h[2]-g[2]];i=Geometry.divideArrayWithScalar(i,e);var j=h[0],k=h[1],l=h[2],m=Math.cos(l),n=Math.cos(k),o=Math.cos(j),p=Math.sin(l),q=Math.sin(k),r=Math.sin(j),s=[[m*n,m*q*r-o*p,p*r+m*o*q],[n*p,m*o+p*q*r,o*p*q-m*r],[-q,n*r,n*o]],t=Geometry.transpose2DimArray(s),u=Geometry.dot3x3and3x1(t,Geometry.Defaults.GRAVITY),v=Geometry.dot3x3and3x1(t,Geometry.Defaults.NORTH);a.sense_hat.rtimu.raw_old_orientation=h,a.sense_hat.rtimu.fusionPose=h,a.sense_hat.rtimu.timestamp=d,u=f(u,.1),a.sense_hat.rtimu.accel=[Geometry.clamp(u[0],-8,8),Geometry.clamp(u[1],-8,8),Geometry.clamp(u[2],-8,8)],i=f(i,1),a.sense_hat.rtimu.gyro=[i[0],i[1],i[2]],v=f(v,2),a.sense_hat.rtimu.compass=[100*v[0],100*v[1],100*v[2]]}function f(a,b,c,d){null==c&&(c=10);for(var e=[0,0,0],f=0;f<c;f++)e[0]+=i(a[0],b,d),e[1]+=i(a[1],b,d),e[2]+=i(a[2],b,d);return e[0]/=c,e[1]/=c,e[2]/=c,e}function g(){if(this.haveNextNextGaussian)return this.haveNextNextGaussian=!1,this.nextNextGaussian;var a,b,c;do a=2*Math.random()-1,b=2*Math.random()-1,c=a*a+b*b;while(c>=1||0===c);var d=Math.sqrt(-2*Math.log(c)/c);return this.nextNextGaussian=b*d,this.haveNextNextGaussian=!0,a*d}function h(a,b){return a+b*g()}function i(a,b,c){var d=h(0,.2),e=a+d*b;return c&&console.info("mean: ",a,d,b," rg:",e),e}function j(a,b){var c=g(),d=a+c*b,e=a+b,f=a-b;return Math.min(Math.max(f,d),e)}function k(){return"MacIntel"===navigator.platform||"MacPPC"===navigator.platform||"Mac68K"===navigator.platform}function l(a){return a.x?a.x:a.clientX?a.clientX:a.originalEvent.touches?a.originalEvent.touches[0].clientX:void 0}function m(a){return a.y?a.y:a.clientY?a.clientY:a.originalEvent.touches?a.originalEvent.touches[0].clientY:void 0}function n(a,b){var c=w.get(0).getBoundingClientRect(),d=Math.max(c.width,c.height)/2,e=(a-c.left-c.width/2)/d,f=(b-c.top-c.height/2)/d,g=e*e+f*f;return g>.5?new Geometry.Vector(e,f,.5/Math.sqrt(g)):new Geometry.Vector(e,f,Math.sqrt(1-g))}function o(a,b,c){this.pitch=a,this.roll=b,this.yaw=c}function p(a){return!a||/^[-]?[0-9]*[.]?[0-9]*$/.test(a)}function q(a){return a>=88&&a<=92&&(a=90),a>=178&&a<=182&&(a=180),a>=268&&a<=272&&(a=270),a}function r(a,b,c){if(!a&&!b&&!c)return null;var d=p(a),e=p(b),f=p(c);if(!d&&!e&&!f)return null;var g=d?parseFloat(a):-1,h=e?parseFloat(b):-1,i=f?parseFloat(c):-1;return g=q(g),h=q(h),new o(g,h,i)}function s(){function a(a){if(!(a.button||k()&&a.ctrlKey))return C=!0,F=n(l(a),m(a)),E=D,!!F&&void a.preventDefault()}function c(a){if(C){if(G=n(l(a),m(a)),!G)return!0;a.preventDefault();var b=Geometry.crossProduct(F,G),c=Geometry.calculateAngle(F,G),e=Geometry.Matrix();e=e.rotate(-90,0,0).rotateAxisAngle(b.x,b.y,b.z,c).rotate(90,0,0).multiply(E);var f=Geometry.EulerAngles.fromRotationMatrix(e),g=new o(-f.pitch,-f.roll,f.yaw);return d(g),!1}}function e(a){C=!1}w=$(".orientation-stage"),x=$(".orientation-layer"),y=$("#orientation-reset-btn"),H.forEach(function(a){var c="sense_hat_"+a;$("#"+c).data("skip-trigger",!0),"undefined"!=typeof b.runtime(c)&&($("#"+c).val(b.runtime(c)),b.runtime(c,void 0)),I[a]={$slider:$("#"+c+"[data-rangeslider]")},I[a].$slider.rangeslider({polyfill:!1,onSlideEnd:function(){if(!v)try{v=b.import("python.sense-hat")}catch(a){}v&&v.focus()}}).on("input",function(a){var b=$(a.target).data();if(!b["orientation-change"]||"device"!==b["orientation-change"]){a.preventDefault();var c=z.val().trim(),e=A.val().trim(),f=B.val().trim(),g=r(c,e,f);d(g)}})}),z=$("#sense_hat_pitch[data-rangeslider]"),A=$("#sense_hat_roll[data-rangeslider]"),B=$("#sense_hat_yaw[data-rangeslider]");var f=z.val(),g=A.val(),h=B.val(),i=new o(f,g,h);d(i),w.on("mousedown",a),w.on("touchstart",a),w.on("mousemove",c),w.on("touchmove",c),w.on("mouseup",e),w.on("mouseleave",e),w.on("touchend",e),w.on("touchcancel",e),y.on("click",function(a){a.preventDefault();var b=new o(0,0,0);d(b)})}function t(){H.forEach(function(a){I[a].$slider.rangeslider("update",!1,!1)})}function u(){H.forEach(function(a){I[a].$slider.rangeslider("destroy")})}var v,w,x,y,z,A,B,C,D,E,F,G,H=["pitch","roll","yaw"],I={};Geometry={_Eps:1e-5},Geometry.Matrix=function(){if(a.WebKitCSSMatrix)return new WebKitCSSMatrix;if(a.DOMMatrix)return new DOMMatrix;if(a.MSCSSMatrix)return new MSCSSMatrix;throw Error("Matrix not supported by the browser!")},Geometry.Vector=function(a,b,c){this.x=a,this.y=b,this.z=c},Geometry.Vector.prototype={length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},normalize:function(){var a=this.length();a<=Geometry._Eps||(this.x/=a,this.y/=a,this.z/=a)}},Geometry.transpose2DimArray=function(a){return a[0].map(function(b,c){return a.map(function(a,b){return a[c]})})},Geometry.dot3x3and3x1=function(a,b){var c=[];return c[0]=a[0][0]*b[0]+a[0][1]*b[1]+a[0][2]*b[2],c[1]=a[1][0]*b[0]+a[1][1]*b[1]+a[1][2]*b[2],c[2]=a[2][0]*b[0]+a[2][1]*b[1]+a[2][2]*b[2],c},Geometry.multiplyArrayWithScalar=function(a,b){return[a[0]*b,a[1]*b,a[2]*b]},Geometry.divideArrayWithScalar=function(a,b){return[a[0]/b,a[1]/b,a[2]/b]},Geometry.Defaults={},Geometry.Defaults.O=[0,0,0],Geometry.Defaults.X=[1,0,0],Geometry.Defaults.Y=[0,1,0],Geometry.Defaults.Z=[0,0,1],Geometry.Defaults.NORTH=Geometry.multiplyArrayWithScalar(Geometry.Defaults.X,.33),Geometry.Defaults.GRAVITY=Geometry.Defaults.Z,Geometry.clamp=function(a,b,c){var d=Math.min(c,Math.max(b,a));return d},Geometry.crossProduct=function(a,b){var c=a.y*b.z-a.z*b.y,d=a.z*b.x-a.x*b.z,e=a.x*b.y-a.y*b.x;return new Geometry.Vector(c,d,e)},Geometry.calculateAngle=function(a,b){var c=a.length(),d=b.length();if(c<=Geometry._Eps||d<=Geometry._Eps)return 0;var e=Geometry.scalarProduct(a,b)/c/d;return Math.abs(e)>1?0:Geometry.radToDeg(Math.acos(e))},Geometry.degToRad=function(a){return $.isArray(a)?[a[0]*Math.PI/180,a[1]*Math.PI/180,a[2]*Math.PI/180]:a*Math.PI/180},Geometry.radToDeg=function(a){return $.isArray(a)?[180*a[0]/Math.PI,180*a[1]/Math.PI,180*a[2]/Math.PI]:180*a/Math.PI},Geometry.scalarProduct=function(a,b){return a.x*b.x+a.y*b.y+a.z*b.z},Geometry.EulerAngles=function(a,b,c){this.pitch=a,this.roll=b,this.yaw=c},Geometry.EulerAngles.fromRotationMatrix=function(a){var b=Math.atan2(a.m23,a.m33),c=Math.atan2(-a.m13,Math.sqrt(a.m11*a.m11+a.m12*a.m12)),d=Math.atan2(a.m12,a.m11);return new Geometry.EulerAngles(Geometry.radToDeg(d),Geometry.radToDeg(b),Geometry.radToDeg(c))},Geometry.EulerAngles.prototype.toRotate3DString=function(){var a=-Math.sin(Geometry.degToRad(this.roll)),b=Math.cos(Geometry.degToRad(this.roll)),c={pitch:[0,1,0],roll:[-1,0,0],yaw:[0,a,b]},d="rotate3d("+c.pitch.join(",")+","+this.pitch+"deg) rotate3d("+c.roll.join(",")+","+this.roll+"deg) rotate3d("+c.yaw.join(",")+","+this.yaw+"deg)";return d},o.prototype.toRadians=function(){return{pitch:Geometry.degToRad(this.pitch),roll:Geometry.degToRad(this.roll),yaw:Geometry.degToRad(this.yaw)}},o.prototype.asArray=function(){return[this.roll,this.pitch,this.yaw]},a.TrinketIO.export("python.sense-orientation",{initOrientation:s,updateSliders:t,destroySliders:u,updateRTIMU:e,randomGaussian:j})}(window,window.TrinketIO),function(){function a(){var a,b;C.forEach(function(c){b="sense_hat_"+c,a=$("#"+b).val(),k(a,{sensor:c,focus:!1})})}function b(){w&&clearInterval(w),w=window.setInterval(q.updateRTIMU,16)}function c(){var b;C.forEach(function(a){var b="sense_hat_"+a;"undefined"!=typeof TrinketIO.runtime(b)&&($("#"+b).val(TrinketIO.runtime(b)),TrinketIO.runtime(b,void 0)),D[a]={$slider:$("#"+b+"[data-rangeslider]")},D[a].$slider.rangeslider({polyfill:!1,onInit:function(){k(this.value,{sensor:a,focus:!1})},onSlideEnd:function(){m()}}).on("input",function(){k(this.value,{sensor:a,focus:!0})})}),u=setTimeout(function(){a(),v=setInterval(a,250)},1500),TrinketIO.runtime("usingSenseHat3d")||("undefined"!=typeof TrinketIO.runtime("sense_hat_angle")?(t=TrinketIO.runtime("sense_hat_angle"),TrinketIO.runtime("sense_hat_angle",void 0)):"undefined"==typeof t&&(t=0),b=Math.abs(t%360),$("#_sense_hat_").css("transform","rotate(-"+Math.abs(t)+"deg)"),$("#sense_hat_angle").data("skip-trigger",!0),$("#sense-hat-display-angle").html(b+"&deg;"),270===b&&$("#_sense_hat_").css("margin-top","10%"),t>0&&(t*=-1),$("#sense_hat_angle").val(t).trigger("change"))}function d(a){var b,c,d;C.forEach(function(e){b="sense_hat_"+e,d=!!$("#"+b).length,d&&$("#"+b).data("skip-trigger",!0),"undefined"!=typeof a[b]?c=a[b]:d&&(c=$("#"+b).prop("defaultValue")),D[e]&&D[e].$slider.val(c).change()})}function e(){C.forEach(function(a){D[a].$slider.rangeslider("update",!1,!1)}),TrinketIO.runtime("usingSenseHat3d")&&q.updateSliders()}function f(){C.forEach(function(a){D[a].$slider.rangeslider("destroy")}),TrinketIO.runtime("usingSenseHat3d")&&q.destroySliders()}function g(a){var b=!1;return _.map(a,function(a,c){/\.py$/.test(c)&&(/import\s*sense_hat/.test(a)||/from\s*sense_hat\s*import/.test(a))&&(b=!0)}),b}function h(){TrinketIO.runtime("downloadExtra",r)}function i(){u&&clearTimeout(u),v&&clearInterval(v),w&&clearInterval(w)}function j(){e()}function k(a,b){var c,d,e=!isNaN(parseFloat(a))&&isFinite(a);
if(e){switch(a=Number(parseFloat(a).toFixed(2)),b.sensor){case"temperature":switch(c="&deg; C",!0){case a>=15&&a<=40:d=.5;break;case a>=0&&a<=60:d=1;break;default:d=2}break;case"pressure":c="hPa",d=.1;break;case"humidity":c="%",d=a>=20&&a<=80?3.5:5}d/=3,window.sense_hat.rtimu[b.sensor]=[1,q.randomGaussian(a,d)],$(".sense-hat-"+b.sensor).html(a+c)}else window.sense_hat.rtimu[b.sensor]=[0,-1];Sk.sense_hat&&Sk.sense_hat.rtimu&&(Sk.sense_hat.rtimu[b.sensor]=window.sense_hat.rtimu[b.sensor]),b.focus&&m()}function l(a){return 2===a.toString().length?a:"0"+a}function m(a){if("undefined"!=typeof a&&(s=a),s){var b=$("#graphic-wrap").scrollTop();$("#sense-hat-listener").focus(),b&&$("#graphic-wrap").scrollTop(b)}}Modernizr.addTest("mixblendmode",function(){return Modernizr.testProp("mixBlendMode")});var n=Modernizr.mixblendmode&&"linux"!==Detectizr.os.name,o="firefox"===Detectizr.browser.name&&"windows"==Detectizr.os.name,p=TrinketIO.import("python.sense-stick"),q=TrinketIO.import("python.sense-orientation"),r="https://trinket-app-assets.trinket.io/sense-hat/v2.2.0.zip",s=!1;window.sense_hat={rtimu:{temperature:[1,$("#sense_hat_temperature").val()],humidity:[1,$("#sense_hat_humidity").val()],pressure:[1,$("#sense_hat_pressure").val()],gyro:[0,0,0],accel:[0,0,1],compass:[0,0,0],fusionPose:[0,0,0],raw_orientation:[0,0,0],raw_old_orientation:[0,0,0]},sensestick:new p.SenseStickDevice},window.Sk_interrupt=!1;var t,u,v,w,x,y=8,z=47,A=z,B=function(a,b){var c,d,e,f=.4,g=180,h=255,i=0,j=0,k=0,m=1,p=1;if(a&&"setpixel"===a)if(c=b,d=window.sense_hat.pixels[c],e=$("#_sense_hat_led_"+l(c)+"_"),window.sense_hat.pixels[c]=[d[0]&-8,d[1]&-4,d[2]&-8],d[0]>A||d[1]>A||d[2]>A?(i=d[0]>A?(d[0]/255*(h-g)+g)/255:f,j=d[1]>A?(d[1]/255*(h-g)+g)/255:f,k=d[2]>A?(d[2]/255*(h-g)+g)/255:f,m=0,p=1):e.attr("filter",""),!o&&n)e.children(".rled").css({opacity:i}),e.children(".gled").css({opacity:j}),e.children(".bled").css({opacity:k}),e.children(".oled").css({opacity:m}),e.children(".kled").css({opacity:p});else{var q,r,s,t,u,v;q=parseInt(255*i),r=parseInt(255*j),s=parseInt(255*k),v="rgb("+[q,r,s].join(",")+")",q+r+s===0?(t=0,u=1):(t=1,u=0),e.children(".rled").css({opacity:0}),e.children(".gled").css({opacity:0}),e.children(".bled").css({opacity:0}),e.children(".oled").css({opacity:u}),e.children(".kled").css({opacity:t}),e.children(".kled").attr("fill",v)}else a&&"changeLowlight"===a&&(A=b===!0?y:z)},C=["temperature","pressure","humidity"],D={},E=!1;window.onresize=function(){TrinketIO.runtime("usingSenseHat")&&(clearTimeout(x),x=setTimeout(j,1e3))},$(document).on("click",".exit-off-canvas",function(){TrinketIO.runtime("usingSenseHat")&&setTimeout(function(){e()},500)}),$(document).on("click.sense-hat-focus","#graphic",function(){m(!0)}),$(document).on("click","#sense-hat-info-button",function(a){a.preventDefault(),$("#sense-hat-info-button").addClass("hide"),$("#sense-hat-info").removeClass("hide"),$("#sense-hat-rotate-container").addClass("hide")}),$(document).on("click","#sense-hat-info-close",function(a){a.preventDefault(),$("#sense-hat-info").addClass("hide"),$("#sense-hat-info-button").removeClass("hide"),$("#sense-hat-rotate-container").removeClass("hide")}),$(document).on("click","#sense-hat-rotate-button",function(a){if(!E){var b=t-90,c=Math.abs(b%360),d=0;E=!0,$({deg:t}).animate({deg:b},{duration:350,step:function(a){$("#_sense_hat_").css({transform:"rotate("+a+"deg)"})},complete:function(){t=b,$("#sense_hat_angle").val(c).trigger("change"),$("#sense-hat-display-angle").html(c+"&deg;"),E=!1,270===c&&(d="10%"),$("#_sense_hat_").css("margin-top",d)}})}}),$("#graphic-wrap").scroll(function(){if(TrinketIO.runtime("usingSenseHat")){var a=$(this).scrollTop(),b=-a+"px";$("#sense-hat-info-button").css({bottom:b}),$("#sense-hat-info").css({bottom:b}),$("#sense-hat-rotate-container").css({bottom:b})}}),window.TrinketIO.export("python.sense-hat",{sense_hat_emit:B,focus:m,initSensors:c,initIMU:b,destroySliders:f,updateSliders:e,resetSensors:d,usingSenseHat:g,addSrc:h,stopSenseHat:i})}(),function(a,b){function c(a,c){y[a]||b.ajax({async:!1,type:"GET",url:a,dataType:c&&c.dataType?c.dataType:"script",success:function(b,d){y[a]=!0,c&&c.success&&c.success(b)}})}function d(a){var c=b("#console-output");c.removeClass("hide"),c.html(c.html()+a)}function e(a,c){var d,e="code-error";if(c&&"validation"===c.type&&(e="info",a=c.message),!(c&&"interrupt"===c.message||a&&/KeyboardInterrupt/.test(a))){var d=k("statusMessageTemplate",{type:e,message:a}),f=b(d);b("body").append(f),b("body").addClass("has-status-bar"),f.parent().foundation().trigger("open.fndtn.alert")}}function f(a,b,c){var d=c[a]||b[a];if(void 0===d)throw"File not found: '"+a+"'";return d}function g(a){var b=document.createEvent("Event");b.data=a.mode.v+":"+a.name,b.initEvent("SkfileOpen",!0,!0),document.dispatchEvent(b)}function h(a,b){var c=document.createEvent("Event");c.data=a.name+":"+b.v,c.initEvent("SkfileWrite",!0,!0),document.dispatchEvent(c)}function i(a){return a.replace(/[&<>]/g,function(a){return q[a]||a})}var j,k=a.import("utils.template"),l=a.import("python.sense-hat"),m=a.import("python.sense-stick"),n=a.import("python.sense-orientation"),o=function(c,d){function e(){if(0===b("#_sense_hat_").height())setTimeout(e,250);else{var a=b("#_sense_hat_").height();b(".orientation-box").css({width:g+"px",height:a+"px"}),b(".orientation-front").css({width:g+"px",height:a+"px"});var c=(g-a)/2;b(".orientation-back").css({width:a+"px",height:g+"px",transform:"rotateY(180deg) rotateZ(270deg) translateX("+c+"px) translateY(-"+c+"px)"})}}d.html(j);var f=b("#graphic-wrap").width(),g=f-.1*f,h=b("#sense-hat-sensor-controls-container").height(),i=b("#orientation-sliders-overlay").height(),k=b("#graphic-wrap").height()-h-i,m=b("#Sense_x5F_HAT_x5F_Pi").get(0).getBBox().height;b(".orientation-stage").css({width:g+"px",height:k+"px"}),b(".orientation-box").css({width:g+"px",height:m+"px"}),b(".orientation-front").css({width:g+"px",height:m+"px"}),function f(){0===b("#sense-hat-sensor-controls-container").width()?setTimeout(f,100):(e(),c._3d?(d.find(".3d").removeClass("hide"),a.runtime("usingSenseHat3d",!0),function a(){0===b("#orientation-sliders-overlay").width()?setTimeout(a,100):n.initOrientation()}()):(d.find(".2d").removeClass("hide"),a.runtime("usingSenseHat3d",void 0)),l.initSensors())}(),b("#graphic-wrap").addClass("sense-hat")};b("#graphic-wrap").on("split-output",function(c){if(a.runtime("usingSenseHat")&&b(".orientation-stage").length){var d=b(".orientation-stage").height()-b("#console-wrap").height();b(".orientation-stage").css({height:d+"px"})}});var p,q={"&":"&amp;","<":"&lt;",">":"&gt;"},r="evaluationresult = ",s=/^\s*print\b/,t=/^\s*(from\s+\w+\s+)?import\b/,u=/(def|class|for|while|del)\b.*/,v=/^\s*$/,w=/[^!=<>]=[^=]/,x=/^\s*#/,y={},z=/^(turtle|pygal|processing|matplotlib\.pyplot|image|sense_hat)$/i,A={sense_hat:["image"],image:["sense_hat"]},B={turtle:function(a,b){"function"==typeof p&&p();var c=a.graphicsWidth(),d=a.graphicsHeight(),e=Math.min(c,d);return Sk.TurtleGraphics||(Sk.TurtleGraphics={}),Sk.TurtleGraphics.width=e,Sk.TurtleGraphics.height=e,Sk.TurtleGraphics.worldWidth=400,Sk.TurtleGraphics.worldHeight=400,Sk.TurtleGraphics.target=b[0],Sk.TurtleGraphics.assets=function(b){if(a.userAssets)for(var c=0;c<a.userAssets.length;c++)if(a.userAssets[c].name===b)return a.userAssets[c].url},b.data("graphicMode","turtle"),b.empty()},pygal:function(a,b){return"function"==typeof p&&p(),b.data("graphicMode","pygal"),b.empty()},image:function(a,b){return"function"==typeof p&&p(),Sk.canvas="graphic","undefined"!=typeof ImageMod&&(ImageMod.canvasLib=[]),Sk.imageProxy=function(b){if(!a.userAssets)return b;for(var c=0;c<a.userAssets.length;c++)if(a.userAssets[c].name===b)return a.userAssets[c].url;return b},b.empty()},processing:function(a,b){"function"==typeof p&&p();var d=Sk.canvas="processingCanvas";return c("/components/processing/processing.min.js"),b.data("graphicMode","processing"),b.html('<canvas style="display:none" id="'+d+'" width="400" height="400"></canvas>')},"matplotlib.pyplot":function(a,b){"function"==typeof p&&p();var c=Sk.canvas="matplotlibCanvas";return b.data("graphicMode","matplot"),b.html('<div id="'+c+'"></div>')},sense_hat:function(a,d){if(Sk.sense_hat||(Sk.sense_hat=a.sense_hat),Sk.sense_hat_emit||(Sk.sense_hat_emit=a.sense_hat_emit),j)0===b("#sense-hat-sensor-controls-container").length&&o(a,d);else{var e;e="firefox"==Detectizr.browser.name&&"windows"==Detectizr.os.name?trinketConfig.prefix("/partials/sense-hat-ff.html"):trinketConfig.prefix("/partials/sense-hat.html"),c(e,{dataType:"html",success:function(b){j=b,o(a,d)}})}m.initJoystick(),p=function(){l.destroySliders(),b("#graphic-wrap").removeClass("sense-hat"),p=void 0},d.data("graphicMode","sense hat")}},C={pygal:{path:trinketConfig.prefix("/components/pygal.js/__init__.js"),dependencies:[trinketConfig.prefix("/js/vendor/highcharts/highcharts.js"),trinketConfig.prefix("/js/vendor/highcharts/highcharts-more.js")]},numpy:{path:trinketConfig.prefix("/components/skulpt_numpy/dist/numpy/__init__.js")},"numpy.random":{path:trinketConfig.prefix("/components/skulpt_numpy/dist/numpy/random/__init__.js")},matplotlib:{path:trinketConfig.prefix("/components/skulpt_matplotlib/matplotlib/__init__.js")},"matplotlib.pyplot":{path:trinketConfig.prefix("/components/skulpt_matplotlib/matplotlib/pyplot/__init__.js"),dependencies:[trinketConfig.prefix("/components/d3/d3.min.js")]},json:{path:trinketConfig.prefix("/components/json.sk/__init__.js"),dependencies:[trinketConfig.prefix("/components/json.sk/stringify.js")]},xml:{path:trinketConfig.prefix("/components/xml.sk/__init__.js")},"xml.etree":{path:trinketConfig.prefix("/components/xml.sk/etree/__init__.js")},"xml.etree.ElementTree":{path:trinketConfig.prefix("/components/xml.sk/etree/ElementTree.js")},itertools:{path:trinketConfig.prefix("/js/skulpt/itertools.js")},os:{path:trinketConfig.prefix("/js/skulpt/os.js")},"trinket.checks":{path:trinketConfig.prefix("/js/skulpt/trinket/checks.js")},"trinket.tester":{path:trinketConfig.prefix("/js/skulpt/trinket/tester/__init__.py")},"trinket.ast":{path:trinketConfig.prefix("/js/skulpt/trinket/ast/__init__.py")},_ast:{path:trinketConfig.prefix("/js/skulpt/trinket/ast/_ast.js")},trinket:{path:trinketConfig.prefix("/js/skulpt/trinket/__init__.js")}};a.export("Skulpt",function(a){var c={evalMode:"main",allowGraphics:!0,autoEscape:!1,read:f,write:d,error:e,graphicsSetup:B,includeFileInErrors:!1,graphicsWidth:function(){return b(a.graphicsTarget()).parent().width()},graphicsHeight:function(){return b(a.graphicsTarget()).parent().height()},externalLibraries:C};a=b.extend({},c,a),a.allowGraphics&&(a.graphicsSetup=b.extend({},B,a.graphicsSetup),a.graphicsTarget=a.graphicsTarget||function(){return b("#graphic")});var j,k=function(b){a.autoEscape&&(b=i(b)),a.write(b)},l="__abort_code__",m=function(b,c,d,e,f,g){var h={complete:!1};"repl"!==a.evalMode&&Sk.TurtleGraphics&&Sk.TurtleGraphics.reset&&Sk.TurtleGraphics.reset();return Sk.misceval.asyncToPromise(function(){return Sk.importMainWithBody(a.evalMode,!1,b,!0)},{"*":function(){if(window.Sk_interrupt===!0)throw new Error("interrupt");return null}}).then(function(a){h.complete=!0,e&&"function"==typeof e&&e(),Sk.sense_hat&&Sk.sense_hat.sensestick.destroy()},function(a){return a===l?void(g&&"function"==typeof g&&g()):(h.complete=!0,f(a),void(Sk.sense_hat&&Sk.sense_hat.sensestick.destroy()))}),h};return function(c,d,e,f){var l,n,o,p;if(j&&!j.complete&&(j.stop=!0),!c||/^\s*$/.test(c))return d();var q={print_function:!1,division:!0,absolute_import:null,unicode_literals:!0,set_repr:!0,class_repr:!0,inherit_from_object:!0},y={print_function:!1,division:!1,absolute_import:null,unicode_literals:!1,set_repr:!1,class_repr:!1,inherit_from_object:!1},B={print_function:!0,division:!0,absolute_import:null,unicode_literals:!0,set_repr:!0,class_repr:!0,inherit_from_object:!0},C=c.match(/^\s*#!.*?python(\d)/i),D=c.match(/^\s*#\s*python\s*[=:]?\s*(\d)/i);D?Sk.__future__="2"===D[1]?y:q:C?Sk.__future__="3"===C[1]?B:y:Sk.__future__=q;var E=function(b){var c,d=i(b.toString());if(b.traceback&&b.traceback.length){for(c=0;c<b.traceback.length;c++)"undefined"!=typeof a.userFiles[b.traceback[c].filename]&&(b.filename=b.traceback[c].filename,b.lineno=b.traceback[c].lineno);"undefined"==typeof b.filename&&(b.filename=b.traceback[b.traceback.length-1].filename,b.lineno=b.traceback[b.traceback.length-1].lineno)}if(a.includeFileInErrors&&b.filename&&(d=d.replace(/on line \d+/,"on line "+b.lineno),d=d+" in "+b.filename.replace(/^\.\//,"")),/^ImportError: No module named/.test(d)&&(d+=". You can find a list of available modules at <a href='/docs/python' class='text-link' target='_blank'>docs/python</a>."),"repl"===a.evalMode){d+="\n";var f=-1;(f=b.toString().indexOf("on line"))!==-1&&(f=parseInt(b.toString().substr(f+8),10));var g=0;d+=n?"1>: "+o[0].substr(r.length):o.map(function(a){return++g+(f===g?">":" ")+": "+a}).join("\n")}a.error(d,b),e&&"function"==typeof e&&e(d,b)};if(Sk.configure({inputfun:a.inputfun,__future__:Sk.__future__,retainglobals:"repl"===a.evalMode,output:k,read:function(b){return a.read(b,Sk.builtinFiles.files||{},a.userFiles||{})},write:function(){},nonreadopen:!0,fileopen:g,filewrite:h,imageProxy:a.imageProxy||"",uncaughtException:E,signals:!0,killableWhile:"midori"!==Detectizr.browser.name&&"iceweasel"!==Detectizr.browser.name&&"epiphany"!==Detectizr.browser.name}),Pygame.init("/components/pygame.sk/skulpt_module"),b.extend(Sk.externalLibraries,a.externalLibraries),a.allowGraphics&&(Sk.availableWidth=a.graphicsWidth(),Sk.availableHeight=a.graphicsHeight()),Sk.domOutput=function(c){return b(a.graphicsTarget()).append(c).children().last()},Sk.onBeforeImport=function(c){if(z.test(c)){if(!a.allowGraphics)return"Graphics libraries are not allowed";if(l){if(l!==c&&(!A[l]||A[l].indexOf(c)<0))return"You may only use a single graphics library at a time and the "+l+" library is already in use."}else"function"==typeof a.onGraphicsInit&&a.onGraphicsInit(),a.graphicsSetup[c](a,b(a.graphicsTarget())),l=c}if(a.onBeforeImport)return a.onBeforeImport(c)},a.onAfterImport&&(Sk.onAfterImport=a.onAfterImport),"repl"===a.evalMode){if(o=c.split("\n").filter(function(a){return!v.test(a)}),n=1===o.length||/"""/.test(o[0])&&/"""/.test(o[o.length-1]),n&&!w.test(o[0])&&!u.test(o[0])&&!t.test(o[0])&&o[0].length>0&&(s.test(o[0])||x.test(o[0])||(o.unshift(r+o.shift()),o.push("if not evaluationresult == None: print evaluationresult"))),o=o.filter(function(a){return!v.test(a)}),0===o.length)return;c=o.join("\n")}return j=m(c,n,o,d,E,f),!p}})}(window.TrinketIO,window.jQuery),function(a){function b(a){this._pollInterval=void 0,this._analytics=a,this._events={},$(window).on("blur",$.proxy(this.poll,this))}b.POLL_INTERVAL=3e4,b.prototype.poll=function(){if(this._pollInterval){for(var a in this._events)this._events[a]&&this._analytics(a,this._events[a]),this._events[a]=0;clearTimeout(this._pollInterval),this._pollInterval=void 0}},b.prototype.logEvent=function(a){var c=this;c._events[a]=(c._events[a]||0)+1,this._pollInterval||(this._pollInterval=setTimeout($.proxy(this.poll,this),b.POLL_INTERVAL))},a.export("embed.analytics.activity",b)}(window.TrinketIO),function(a,b){function c(a){var b=a.toString().match(/^(.*?)[:;]\s*(.*?)(?:on\sline\s(\d+).*)?$/i);return!!(b&&b[1]&&b[2])&&{error:b[0],type:b[1],message:b[2],line:b[3]?parseInt(b[3]):-1}}function d(){M||(M=!0,$("#console-wrap").removeClass("hide"),N?e():$("#console-wrap").css("height","100%"),C=$("#console-output").jqconsole(),C.Write('Powered by <img src="'+trinketConfig.prefix("/img/trinket-logo.png")+'">\n',"jqconsole-header",!1))}function e(){if($("#output-dragbar").hasClass("hide")){$("#output-dragbar").removeClass("hide");var a=$("#outputTabs").height(),b=$(".trinket-content-wrapper").height()-a,c=$("#output-dragbar").height(),d=.8*b-c/2,e=b-d-c/2;$("#graphic-wrap").css("height",d),$("#console-wrap").css("height",e),$("#graphic-wrap").trigger("split-output")}}function f(){$("#unittest-wrap").removeClass("hide").css("height","100%")}function g(a){switch(a){case"turtle":I=!0,"run"===A&&i(!0);break;case"urllib.request":if($("#proxy").val()){var c={},d=Sk.sysmodules.mp$subscript(a);d.$d.urlopen.func_code=function(a,b,e){if(void 0===c[a.v]){var f=$("#proxy").val()+"?url="+encodeURIComponent(a.v),g=new XMLHttpRequest;g.open("GET",f,!1),g.send(null),c[a.v]=g.responseText}return Sk.misceval.callsim(d.$d.Response,{responseText:c[a.v]})}}break;case"sense_hat":b.runtime("usingSenseHat",!0),U.initIMU(),U.addSrc()}"function"==typeof v.afterImport&&v.afterImport(a)}function h(){return y||(y=$('<div class="turtle-overlay hide" data-action="graphic.focus" data-interface="output"></div>'),y.insertAfter("#graphic"),y.on("click",function(){i(!0)})),y}function i(a){if(I)return void 0!==a&&(a=!!a,a?(h().addClass("hide"),$("#graphic").focus(),$(document).on("keydown.turtle-focus",function(a){a.preventDefault()}),v.sendInterfaceAnalytics(h()),$(document).on("mousedown.turtle-focus",function(a){$("#graphic-wrap").is(":hover")||i(!1)})):($(document).off("keydown.turtle-focus"),$(document).off("mousedown.turtle-focus"),h().removeClass("hide"))),Sk.TurtleGraphics.focus(a)}function j(a){w.clearTabMarkers(),C&&(C.Write("[0m"),C.Reset(),C.Write('Powered by <img src="'+trinketConfig.prefix("/img/trinket-logo.png")+'">\n',"jqconsole-header",!1)),a||b.runtime("usingSenseHat")||($("#graphic").empty(),$("#graphic").removeData("graphicMode"))}function k(){var a=w.assets();$("#imageAssets").empty(),ea=a.length,fa=0,ea&&(da=!0),a.forEach(function(a){var b=/^data:image/.test(a.url)?a.url:l(a.url),c=new Image;c.id=a.name,c.className="hide",c.onload=function(){$("#imageAssets").append(c),fa++,fa>=ea&&(da=!1)},c.src=b})}function l(a){var b=$("#proxy").val(),c=new RegExp(b+"/","g");return a=a.replace(c,""),a=b+"/"+a}function m(a,b){var c,d,e;for(d in O)delete O[d];$(".hidden-file").remove();for(d in a)d===b?c=a[d]:(d.match(/\.py$/)&&(O["./"+d]=a[d]+"\n"),$("#"+d).length||(e=$("<textarea>",{id:d,text:a[d]+"\n",name:d,class:"hide hidden-file"}),$("body").append(e)));return P.length=0,P.push.apply(P,w.assets()),$("#proxy").val()&&P.forEach(function(a){/^data:image/.test(a.url)||(a.url=l(a.url))}),c}function n(){$(".reveal-modal").foundation("reveal","close"),null==G&&(G=J(ca));var a,b=($("#graphic"),v.getValue());a=m(w.getAllFiles(),R),$("#statusMessages").children().length&&$("#statusMessages").trigger("close.fndtn.alert").remove(),"function"==typeof v.beforeRun&&(a=v.beforeRun(a)),I=!1,h().addClass("hide");var c=document.activeElement;G(a,function(){B=!1,K=void 0,"function"==typeof v.afterRun&&v.afterRun(a),v.collectErrorData(b)},function(c){B=!0,K=void 0,"function"==typeof v.afterRun&&v.afterRun(a),v.collectErrorData(b,c);var d=/on line (\d+) in (.+)$/,e=c.match(d);e&&v.highlightLine(e[2],e[1])},function(){}),I?$("#graphic").focus():K||c!==document.activeElement||("none"!=$("#editor").css("display")?v.focus():w.options.noEditor||$("#honeypot").focus()),v.updateMetric("runs",b),!H[b]&&v.isModified()&&v.callAnalytics("Interaction","Modify","Code"),v.markCodeAsRun(b)}function o(){if($(".reveal-modal").foundation("reveal","close"),D="run",W)p(),setTimeout(o,250);else if(da)setTimeout(o,500);else{null==E&&(v._queryString._3d&&(aa._3d=!0,b.runtime("usingSenseHat3d",!0)),E=J(aa)),a.Sk_interrupt=!1;var c,d=v.getValue();c=m(w.getAllFiles(),Q),j(),$("#console-output").removeClass("console-mode"),$("#statusMessages").children().length&&$("#statusMessages").trigger("close.fndtn.alert").remove(),"function"==typeof v.beforeRun&&(c=v.beforeRun(c)),I=!1,h().addClass("hide");var e=b.runtime("usingSenseHat");b.runtime("usingSenseHat",!1),b.runtime("downloadExtra",void 0);var f=document.activeElement;W=!0;var g=setTimeout(function(){W&&b.runtime("usingSenseHat")&&v.changeRunOption("stop")},500);E(c,function(){B=!1,K=void 0,"function"==typeof v.afterRun&&v.afterRun(c),v.collectErrorData(d),q(g)},function(a){if(B=!0,K=void 0,"function"==typeof v.afterRun&&v.afterRun(c),!/interrupt/i.test(a)){v.collectErrorData(d,a);var f=/on line (\d+) in (\S+)/,h=a.match(f);if(h){var i=h[2].replace(/\.$/,"");v.highlightLine(i,h[1])}b.runtime("usingSenseHat",e)}q(g)},function(){b.runtime("usingSenseHat",e),q(g)}),I?$("#graphic").focus():b.runtime("usingSenseHat")?U.focus(!0):K||f!==document.activeElement||("none"!=$("#editor").css("display")?v.focus():w.options.noEditor||$("#honeypot").focus()),v.updateMetric("runs",d),!H[d]&&v.isModified()&&(v.callAnalytics("Interaction","Modify","Code"),b.runtime("usingSenseHat")&&v.callAnalytics("Sense Hat Event","Modify","Code")),v.markCodeAsRun(d)}}function p(){a.Sk_interrupt=!0,X(0),a.sense_hat.sensestick.triggerKeyboardInterrupt(),b.runtime("usingSenseHat")&&U.stopSenseHat()}function q(a){a&&clearTimeout(a),W=!1,v.changeRunOption(D)}function r(){if($(".reveal-modal").foundation("reveal","close"),D="console",W)p(),setTimeout(r,250);else if(da)setTimeout(r,500);else{Sk.globals&&(Sk.globals={__name__:Sk.globals.__name__}),d(),$("#console-output").addClass("console-mode"),null==F&&(F=J(ba));var a,b=($("#graphic"),v.getValue(),[]);a=m(w.getAllFiles(),Q),j(),$("#statusMessages").children().length&&$("#statusMessages").trigger("close.fndtn.alert").remove(),"function"==typeof v.beforeRun&&(a=v.beforeRun(a)),a&&(b=a.split("\n")),I=!1,h().addClass("hide"),s({history:b})}}function s(c){var d=!1;C.Prompt(!0,function(d){if(/^\s*$/.test(d))s(c);else{a.Sk_interrupt=!1,W=!0;var e=setTimeout(function(){W&&b.runtime("usingSenseHat")&&v.changeRunOption("stop")},500);F(d,function(){s(c),q(e)},function(a,d){b.runtime("usingSenseHat")&&/interrupt/i.test(d.toString())||C.Write(u(d.toString()),"jqconsole-error",!1),s(c),q(e)},function(){q(e)}),v.callAnalytics("Interaction","Modify","Code")}},function(a){var b,c,e;return e=a.split("\n"),0===e.length?0:(c=e[e.length-1],b=c.match(/^\s*/)[0],c=e[e.length-1].replace(/\s+$/,""),/"""/.test(c)&&!/""".*"""/.test(c)&&(d=!d),C._enteringHistory?b.length?-b.length:0:d?0:/^\s*#/.test(c)||":"!==c[c.length-1]?b.length&&c&&0!==c[c.length-1].length?0:!!/^\s*#/.test(c)&&0:1)}),C.Focus(),t(c.history)}function t(a){var b,c,d,e;if(a.length)for(C._enteringHistory=!0;a.length;){for(b=a.shift(),c=b.split(""),d=0;d<c.length;d++)e=$.Event("keypress"),e.which=c[d].charCodeAt(0),C.$input_source.trigger(e);a.length||(C._enteringHistory=!1),e=$.Event("keydown"),e.which="\r".charCodeAt(0),C.$input_source.trigger(e)}}function u(a){var b={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"};return a.replace(/[&<>"']/g,function(a){return b[a]})}var v,w,x,y,z,A,B,C,D,E,F,G,H={},I=!1,J=b.import("Skulpt"),K=void 0,L=!1,M=!1,N=!1,O={},P=[],Q="main.py",R="tests.py",S=b.import("utils.guid"),T=b.import("utils.template"),U=b.import("python.sense-hat"),V=b.import("embed.analytics.activity"),W=!1,X=b.import("sendSignalToSkulpt"),Y=function(a){d(),a=a.replace(/\0(33)\[/g,"["),C.Write(a)},Z=function(a){return d(),new Promise(function(b,c){var d=document.activeElement;C.Write(a),$("#console-output").addClass("console-active"),C.Input(function(a){$("#console-output").removeClass("console-active"),v.activityLog&&v.activityLog.logEvent("Text Input"),b(a),d&&$(d).focus()}),K||C.Focus()})},_=function(){N||(N=!0,$("#graphic-wrap").removeClass("hide"),M?e():$("#graphic-wrap").css("height","100%"))},aa={evalMode:"main",onAfterImport:g,userFiles:O,userAssets:P,includeFileInErrors:!0,imageProxy:$("#proxy").val(),write:Y,inputfun:Z,onGraphicsInit:_,sense_hat:a.sense_hat,sense_hat_emit:U.sense_hat_emit},ba={evalMode:"repl",onAfterImport:g,userFiles:O,userAssets:P,includeFileInErrors:!1,imageProxy:$("#proxy").val(),write:Y,inputfun:Z,onGraphicsInit:_,sense_hat:a.sense_hat,sense_hat_emit:U.sense_hat_emit,error:function(a,b){}},ca={evalMode:"tests",userFiles:O,userAssets:P,includeFileInErrors:!0,write:function(a){f()},inputfun:function(a){return f(),new Promise(function(a,b){a()})}},da=!1,ea=0,fa=0;!function(){var a=/^(input|text|password|file|email|search|date)$/i;$(document).bind("keydown",function(b){var c,d=!0;8===b.keyCode&&(c=b.srcElement||b.target,("textarea"===c.tagName.toLowerCase()||"input"===c.tagName.toLowerCase()&&c.type.match(a))&&(d=c.readOnly||c.disabled),d&&b.preventDefault())})}(),a.TrinketAPI={initialize:function(c){v=this,z=$("#start-value").val(),A=$("#runOption-value").val(),v.runMode=$("#runMode-value").val(),K="result"===z&&!$("body").hasClass("has-status-bar"),w=$("#editor").codeEditor({showTabs:!this._queryString.outputOnly,noEditor:!!this._queryString.outputOnly,mainFileName:Q,showInfo:!0,assets:c.assets?c.assets.slice():[],guest:"guest"===v.getUIType(),owner:"owner"===v.getUIType(),canHideTabs:v.hasPermission("hide-trinket-files"),canAddInlineComments:v.hasPermission("add-trinket-inline-comments")&&"owner"===v.getUIType(),userId:v.getUserId(),lang:"python",onFocus:function(){i(!1)},assetsHowTo:"#assets-howto-message"}).data("trinket-codeEditor");var d={trinketIdentifier:v.getTrinketIdentifierOrNull(),userIdentifier:v.getUserId()};a.trinketBroadcast&&a.trinketBroadcast.connection&&a.trinketBroadcast.connection.initialize(w,d),k();var e=v.save;v.save=function(a,b){e.call(v,a,function(a,c){"function"==typeof b&&b(a,c)})},$(document).on("sk.system.clear",function(){j(!0)}),$("#reset-output").click(function(){j(!0)}),$(document).on("assets.change",function(){k(),v.triggerChange()}),$(document).on("open.fndtn.alert",function(){w.resize()}),$(document).on("close.fndtn.alert",function(){w.resize(),b.runtime("usingSenseHat")&&U.updateSliders()}),w.addCommand("run",{win:"Ctrl-Enter",mac:"Command-Enter"},function(a){$("#editor").trigger("trinket.code.run",{action:"code.run"})}),w.addCommand("test",{win:"Shift-Ctrl-Enter",mac:"Shift-Command-Enter"},function(a){$("#editor").trigger("trinket.code.check",{action:"code.check"})});try{x=b.import("python.editor.hints"),AutoCompletePlugin=b.import("python.editor.autocomplete"),v._queryString&&v._queryString.inLibrary&&AutoCompletePlugin.setInLibrary(!0),w.registerPlugin(x),w.registerPlugin(AutoCompletePlugin)}catch(a){}this._errorGroup=0,this._sessionId=S(),this._previousError=void 0,$(document).on("trinket.code.edit",$.proxy(this.showCode,this)),$(document).on("trinket.code.run",$.proxy(this.showResult,this)),$(document).on("trinket.code.stop",$.proxy(this.stopExecution,this)),$(document).on("trinket.code.check",$.proxy(this.showTestResult,this)),$(document).on("trinket.code.console",$.proxy(this.consoleResult,this)),$(document).on("trinket.output.view",$.proxy(v.showOutput,v)),$(document).on("trinket.instructions.view",$.proxy(v.showInstructions,v)),this.viewer="#codeOutput",$(document).on("trinket.code.modules",$.proxy(this.toggleModules,this)),$("#honeypot").on("keydown",$.proxy(this.showCode,this)),$("#menu").on("trinket.sharing.share trinket.sharing.embed trinket.sharing.email",function(a){v.isModified()&&!H[v.getValue()]&&($("#runFirstModal").foundation("reveal","open"),a.preventDefault())}),$('.menu-toolbar .menu-button[data-action="code.run"]').on("mousedown",function(a){w&&w.isFocused()&&a.preventDefault()}),$('.menu-toolbar .menu-button[data-action="code.check"]').on("mousedown",function(a){w&&w.isFocused()&&a.preventDefault()}),$("#modalRun").click(function(){sendInterfaceAnalytics(this),$("#runFirstModal").foundation("reveal","close"),o()}),c.settings&&c.settings.testsEnabled&&$(".check-it").hasClass("hide")&&$(".check-it").removeClass("hide"),v.reset(c,!0),w.change(function(){v.triggerChange()}),v.draggable(function(){b.runtime("usingSenseHat")&&U.updateSliders()}),$("#output-dragbar").mousedown(function(a){a.preventDefault();var b=$("#outputTabs").height(),c=$(".trinket-content-wrapper").height()-b,d=$(".trinket-content-wrapper").offset().top+b,e=$("#output-dragbar").height();$(document).on("mousemove.output-dragbar",function(a){var b=a.pageY-d-e/2,f=c-b-e/2;b>=20&&f>=20&&($("#graphic-wrap").css("height",b),$("#console-wrap").css("height",f))}),$(document).on("mouseup.output-dragbar",function(a){$(document).off("mousemove.output-dragbar mouseup.output-dragbar")}),v.sendInterfaceAnalytics(this)}),v.activityLog=new V(function(a,b){var c=a.replace(/[a-zA-Z0-9](?:[^\s\-\._]*)/g,function(a){return a.charAt(0).toUpperCase()+a.substr(1)});v.sendAnalytics("Output",{action:c,label:v.getTrinketIdentifier(),value:b})}),$(document).keydown(function(a){var c=$("#graphic").data("graphicMode");(/turtle/i.test(c)&&$(".turtle-overlay").hasClass("hide")||/sense\s*hat/i.test(c)&&b.runtime("usingSenseHat"))&&v.activityLog.logEvent(c+" Key")}),$(document).on("mousedown","#graphic-wrap",function(a){var b;"sense-hat-rotate-button"===$(a.target).attr("id")||"sense-hat-rotate-button"===$(a.target).parent().attr("id")?v.callAnalytics("Sense Hat Event","Click","RotateButton"):(b=$("#graphic").data("graphicMode"),b?v.activityLog.logEvent(b+" Click"):v.activityLog.logEvent("Output Click"))}),$(document).on("change","[data-rangeslider]",function(a){v.callAnalytics("Sense Hat Event","Click","Sensor")})},collectErrorData:function(b,d){var e,f,g=d&&c(d),h=this._previousError;h&&(h.attempt+=1,f=a.JsDiff.createPatch("attempt"+h.attempt,h.code,b),e={session:this._sessionId,error:h.error,group:h.group,type:h.type,message:h.message,line:h.line,code:h.code,elapsed:Date.now()-h.time,totalElapsed:Date.now()-h.firstTime,delta:f.substr(f.indexOf("@")),attempt:h.attempt},g&&(e.introduced=g.error),g&&h.message===g.message?(e.state="repeated",this.logError(e),h.time=Date.now(),g=void 0):(e.state="resolved",this.logError(e),g||(this._previousError=void 0))),g&&(g.group=++this._errorGroup,g.code=b,g.time=g.firstTime=Date.now(),g.attempt=0,this.logError({state:"encountered",session:this._sessionId,group:g.group,error:g.error,type:g.type,message:g.message,line:g.line,attempt:g.attempt,code:b}),this._previousError=g)},highlightLine:function(a,b){w.highlight(a,b)},getTour:function(){var a=this.getUIType(),b=[];return"owner"!==a&&("none"!==$(".mode-toolbar .show-for-small-only").css("display")?($("#editor").hasClass("hide")||b.push({el:".run-it",event:"code.run"}),b.push({el:".edit-it",event:"code.edit"},{el:".ace_content",event:"code.change"},{el:".run-it",event:"code.run"})):"result"!==$("#start-value").val()&&this._trinket.code?b.push([{el:".run-it",event:"code.run"},{el:".ace_content",event:"code.change"}]):b.push({el:".ace_content",event:"code.change"},{el:".run-it",event:"code.run"}),b.push({el:".left-menu-toggle",event:"menu.options"},{el:".share-it",event:"sharing.share"}),"guest"===a&&b.push({el:".right-menu-toggle",event:"menu.user"}),b.push({el:".save-it",event:"library.add"})),b},getEditor:function(){return w},getType:function(){return"python"},getValue:function(a){return w.serialize(a)},getMainFile:function(){return Q},isDirty:function(){if(!this._trinket)return!1;if(this.getValue()!==(this._original.code||""))return!0;var a=w.assets();return a.length!==(this._original.assets||[]).length||(JSON.stringify(a)!==JSON.stringify(this._original.assets)||JSON.stringify(this._trinket.settings)!==JSON.stringify(this._original.settings))},getAnalyticsCategory:function(){return"Python"},serialize:function(a){var b={code:this.getValue(a),consoleOutput:$("#console-output").text(),hasError:B,assets:w.assets().slice(),settings:this._trinket.settings};return a&&a.removeComments&&w.removeComments(),b},showMessage:function(a,b){var c=T("statusMessageTemplate",{type:a,message:b}),d=$(c);$("body").addClass("has-status-bar").append(d),d.parent().foundation().trigger("open.fndtn.alert")},showCode:function(a){$("#codeOutput").addClass("hide"),$("#editor").removeClass("hide"),v.closeOverlay("#modules"),v.focus(),i(!1)},showResult:function(a){"run"!==A&&a&&"run"===$(a.target).data("button")&&v.changeRunOption("run"),v.runMode="",v.triggerRunModeChange(),$("#codeOutput").removeClass("hide"),$("#editor").addClass("hide"),$("#unittest-wrap").addClass("hide"),v.closeOverlay("#modules"),$("#instructionsContainer").addClass("hide"),$("#outputContainer").removeClass("hide"),$("#codeOutputTab").addClass("active"),$("#instructionsTab").removeClass("active"),
o(),a&&(v.callAnalytics("Interaction","Click","Run"),b.runtime("usingSenseHat")&&v.callAnalytics("Sense Hat Run","Click","Run"))},stopExecution:function(a){p()},showTestResult:function(a){$("#codeOutput").removeClass("hide"),$("#editor").addClass("hide"),$("#console-wrap").addClass("hide"),M=!1,$("#graphic-wrap").addClass("hide"),N=!1,$("#unittest-wrap").removeClass("hide"),$("#output-dragbar").addClass("hide"),$("#instructionsContainer").addClass("hide"),$("#outputContainer").removeClass("hide"),v.closeOverlay("#modules"),n(),a&&v.callAnalytics("Interaction","Click","Check")},consoleResult:function(a){"console"!==A&&a&&"console"===$(a.target).data("button")&&v.changeRunOption("console"),v.runMode="console",v.triggerRunModeChange(),$("#codeOutput").removeClass("hide"),$("#editor").addClass("hide"),$("#unittest-wrap").addClass("hide"),v.closeOverlay("#modules"),$("#instructionsContainer").addClass("hide"),$("#outputContainer").removeClass("hide"),$("#codeOutputTab").addClass("active"),$("#instructionsTab").removeClass("active"),r(),a&&(v.callAnalytics("Interaction","Click","Console"),b.runtime("usingSenseHat")&&v.callAnalytics("Sense Hat Run","Click","Console"))},toggleModules:function(){L?v.toggleOverlay("#modules"):$.get("/api/docs/python",function(a){$("#modules").prepend(a),$(document).foundation(),v.toggleOverlay("#modules"),L=!0,v.callAnalytics("Interaction","Click","Documentation")})},hideAll:function(){this.toggleModules()},onOpenOverlay:function(){$("#codeOutput").addClass("hide"),$("#editor").addClass("hide")},onCloseOverlay:function(){$("#codeOutput").removeClass("hide"),$("#editor").removeClass("hide"),v.focus(),i(!1)},reset:function(a,b){w.reset(a.code),w.assets(a.assets?a.assets.slice():[]),b||k(),"console"===A||"console"===v.runMode?this.consoleResult():a.code&&"result"===z&&K!==!1?this.showResult():(this.showCode(),j())},replaceMain:function(a,b){w.setValue(a.code),w.assets(a.assets?a.assets.slice():[]),b||k()},focus:function(){$("body").data("is-mobile")||w.focus(),i(!1)},markCodeAsRun:function(a){H[a]=!0},downloadable:function(){var a,c,d,e="owner"===this.getUIType();return this._trinket&&this._trinket._origin_id&&(a=this._trinket._origin_id),c=e&&!a?w.getAllFiles():w.getAllVisibleFiles(),d=w.assets(),b.runtime("usingSenseHat")||U.usingSenseHat(c)&&U.addSrc(),{files:c,assets:d}},toggleCheckButton:function(){$(".check-it").hasClass("hide")?$(".check-it").removeClass("hide"):$(".check-it").addClass("hide")},changeRunOption:function(a){var b={run:"fa fa-play",console:"fa fa-terminal",stop:"fa fa-stop"},c={run:"View the result.",console:"Run code interactively.",stop:"Stop program."},d={run:"Run",console:"Console",stop:"Stop"};$(".run-it").data("action","code."+a),$(".run-it").attr("title",c[a]),$(".run-it").find("label").text(d[a]),$(".run-it").find("i").removeClass().addClass(b[a]),A=a},saveClientSnapshot:function(){return b.runtime("usingSenseHat")},captureAndSaveSnapshot:function(b){var c=document.querySelector("svg"),d=document.createElement("div"),e=c.cloneNode(!0);$(e).css("transform","rotate(0deg)"),e.setAttribute("width",320),e.setAttribute("height",320),d.appendChild(e);var f='<?xml version="1.0" standalone="no"?><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">',g=f+d.innerHTML;g=encodeURIComponent(g),g=g.replace(/%([0-9A-F]{2})/g,function(a,b){var c=String.fromCharCode("0x"+b);return"%"===c?"%25":c}),g=decodeURIComponent(g);var h="data:image/svg+xml;base64,"+a.btoa(g),i=new Image;i.onload=function(){var a=document.createElement("canvas");a.width=320,a.height=320;var c=a.getContext("2d");c.drawImage(i,0,20,320,300,0,0,320,320);var d;document.createElement("a");try{d=a.toDataURL("image/png")}catch(a){if("undefined"!=typeof SecurityError&&a instanceof SecurityError||"SecurityError"==a.name)return void console.error("Rendered SVG images cannot be downloaded in this browser.");throw a}b(d)},i.src=h},discardDraftSettings:function(){if(this._trinket.settings.testsEnabled!==this._predraft.settings.testsEnabled){var a=new MouseEvent("click",{bubbles:!0});try{$("#testsEnabled").data("skip-trigger",!0),$("#testsEnabled")[0].dispatchEvent(a)}catch(a){console.log("testsEnabled click err:",a)}}b.runtime("usingSenseHat")&&U.resetSensors(this._predraft.settings)}}}(window,window.TrinketIO);